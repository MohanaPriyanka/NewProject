<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <assignments>
        <description>Assign inputs to sov for subscription orders.</description>
        <name>Assign_SO</name>
        <label>Assign SO</label>
        <locationX>678</locationX>
        <locationY>13</locationY>
        <assignmentItems>
            <assignToReference>sov_SubscriptionOrder.Utility_Account_Subscription__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>sovUAS.Id</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>sov_SubscriptionOrder.Change_in_Annual_Cost__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>var_AnnualCostChange</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>sov_SubscriptionOrder.Change_in_Annual_kWh__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>var_AnnualkWhChange</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>sov_SubscriptionOrder.Approval_Status__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>Approved</stringValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>sov_SubscriptionOrder.Comments__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>var_SOComments</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>sov_SubscriptionOrder.Type__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>pcklst_Subscription_Order_Type</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>SO_Creation</targetReference>
        </connector>
    </assignments>
    <description>Flow that is launched from UASs that allows a user to input an annual cost or kwh value, and have a subscription order created.</description>
    <dynamicChoiceSets>
        <name>pcs_SO_Type_Picklist</name>
        <dataType>Picklist</dataType>
        <displayField xsi:nil="true"/>
        <object xsi:nil="true"/>
        <picklistField>Type__c</picklistField>
        <picklistObject>Subscription_Order__c</picklistObject>
    </dynamicChoiceSets>
    <formulas>
        <description>Calculates the difference between the current annual cost on the UAS, and the new annual cost inserted by the user.</description>
        <name>var_AnnualCostChange</name>
        <dataType>Currency</dataType>
        <expression>{!varNew_Annual_Cost}-{!sovUAS.Annual_Cost_Future_Rollup__c}</expression>
        <scale>2</scale>
    </formulas>
    <formulas>
        <name>var_AnnualkWhChange</name>
        <dataType>Number</dataType>
        <expression>{!varNew_Annual_kWh}-{!sovUAS.Annual_kWh_Subscription_Future_Rollup__c}</expression>
        <scale>2</scale>
    </formulas>
    <interviewLabel>User Subscription Order Creation {!$Flow.CurrentDateTime}</interviewLabel>
    <label>User Subscription Order Creation</label>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>Flow</processType>
    <recordCreates>
        <name>SO_Creation</name>
        <label>SO Creation</label>
        <locationX>826</locationX>
        <locationY>21</locationY>
        <connector>
            <targetReference>Success</targetReference>
        </connector>
        <faultConnector>
            <targetReference>Error</targetReference>
        </faultConnector>
        <inputReference>sov_SubscriptionOrder</inputReference>
    </recordCreates>
    <recordLookups>
        <name>Get_UAS</name>
        <label>Get_UAS</label>
        <locationX>201</locationX>
        <locationY>12</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>SO_Input</targetReference>
        </connector>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>var_UASID</elementReference>
            </value>
        </filters>
        <object>Utility_Account_Subscription__c</object>
        <outputReference>sovUAS</outputReference>
        <queriedFields>Id</queriedFields>
        <queriedFields>Subscription_Type__c</queriedFields>
        <queriedFields>Annual_Cost_Future_Rollup__c</queriedFields>
        <queriedFields>Annual_kWh_Subscription_Future_Rollup__c</queriedFields>
    </recordLookups>
    <screens>
        <name>Error</name>
        <label>Error</label>
        <locationX>826</locationX>
        <locationY>223</locationY>
        <allowBack>true</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>true</allowPause>
        <fields>
            <name>txt_Error</name>
            <fieldText>&lt;p&gt;The Subscription Order was not able to be created because an error occurred. Business Application has been notified.&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;The most common reason for this happening is not having permission to create Subscription Orders. If this is the case, please submit a case to productsupport@bluewavesolar.com to have those permissions assigned to you.&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <showFooter>false</showFooter>
        <showHeader>false</showHeader>
    </screens>
    <screens>
        <name>scrSO_Review</name>
        <label>SO Review</label>
        <locationX>529</locationX>
        <locationY>12</locationY>
        <allowBack>true</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>false</allowPause>
        <connector>
            <targetReference>Assign_SO</targetReference>
        </connector>
        <fields>
            <name>scrReviewDisplay</name>
            <fieldText>&lt;p&gt;You selected &lt;b style=&quot;font-size: 14px;&quot;&gt;{!varNew_Annual_Cost}{!varNew_Annual_kWh}&lt;/b&gt;&lt;b&gt; &lt;/b&gt;as the new subscription amount for this UAS.&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;To do that, we&apos;ll create a new Subscription Order for this amount:&lt;/p&gt;&lt;p&gt;&lt;b style=&quot;font-size: 14px;&quot;&gt;{!var_AnnualCostChange}{!var_AnnualkWhChange} &lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;and&lt;/span&gt;&lt;b style=&quot;font-size: 14px;&quot;&gt; &lt;/b&gt;with the type:&lt;/p&gt;&lt;p&gt;&lt;b style=&quot;font-size: 14px;&quot;&gt;{!pcklst_Subscription_Order_Type}&lt;/b&gt;.&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;If these values look correct to you, click &lt;b style=&quot;font-size: 14px;&quot;&gt;&quot;Next&quot;&lt;/b&gt; and the Subscription Order will be automatically created an applied to the customer&apos;s UAS. If you would like to make changes, click &lt;b style=&quot;font-size: 14px;&quot;&gt;&quot;Previous&quot;&lt;/b&gt;.&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <showFooter>true</showFooter>
        <showHeader>false</showHeader>
    </screens>
    <screens>
        <name>SO_Input</name>
        <label>Subscription Order Input</label>
        <locationX>360</locationX>
        <locationY>18</locationY>
        <allowBack>false</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>false</allowPause>
        <connector>
            <targetReference>scrSO_Review</targetReference>
        </connector>
        <fields>
            <name>txtTypeSelection</name>
            <fieldText>&lt;p&gt;Choose the Type of Subscription Order you&apos;d like to create. Most of the time, the type will be Resizing. &lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <fields>
            <name>pcklst_Subscription_Order_Type</name>
            <choiceReferences>pcs_SO_Type_Picklist</choiceReferences>
            <dataType>String</dataType>
            <fieldText>Subscription Order Type</fieldText>
            <fieldType>DropdownBox</fieldType>
            <isRequired>true</isRequired>
        </fields>
        <fields>
            <name>txt_Commentsinfo</name>
            <fieldText>&lt;p&gt;If you would like to leave any comments about this Subscription Order, you can put them here:&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <fields>
            <name>var_SOComments</name>
            <dataType>String</dataType>
            <fieldText>Comments</fieldText>
            <fieldType>InputField</fieldType>
            <isRequired>false</isRequired>
        </fields>
        <fields>
            <name>txtAnnual_Cost_Sizing</name>
            <fieldText>&lt;p&gt;Enter the new Annual Cost ($) that you would like this subscription to have. For example, if the current Annual Cost is $1,000, and they are being resized to $800, enter $800. &lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;For reference, the Utility Account Subscription currently as a Future Annual Cost of {!sovUAS.Annual_Cost_Future_Rollup__c}&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
            <visibilityRule>
                <conditionLogic>and</conditionLogic>
                <conditions>
                    <leftValueReference>sovUAS.Subscription_Type__c</leftValueReference>
                    <operator>EqualTo</operator>
                    <rightValue>
                        <stringValue>Electricity Cost ($)</stringValue>
                    </rightValue>
                </conditions>
            </visibilityRule>
        </fields>
        <fields>
            <name>varNew_Annual_Cost</name>
            <dataType>Currency</dataType>
            <fieldText>New Annual Cost ($)</fieldText>
            <fieldType>InputField</fieldType>
            <isRequired>true</isRequired>
            <scale>6</scale>
            <visibilityRule>
                <conditionLogic>and</conditionLogic>
                <conditions>
                    <leftValueReference>sovUAS.Subscription_Type__c</leftValueReference>
                    <operator>EqualTo</operator>
                    <rightValue>
                        <stringValue>Electricity Cost ($)</stringValue>
                    </rightValue>
                </conditions>
            </visibilityRule>
        </fields>
        <fields>
            <name>txt_AnnualkWh_Sizing</name>
            <fieldText>&lt;p&gt;&lt;span style=&quot;color: rgb(62, 62, 60); background-color: rgb(255, 255, 255);&quot;&gt;Enter the new Annual kWh that you would like this subscription to have. For example, if the current Annual kWh is 1,000, and they are being resized to 800, enter 800.&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;color: rgb(62, 62, 60); background-color: rgb(255, 255, 255);&quot;&gt;For reference, the Utility Account Subscription currently as a Future Annual kWh of {!sovUAS.Annual_kWh_Subscription_Future_Rollup__c}.&lt;/span&gt;&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
            <visibilityRule>
                <conditionLogic>and</conditionLogic>
                <conditions>
                    <leftValueReference>sovUAS.Subscription_Type__c</leftValueReference>
                    <operator>EqualTo</operator>
                    <rightValue>
                        <stringValue>kWh</stringValue>
                    </rightValue>
                </conditions>
            </visibilityRule>
        </fields>
        <fields>
            <name>varNew_Annual_kWh</name>
            <dataType>Number</dataType>
            <fieldText>New Annual kWh</fieldText>
            <fieldType>InputField</fieldType>
            <isRequired>true</isRequired>
            <scale>2</scale>
            <visibilityRule>
                <conditionLogic>and</conditionLogic>
                <conditions>
                    <leftValueReference>sovUAS.Subscription_Type__c</leftValueReference>
                    <operator>EqualTo</operator>
                    <rightValue>
                        <stringValue>kWh</stringValue>
                    </rightValue>
                </conditions>
            </visibilityRule>
        </fields>
        <showFooter>true</showFooter>
        <showHeader>false</showHeader>
    </screens>
    <screens>
        <name>Success</name>
        <label>Success</label>
        <locationX>967</locationX>
        <locationY>15</locationY>
        <allowBack>true</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>true</allowPause>
        <fields>
            <name>txt_Success</name>
            <fieldText>&lt;p&gt;The Subscription Order was created successfully, &lt;a href=&quot;/{!sov_SubscriptionOrder.Id}&quot; target=&quot;_blank&quot;&gt;click here to view the record! &lt;/a&gt;&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <showFooter>false</showFooter>
        <showHeader>false</showHeader>
    </screens>
    <startElementReference>Get_UAS</startElementReference>
    <status>Active</status>
    <textTemplates>
        <name>varErrorMessage</name>
        <text>&lt;p&gt;An Error Occurred in the User Subscription Order Creation Flow:&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;{!$Flow.FaultMessage}&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;</text>
    </textTemplates>
    <variables>
        <name>sov_ErrorLog</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
        <objectType>Error_Log__c</objectType>
    </variables>
    <variables>
        <description>New SO that is created in the flow.</description>
        <name>sov_SubscriptionOrder</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
        <objectType>Subscription_Order__c</objectType>
    </variables>
    <variables>
        <description>This is the s object variable for the UAS that launches the flow.</description>
        <name>sovUAS</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
        <objectType>Utility_Account_Subscription__c</objectType>
    </variables>
    <variables>
        <description>UAS ID that is passed through the URL of the flow when it is launched.</description>
        <name>var_UASID</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
    </variables>
</Flow>
