<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <actionCalls>
        <description>Makes API call to Zuora to execute a bill run, which gets outstanding usage and creates invoices.</description>
        <name>FlowZuoraBillRun</name>
        <label>Bill Run Execute</label>
        <locationX>690</locationX>
        <locationY>183</locationY>
        <actionName>InvocableZuoraBillRun</actionName>
        <actionType>apex</actionType>
        <connector>
            <targetReference>Download_Invoices_Screen</targetReference>
        </connector>
        <inputParameters>
            <name>invoiceDates</name>
            <value>
                <elementReference>Invoice_Date</elementReference>
            </value>
        </inputParameters>
        <outputParameters>
            <assignToReference>BillRun_Response</assignToReference>
            <name>output</name>
        </outputParameters>
    </actionCalls>
    <actionCalls>
        <description>Queries for invoices in SF that do not have a pdf, get that pdf from Zuora and download it as a file.</description>
        <name>InvoiceDownload</name>
        <label>InvoiceDownload</label>
        <locationX>824</locationX>
        <locationY>190</locationY>
        <actionName>InvocableZuoraInvoiceDownload</actionName>
        <actionType>apex</actionType>
        <connector>
            <targetReference>Send_Via_Email_Screen</targetReference>
        </connector>
    </actionCalls>
    <actionCalls>
        <description>Gets zuora invoices marked as ready for paper send and uploads them to letterstream</description>
        <name>PaperMailSend</name>
        <label>PaperMailSend</label>
        <locationX>1072</locationX>
        <locationY>182</locationY>
        <actionName>InvocableZuoraPaperMailSend</actionName>
        <actionType>apex</actionType>
        <connector>
            <targetReference>Zuora_Memo_Apply</targetReference>
        </connector>
    </actionCalls>
    <actionCalls>
        <description>Assigns bill templates to Zuora Accounts based on criteria (client, anchor v non anchor, etc)</description>
        <name>TemplateAssigner</name>
        <label>TemplateAssigner</label>
        <locationX>475</locationX>
        <locationY>185</locationY>
        <actionName>InvocableZuoraTemplateAssigner</actionName>
        <actionType>apex</actionType>
        <connector>
            <targetReference>Input_Bill_Date</targetReference>
        </connector>
    </actionCalls>
    <actionCalls>
        <description>Gets all UASBs and Bill Adjustments that have not been uploaded to Zuora yet and uploads them</description>
        <name>UsageUpload</name>
        <label>UsageUpload</label>
        <locationX>198</locationX>
        <locationY>180</locationY>
        <actionName>InvocableZuoraUsageUpload</actionName>
        <actionType>apex</actionType>
        <connector>
            <targetReference>Upload_Adjustments_To_Zuora_Screen</targetReference>
        </connector>
    </actionCalls>
    <actionCalls>
        <description>Queries for all invoices marked as Ready for Email = true, and send through email from Salesforce with the bill pdf as an attachment.</description>
        <name>Zuora_Email_Send</name>
        <label>Zuora Email Send</label>
        <locationX>968</locationX>
        <locationY>183</locationY>
        <actionName>InvocableZuoraEmailSend</actionName>
        <actionType>apex</actionType>
        <connector>
            <targetReference>Send_Via_Paper_Screen</targetReference>
        </connector>
    </actionCalls>
    <actionCalls>
        <description>Queries outstanding credit memos in Zuora, and applies them to invoices by client and project</description>
        <name>Zuora_Memo_Apply</name>
        <label>Memo Apply</label>
        <locationX>1186</locationX>
        <locationY>182</locationY>
        <actionName>InvocableZuoraMemoApply</actionName>
        <actionType>apex</actionType>
        <connector>
            <targetReference>Done_SCreen</targetReference>
        </connector>
    </actionCalls>
    <actionCalls>
        <description>Uploads bill adjustments in SF that are not yet in Zuora</description>
        <name>Zuora_Memo_Upload</name>
        <label>Memo Upload</label>
        <locationX>320</locationX>
        <locationY>186</locationY>
        <actionName>InvocableZuoraMemoUpload</actionName>
        <actionType>apex</actionType>
        <connector>
            <targetReference>Template_Assigner_Screen</targetReference>
        </connector>
    </actionCalls>
    <description>Walks through the steps of invoice creation, modification and delivery for monthly CS statements</description>
    <interviewLabel>Zuora Bill Generation Console {!$Flow.CurrentDateTime}</interviewLabel>
    <label>Zuora Bill Generation Console</label>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>Flow</processType>
    <screens>
        <name>Done_SCreen</name>
        <label>Done</label>
        <locationX>1186</locationX>
        <locationY>396</locationY>
        <allowBack>true</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>true</allowPause>
        <fields>
            <name>Done</name>
            <fieldText>&lt;p&gt;DONE!&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;a href=&quot;http://https://forever-sinned.tumblr.com/post/12006410946&quot; target=&quot;_blank&quot;&gt;https://forever-sinned.tumblr.com/post/12006410946&lt;/a&gt;&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <fields>
            <name>BillStatus_Done</name>
            <extensionName>c:BillStatusComponent</extensionName>
            <fieldType>ComponentInstance</fieldType>
            <isRequired>true</isRequired>
        </fields>
        <showFooter>true</showFooter>
        <showHeader>false</showHeader>
    </screens>
    <screens>
        <name>Download_Invoices_Screen</name>
        <label>Download Invoices</label>
        <locationX>810</locationX>
        <locationY>393</locationY>
        <allowBack>false</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>false</allowPause>
        <connector>
            <targetReference>InvoiceDownload</targetReference>
        </connector>
        <fields>
            <name>Download_PDFS_Text</name>
            <fieldText>&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;b style=&quot;font-size: 15pt; color: rgb(62, 62, 60);&quot;&gt;&lt;span class=&quot;ql-cursor&quot;&gt;﻿&lt;/span&gt;Download PDFs&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;font-size: 10pt; color: rgb(62, 62, 60);&quot;&gt;This step will download all Zuora PDFs to Salesforce and mark invoices as &quot;Ready for Email&quot; and &quot;Ready for Paper Bill Queue&quot;&lt;/span&gt;&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <fields>
            <name>BillStatus_Download</name>
            <extensionName>c:BillStatusComponent</extensionName>
            <fieldType>ComponentInstance</fieldType>
            <isRequired>true</isRequired>
        </fields>
        <showFooter>false</showFooter>
        <showHeader>false</showHeader>
    </screens>
    <screens>
        <name>Execute_Bill_Run_Screen</name>
        <label>Execute Bill Run</label>
        <locationX>681</locationX>
        <locationY>398</locationY>
        <allowBack>false</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>false</allowPause>
        <connector>
            <targetReference>FlowZuoraBillRun</targetReference>
        </connector>
        <fields>
            <name>Execute_Bill_Run_Text</name>
            <fieldText>&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;b style=&quot;font-size: 18px; color: rgb(62, 62, 60);&quot;&gt;&lt;span class=&quot;ql-cursor&quot;&gt;﻿&lt;/span&gt;Execute Bill Run&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;color: rgb(62, 62, 60);&quot;&gt;When you hit Next, Zuora will create invoices from previously uploaded usage.&lt;/span&gt;&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <fields>
            <name>BillStatus_ExecuteBilLRun</name>
            <extensionName>c:BillStatusComponent</extensionName>
            <fieldType>ComponentInstance</fieldType>
            <isRequired>true</isRequired>
        </fields>
        <showFooter>false</showFooter>
        <showHeader>false</showHeader>
    </screens>
    <screens>
        <name>GenerateUASBs</name>
        <label>GenerateUASBs</label>
        <locationX>49</locationX>
        <locationY>395</locationY>
        <allowBack>true</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>true</allowPause>
        <connector>
            <targetReference>Usage_Upload_Screen</targetReference>
        </connector>
        <fields>
            <name>BillGenConsoleCMP</name>
            <extensionName>c:BillGenerationConsole</extensionName>
            <fieldType>ComponentInstance</fieldType>
            <isRequired>true</isRequired>
        </fields>
        <showFooter>false</showFooter>
        <showHeader>false</showHeader>
    </screens>
    <screens>
        <name>Input_Bill_Date</name>
        <label>Input Bill Date</label>
        <locationX>565</locationX>
        <locationY>398</locationY>
        <allowBack>false</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>false</allowPause>
        <connector>
            <targetReference>Execute_Bill_Run_Screen</targetReference>
        </connector>
        <fields>
            <name>Invoice_Date</name>
            <dataType>Date</dataType>
            <fieldText>Invoice Date</fieldText>
            <fieldType>InputField</fieldType>
            <isRequired>true</isRequired>
        </fields>
        <fields>
            <name>BillStatus_InvoiceDate</name>
            <extensionName>c:BillStatusComponent</extensionName>
            <fieldType>ComponentInstance</fieldType>
            <isRequired>true</isRequired>
        </fields>
        <showFooter>false</showFooter>
        <showHeader>false</showHeader>
    </screens>
    <screens>
        <name>Send_Via_Email_Screen</name>
        <label>Send Via Email</label>
        <locationX>954</locationX>
        <locationY>398</locationY>
        <allowBack>false</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>false</allowPause>
        <connector>
            <targetReference>Zuora_Email_Send</targetReference>
        </connector>
        <fields>
            <name>Send_Via_Email_Text</name>
            <fieldText>&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;b style=&quot;color: rgb(62, 62, 60); font-size: 15pt;&quot;&gt;&lt;span class=&quot;ql-cursor&quot;&gt;﻿&lt;/span&gt;Send Via Email&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;color: rgb(62, 62, 60);&quot;&gt;Clicking next will find all invoices marked as &quot;Ready for Email Send&quot; and attempt to send them. Any emails that fail will have a task logged on the specific invoice record&lt;/span&gt;&lt;span style=&quot;color: rgb(62, 62, 60); font-size: 10pt;&quot;&gt;.&lt;/span&gt;&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <fields>
            <name>BillStatus_Email</name>
            <extensionName>c:BillStatusComponent</extensionName>
            <fieldType>ComponentInstance</fieldType>
            <isRequired>true</isRequired>
        </fields>
        <showFooter>false</showFooter>
        <showHeader>false</showHeader>
    </screens>
    <screens>
        <name>Send_Via_Paper_Screen</name>
        <label>Send Via Paper</label>
        <locationX>1063</locationX>
        <locationY>394</locationY>
        <allowBack>false</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>false</allowPause>
        <connector>
            <targetReference>PaperMailSend</targetReference>
        </connector>
        <fields>
            <name>Send_Via_Paper_Text</name>
            <fieldText>&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;b style=&quot;font-size: 18px; color: rgb(62, 62, 60);&quot;&gt;&lt;span class=&quot;ql-cursor&quot;&gt;﻿&lt;/span&gt;Send to LetterStream&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;font-size: 10pt; color: rgb(62, 62, 60);&quot;&gt;Uploads bill pdfs to LetterStream. It will query for all invoices marked as &quot;Ready for Paper Bill Queue&quot;&lt;/span&gt;&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <fields>
            <name>BillStatus_Letter</name>
            <extensionName>c:BillStatusComponent</extensionName>
            <fieldType>ComponentInstance</fieldType>
            <isRequired>true</isRequired>
        </fields>
        <showFooter>false</showFooter>
        <showHeader>false</showHeader>
    </screens>
    <screens>
        <name>Template_Assigner_Screen</name>
        <label>TemplateAssigner</label>
        <locationX>459</locationX>
        <locationY>398</locationY>
        <allowBack>false</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>false</allowPause>
        <connector>
            <targetReference>TemplateAssigner</targetReference>
        </connector>
        <fields>
            <name>Template_Assigner_Text</name>
            <fieldText>&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;b style=&quot;font-size: 18px; color: rgb(62, 62, 60);&quot;&gt;&lt;span class=&quot;ql-cursor&quot;&gt;﻿&lt;/span&gt;Assign Templates and Send Messaging to Zuora&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;color: rgb(62, 62, 60);&quot;&gt;When you click next, automation will run to find the appropriate invoice template for bills, based on the client, autopay, etc. and set the Zuora Invoice Template field on the account.&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;color: rgb(62, 62, 60);&quot;&gt;The welcome letter insert (if the customers first bill) will be stored on the Invoice record in Salesforce. &lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;color: rgb(62, 62, 60);&quot;&gt;Additionally, it will automatically populate the bill message from either the system default message or the account message override fields.&lt;/span&gt;&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <fields>
            <name>BillStatus_Templates</name>
            <extensionName>c:BillStatusComponent</extensionName>
            <fieldType>ComponentInstance</fieldType>
            <isRequired>true</isRequired>
        </fields>
        <showFooter>false</showFooter>
        <showHeader>false</showHeader>
    </screens>
    <screens>
        <name>Upload_Adjustments_To_Zuora_Screen</name>
        <label>Adjustment Upload</label>
        <locationX>303</locationX>
        <locationY>401</locationY>
        <allowBack>false</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>false</allowPause>
        <connector>
            <targetReference>Zuora_Memo_Upload</targetReference>
        </connector>
        <fields>
            <name>Upload_Adjustments_Text</name>
            <fieldText>&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;b style=&quot;color: rgb(62, 62, 60); font-size: 18px;&quot;&gt;&lt;span class=&quot;ql-cursor&quot;&gt;﻿&lt;/span&gt;Apply Credit Memos in Zuora&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;color: rgb(62, 62, 60);&quot;&gt;This step will upload adjustments as credit and debit memos to Zuora and apply them to invoices.&amp;nbsp;&lt;/span&gt;&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <fields>
            <name>BillStatus_CreditMemo</name>
            <extensionName>c:BillStatusComponent</extensionName>
            <fieldType>ComponentInstance</fieldType>
            <isRequired>true</isRequired>
        </fields>
        <showFooter>false</showFooter>
        <showHeader>false</showHeader>
    </screens>
    <screens>
        <name>Usage_Upload_Screen</name>
        <label>Usage Upload</label>
        <locationX>190</locationX>
        <locationY>395</locationY>
        <allowBack>false</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>false</allowPause>
        <connector>
            <targetReference>UsageUpload</targetReference>
        </connector>
        <fields>
            <name>UsageUpload_Text</name>
            <fieldText>&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;b style=&quot;font-size: 18px; color: rgb(62, 62, 60);&quot;&gt;&lt;span class=&quot;ql-cursor&quot;&gt;﻿&lt;/span&gt;Upload Usage to Zuora&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;color: rgb(62, 62, 60);&quot;&gt;When you hit Next, UASBs and Production adjustments will be uploaded to Zuora. This will create usage records under a customer&apos;s account but will not create Invoices yet&lt;/span&gt;&lt;span style=&quot;color: rgb(62, 62, 60); font-size: 10pt;&quot;&gt;.&lt;/span&gt;&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <fields>
            <name>BillStatus_Usage</name>
            <extensionName>c:BillStatusComponent</extensionName>
            <fieldType>ComponentInstance</fieldType>
            <isRequired>true</isRequired>
        </fields>
        <showFooter>false</showFooter>
        <showHeader>false</showHeader>
    </screens>
    <startElementReference>GenerateUASBs</startElementReference>
    <status>Active</status>
    <variables>
        <description>Response from the API after we try to execute a bill Run</description>
        <name>BillRun_Response</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
</Flow>
