<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <actionCalls>
        <name>Send_Northeast_Onboarding_Email</name>
        <label>Send Northeast Onboarding Email</label>
        <locationX>200</locationX>
        <locationY>521</locationY>
        <actionName>BSST__c.Salesperson_Setup_Email_Northeast</actionName>
        <actionType>emailAlert</actionType>
        <connector>
            <targetReference>FinishedwithEmail</targetReference>
        </connector>
        <inputParameters>
            <name>SObjectRowId</name>
            <value>
                <elementReference>SalespersonID</elementReference>
            </value>
        </inputParameters>
    </actionCalls>
    <actionCalls>
        <name>Send_Southeast_Email</name>
        <label>Send Southeast Email</label>
        <locationX>549</locationX>
        <locationY>536</locationY>
        <actionName>BSST__c.Salesperson_Setup_Email_Southeast</actionName>
        <actionType>emailAlert</actionType>
        <connector>
            <targetReference>FinishedwithEmail</targetReference>
        </connector>
        <inputParameters>
            <name>SObjectRowId</name>
            <value>
                <elementReference>SalespersonID</elementReference>
            </value>
        </inputParameters>
    </actionCalls>
    <choices>
        <name>Don_t_Send_Email</name>
        <choiceText>Don&apos;t Send Email</choiceText>
        <dataType>String</dataType>
    </choices>
    <choices>
        <name>Northeast</name>
        <choiceText>Northeast</choiceText>
        <dataType>String</dataType>
    </choices>
    <choices>
        <name>Send_Email</name>
        <choiceText>Send Email</choiceText>
        <dataType>String</dataType>
    </choices>
    <choices>
        <name>Southeast</name>
        <choiceText>Southeast</choiceText>
        <dataType>String</dataType>
    </choices>
    <decisions>
        <name>Sales_Area</name>
        <label>Sales Area</label>
        <locationX>389</locationX>
        <locationY>449</locationY>
        <defaultConnectorLabel>[Default Outcome]</defaultConnectorLabel>
        <rules>
            <name>Northeastchoice</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>State_Market</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <elementReference>Northeast</elementReference>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>Do_you_want_to_send_the_setup_email_to_the_Salesperson</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <elementReference>Send_Email</elementReference>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Send_Northeast_Onboarding_Email</targetReference>
            </connector>
            <label>Northeast</label>
        </rules>
        <rules>
            <name>Southeastchoice</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>State_Market</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <elementReference>Southeast</elementReference>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>Do_you_want_to_send_the_setup_email_to_the_Salesperson</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <elementReference>Send_Email</elementReference>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Send_Southeast_Email</targetReference>
            </connector>
            <label>Southeast</label>
        </rules>
    </decisions>
    <decisions>
        <name>Send_Email_Decision</name>
        <label>Send Email Decision</label>
        <locationX>707</locationX>
        <locationY>390</locationY>
        <defaultConnectorLabel>[Default Outcome]</defaultConnectorLabel>
        <rules>
            <name>Send_Email_Outcome</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Do_you_want_to_send_the_setup_email_to_the_Salesperson</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <elementReference>Send_Email</elementReference>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Sales_Area</targetReference>
            </connector>
            <label>Send Email Outcome</label>
        </rules>
        <rules>
            <name>Don_t_Send_Email_Outcome</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Do_you_want_to_send_the_setup_email_to_the_Salesperson</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <elementReference>Don_t_Send_Email</elementReference>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Finished</targetReference>
            </connector>
            <label>Don&apos;t Send Email Outcome</label>
        </rules>
    </decisions>
    <description>This is v2 of the partner setup flow. Due to a salesforce known issue, users must be delegated admins in order to create and activate users within a flow. However, being delegated admins precents them from doing other essential tasks. This flow was made to compensate for that.</description>
    <dynamicChoiceSets>
        <name>profile</name>
        <dataType>String</dataType>
        <displayField>Name</displayField>
        <filters>
            <field>Name</field>
            <operator>Contains</operator>
            <value>
                <stringValue>partner</stringValue>
            </value>
        </filters>
        <object>Profile</object>
        <valueField>Id</valueField>
    </dynamicChoiceSets>
    <dynamicChoiceSets>
        <name>Roles</name>
        <dataType>String</dataType>
        <displayField>Name</displayField>
        <filters>
            <field>Name</field>
            <operator>Contains</operator>
            <value>
                <elementReference>PartnerName</elementReference>
            </value>
        </filters>
        <object>UserRole</object>
        <valueField>Id</valueField>
    </dynamicChoiceSets>
    <dynamicChoiceSets>
        <name>UserRole</name>
        <dataType>Picklist</dataType>
        <displayField xsi:nil="true"/>
        <object xsi:nil="true"/>
        <picklistField>PortalRole</picklistField>
        <picklistObject>User</picklistObject>
    </dynamicChoiceSets>
    <formulas>
        <name>alias</name>
        <dataType>String</dataType>
        <expression>LEFT({!FirstName},3)&amp;LEFT({!Last_Name},3)</expression>
    </formulas>
    <formulas>
        <name>FullName</name>
        <dataType>String</dataType>
        <expression>{!FirstName} &amp; &quot; &quot; &amp; {!Last_Name}</expression>
    </formulas>
    <interviewLabel>Partial Partner Setup {!$Flow.CurrentDateTime}</interviewLabel>
    <label>Partial Partner Setup</label>
    <processType>Flow</processType>
    <recordCreates>
        <name>Create_Contact_0</name>
        <label>Create Contact</label>
        <locationX>847</locationX>
        <locationY>94</locationY>
        <assignRecordIdToReference>ContactID</assignRecordIdToReference>
        <connector>
            <targetReference>Email_Decision</targetReference>
        </connector>
        <inputAssignments>
            <field>AccountId</field>
            <value>
                <elementReference>partneraccountid</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Email</field>
            <value>
                <elementReference>Email</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>FirstName</field>
            <value>
                <elementReference>FirstName</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>LastName</field>
            <value>
                <elementReference>Last_Name</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Partner_Lookup__c</field>
            <value>
                <elementReference>PartnerID</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Phone</field>
            <value>
                <elementReference>Phone</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>RecordTypeId</field>
            <value>
                <elementReference>contacttypeID</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Sales_Representative__c</field>
            <value>
                <elementReference>SalespersonID</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Title</field>
            <value>
                <elementReference>Title</elementReference>
            </value>
        </inputAssignments>
        <object>Contact</object>
    </recordCreates>
    <recordCreates>
        <name>Create_New_Salesperson</name>
        <label>Create New Salesperson</label>
        <locationX>265</locationX>
        <locationY>102</locationY>
        <assignRecordIdToReference>SalespersonID</assignRecordIdToReference>
        <connector>
            <targetReference>partner_account_lookup2</targetReference>
        </connector>
        <inputAssignments>
            <field>Email__c</field>
            <value>
                <elementReference>Email</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Name</field>
            <value>
                <elementReference>FullName</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Partner__c</field>
            <value>
                <elementReference>PartnerID</elementReference>
            </value>
        </inputAssignments>
        <object>BSST__c</object>
    </recordCreates>
    <recordLookups>
        <name>partner_account_lookup2</name>
        <label>partner account lookup2</label>
        <locationX>431</locationX>
        <locationY>104</locationY>
        <assignNullValuesIfNoRecordsFound>true</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Partner_Contact_Record_Type_ID</targetReference>
        </connector>
        <filters>
            <field>IsPartner</field>
            <operator>EqualTo</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </filters>
        <filters>
            <field>Name</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>PartnerName</elementReference>
            </value>
        </filters>
        <filters>
            <field>Partner__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>PartnerID</elementReference>
            </value>
        </filters>
        <object>Account</object>
        <outputAssignments>
            <assignToReference>partneraccountid</assignToReference>
            <field>Id</field>
        </outputAssignments>
        <outputAssignments>
            <assignToReference>PartnerAccountName</assignToReference>
            <field>Name</field>
        </outputAssignments>
        <sortField>CreatedDate</sortField>
        <sortOrder>Asc</sortOrder>
    </recordLookups>
    <recordLookups>
        <name>Partner_Contact_Record_Type_ID</name>
        <label>Partner Contact Record Type ID</label>
        <locationX>651</locationX>
        <locationY>94</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Create_Contact_0</targetReference>
        </connector>
        <filters>
            <field>Name</field>
            <operator>Contains</operator>
            <value>
                <stringValue>Partner</stringValue>
            </value>
        </filters>
        <filters>
            <field>SobjectType</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Contact</stringValue>
            </value>
        </filters>
        <object>RecordType</object>
        <outputAssignments>
            <assignToReference>contacttypeID</assignToReference>
            <field>Id</field>
        </outputAssignments>
    </recordLookups>
    <screens>
        <name>Email_Decision</name>
        <label>Email Decision</label>
        <locationX>705</locationX>
        <locationY>304</locationY>
        <allowBack>false</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>true</allowPause>
        <connector>
            <targetReference>Send_Email_Decision</targetReference>
        </connector>
        <fields>
            <name>end</name>
            <fieldText>&lt;DIV ALIGN=&quot;LEFT&quot;&gt;&lt;FONT FACE=&quot;Arial&quot; STYLE=&quot;font-size:12px&quot; COLOR=&quot;#000000&quot; LETTERSPACING=&quot;0&quot; KERNING=&quot;0&quot;&gt;A new salesperson and contact record have been created. The last step is to activate the User by:&lt;/FONT&gt;&lt;/DIV&gt;&lt;DIV ALIGN=&quot;LEFT&quot;&gt;&lt;FONT FACE=&quot;Arial&quot; STYLE=&quot;font-size:12px&quot; COLOR=&quot;#000000&quot; LETTERSPACING=&quot;0&quot; KERNING=&quot;0&quot;&gt;&lt;/FONT&gt;&lt;/DIV&gt;&lt;TEXTFORMAT LEADING=&quot;2&quot;&gt;&lt;LI&gt;&lt;FONT FACE=&quot;Arial&quot; STYLE=&quot;font-size:12px&quot; COLOR=&quot;#000000&quot; LETTERSPACING=&quot;0&quot; KERNING=&quot;0&quot;&gt;1) Clicking on the &amp;quot;Manage External User&amp;quot; button on the contact, and selecting &amp;quot;Enable Partner User&amp;quot;. At that point, you will be able to choose the Role and License Type. To go to the Contact for this new user and activate them, open this link in a new tab: &lt;FONT COLOR=&quot;#FF0033&quot;&gt;&lt;A HREF=&quot;http://na54.salesforce.com/{!ContactID}&quot; TARGET=&quot;_blank&quot;&gt;&lt;B&gt;&lt;U&gt;CLICK HERE&lt;/U&gt;&lt;/B&gt;&lt;/A&gt;&lt;/FONT&gt;&lt;/FONT&gt;&lt;/LI&gt;&lt;/TEXTFORMAT&gt;&lt;DIV ALIGN=&quot;LEFT&quot;&gt;&lt;FONT FACE=&quot;Arial&quot; STYLE=&quot;font-size:12px&quot; COLOR=&quot;#000000&quot; LETTERSPACING=&quot;0&quot; KERNING=&quot;0&quot;&gt; &lt;/FONT&gt;&lt;/DIV&gt;&lt;TEXTFORMAT LEADING=&quot;2&quot;&gt;&lt;LI&gt;&lt;FONT FACE=&quot;Arial&quot; STYLE=&quot;font-size:12px&quot; COLOR=&quot;#000000&quot; LETTERSPACING=&quot;0&quot; KERNING=&quot;0&quot;&gt;2) Send the onboarding email. After activating the user, they need to receive a Welcome email. This can be done automatically by selecting &amp;quot;Send Email&amp;quot;. If you would like to send the email yourself, select &amp;quot;Don&amp;apos;t Send Email&amp;quot;. Then Click Next.&lt;/FONT&gt;&lt;/LI&gt;&lt;/TEXTFORMAT&gt;&lt;DIV ALIGN=&quot;LEFT&quot;&gt;&lt;FONT FACE=&quot;Arial&quot; STYLE=&quot;font-size:12px&quot; COLOR=&quot;#000000&quot; LETTERSPACING=&quot;0&quot; KERNING=&quot;0&quot;&gt;&lt;/FONT&gt;&lt;/DIV&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <fields>
            <name>Do_you_want_to_send_the_setup_email_to_the_Salesperson</name>
            <choiceReferences>Send_Email</choiceReferences>
            <choiceReferences>Don_t_Send_Email</choiceReferences>
            <dataType>String</dataType>
            <defaultSelectedChoiceReference>Don_t_Send_Email</defaultSelectedChoiceReference>
            <fieldText>Do you want to send the setup email to the Salesperson?</fieldText>
            <fieldType>DropdownBox</fieldType>
            <isRequired>false</isRequired>
        </fields>
        <showFooter>true</showFooter>
        <showHeader>true</showHeader>
    </screens>
    <screens>
        <name>Finished</name>
        <label>Finished</label>
        <locationX>987</locationX>
        <locationY>439</locationY>
        <allowBack>true</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>true</allowPause>
        <fields>
            <name>finishedNoEmail</name>
            <fieldText>The Salesperson has sucessfully set up. The onboarding email has not been sent, so remember to send it manually! Click Finish.</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <showFooter>true</showFooter>
        <showHeader>true</showHeader>
    </screens>
    <screens>
        <name>FinishedwithEmail</name>
        <label>FinishedwithEmail</label>
        <locationX>389</locationX>
        <locationY>663</locationY>
        <allowBack>false</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>true</allowPause>
        <fields>
            <name>ending</name>
            <fieldText>You&apos;ve successfully set up and emailed this salesperson! Click finished.</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <showFooter>true</showFooter>
        <showHeader>true</showHeader>
    </screens>
    <screens>
        <name>Information_Input</name>
        <label>Information Input</label>
        <locationX>94</locationX>
        <locationY>105</locationY>
        <allowBack>true</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>true</allowPause>
        <connector>
            <targetReference>Create_New_Salesperson</targetReference>
        </connector>
        <fields>
            <name>generalinfo</name>
            <fieldText>This process will create the appropriate Salesperson, Contact, and User records needed to set up a new partner portal user. You will have the option to send an automated welcome email, or to manually send an email on your own. After this is finished, you will have to activate the user on their Contact page.

Please fill in the information for the new user below. Once you are done, click Next.</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <fields>
            <name>FirstName</name>
            <dataType>String</dataType>
            <fieldText>First Name</fieldText>
            <fieldType>InputField</fieldType>
            <isRequired>true</isRequired>
        </fields>
        <fields>
            <name>Last_Name</name>
            <dataType>String</dataType>
            <fieldText>Last Name</fieldText>
            <fieldType>InputField</fieldType>
            <isRequired>true</isRequired>
        </fields>
        <fields>
            <name>Email</name>
            <dataType>String</dataType>
            <fieldText>Email</fieldText>
            <fieldType>InputField</fieldType>
            <isRequired>true</isRequired>
        </fields>
        <fields>
            <name>Title</name>
            <dataType>String</dataType>
            <fieldText>Title</fieldText>
            <fieldType>InputField</fieldType>
            <isRequired>true</isRequired>
        </fields>
        <fields>
            <name>Phone</name>
            <dataType>String</dataType>
            <fieldText>Phone</fieldText>
            <fieldType>InputField</fieldType>
            <isRequired>true</isRequired>
        </fields>
        <fields>
            <name>usernameinfo</name>
            <fieldText>Remember: The username must be unique.</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <fields>
            <name>Username</name>
            <dataType>String</dataType>
            <fieldText>Username</fieldText>
            <fieldType>InputField</fieldType>
            <helpText>This should be in the format name@bluewavesolar.com.</helpText>
            <isRequired>true</isRequired>
        </fields>
        <fields>
            <name>State_Market</name>
            <choiceReferences>Northeast</choiceReferences>
            <choiceReferences>Southeast</choiceReferences>
            <dataType>String</dataType>
            <fieldText>State Market</fieldText>
            <fieldType>DropdownBox</fieldType>
            <helpText>This is for determining which Sales Manager gets CCed on the activation/onboarding email.</helpText>
            <isRequired>false</isRequired>
        </fields>
        <showFooter>true</showFooter>
        <showHeader>true</showHeader>
    </screens>
    <startElementReference>Information_Input</startElementReference>
    <variables>
        <name>ContactID</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>contacttypeID</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
    </variables>
    <variables>
        <name>partneraccountid</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
    </variables>
    <variables>
        <name>PartnerAccountName</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
    </variables>
    <variables>
        <description>This is the PartnerID pulled in throught the URL</description>
        <name>PartnerID</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
    </variables>
    <variables>
        <name>PartnerName</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
    </variables>
    <variables>
        <name>SalespersonID</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>UserID</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
    </variables>
</Flow>
