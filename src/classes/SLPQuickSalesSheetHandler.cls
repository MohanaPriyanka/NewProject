/*************************************************************************************
 + * Created By:  Jordan Pentaleri 
 + * This class is used to aid the QuickSalesSheet component in the SLP portal. 
 + * It loads a list of products, inserts a new Quick Sales Sheet Record, and returns
 + * the public url that is generated by the FileDeliveryHandler class. 
 + * 
 + * Tested By: SLPQuickSalesSheetTestclass
 + *************************************************************************************/


public without sharing class SLPQuickSalesSheetHandler{

    public static SLPUserHelper.PartnerProfile partnerinfo = new SLPUserHelper.PartnerProfile();
    static {
        partnerinfo = SLPUserHelper.getPartnerProfile();
    }

    @AuraEnabled
    public static Quick_Sales_Sheet__c addNewQSS (Quick_Sales_Sheet__c newQSS, Boolean generateDoc) {
        if(generateDoc) {
            newQSS.Generate_Doc__c = TRUE;
        }
        Partner__c partnerLogo = [SELECT Id, Name, Logo__c FROM Partner__c WHERE Id = : partnerinfo.partnerId];
        newQSS.Partner_Logo_File_Name__c = partnerLogo.Logo__c;
        insert newQSS;
        return newQSS;
    }

    @AuraEnabled
    public static List<Product2> getActiveProducts () {
        
        List<String> marketsList = partnerinfo.partnerMarkets.split(';',15);

        List<Product2> productList = [SELECT Id, Name 
                                      FROM Product2 
                                      WHERE Product_Type__c = 'Residential Loan'
                                      AND isActive = true
                                      AND State__c IN : marketsList
                                      ORDER BY State__c, Loan_Term__c];                                                                       
        return productList;   
    }

    @AuraEnabled
    public static Quick_Sales_Sheet__c updateQSS (Quick_Sales_Sheet__c updatedQSS) {
        updatedQSS.Generate_Doc__c = TRUE;
        update updatedQSS;
        return updatedQSS;
    }


    @AuraEnabled
    public static Quick_Sales_Sheet__c getQuickSalesSheet (Id newlycreatedQSSid) {
        Quick_Sales_Sheet__c qss  = [   SELECT Link_to_File__c, Monthly_Payment_After_Buydown__c, Monthly_Payment__c,
                                        ITC_Estimated__c, Total_Loan_Payments__c, Loan_Payments__c, Loan_Amount__c,
                                        Interest_Only_Payments__c, Interest_Payment__c
                                        FROM Quick_Sales_Sheet__c 
                                        WHERE Id = : newlycreatedQSSid Limit 1];

        return qss;
    }

}