/*************************************************************************************
 * Created By:  Jordan Pentaleri
 * This class is used to aid the QuickSalesSheet component in the SLP portal.
 * It loads a list of products, inserts a new Quick Sales Sheet Record, and returns
 * the public url that is generated by the FileDeliveryHandler class.
 *
 * Tested By: SLPQuickSalesSheetTestclass
 *************************************************************************************/


public without sharing class SLPQuickSalesSheetHandler {
    public static SLPUserHelper.PartnerProfile partnerinfo = new SLPUserHelper.PartnerProfile();
    static {
        partnerinfo = SLPUserHelper.getPartnerProfile();
    }

    @AuraEnabled
    public static Quick_Sales_Sheet__c addNewQSS (Quick_Sales_Sheet__c newQSS, Boolean generateDoc) {
        newQSS.Generate_Doc__c = generateDoc;
        List<String> partnerlogotwo = SLPUserHelper.getPartnerLogo();
        newQSS.Partner_Logo_File_Name__c = partnerlogotwo.get(0);
        insert newQSS;
        return newQSS;
    }

    @AuraEnabled
    public static List<Product2> getActiveProducts() {
        return Util.getActiveProductsIncludingHidden(partnerinfo.partnerMarkets.split(';',15), partnerinfo.partnerId, 'Residential Loan');
    }

    @AuraEnabled
    public static Quick_Sales_Sheet__c updateQSS (Quick_Sales_Sheet__c updatedQSS,  Boolean generateDoc, Boolean modifiedTax) {
        updatedQSS.Generate_Doc__c = generateDoc;
        updatedQSS.Tax_Credit_Modified_by_Partner__c = modifiedTax;
        update updatedQSS;
        return updatedQSS;
    }

    @AuraEnabled
    public static Quick_Sales_Sheet__c getQuickSalesSheet(Id newlycreatedQSSid) {
        Quick_Sales_Sheet__c qss  = [   SELECT Link_to_File__c, Monthly_Payment_After_Buydown__c, Monthly_Payment__c,
                                        ITC_Estimated__c, Total_Loan_Payments__c, Loan_Payments__c, Loan_Amount__c,
                                        Interest_Only_Payments__c, Interest_Payment__c, State_Tax_Incentive_Bool__c,
                                        State_Tax_Incentive__c, Modified_State_Tax_Credit__c, Modified_ITC__c,
                                        Product__c, Product__r.Name, System_Size__c, System_Cost__c, Down_Payment__c, Send_to_Email__c
                                        FROM Quick_Sales_Sheet__c 
                                        WHERE Id = : newlycreatedQSSid Limit 1];

        return qss;
    }
}
