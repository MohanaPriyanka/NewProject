/*************************************************************************************
 * Created By: peteryao on 1/20/19  
 * Description: 
 * Tested By: UASSelectorTest
 *************************************************************************************/
@SuppressWarnings('PMD.ApexCRUDViolation')
public without sharing class UASSelector {
    public static List<Utility_Account_Subscription__c> selectByAccounts(Set<Id> accounts) {
        return [
            SELECT Id,
                Utility_Account_Log__r.Account__c,
                Utility_Account_Log__r.Account__r.Id,
                Utility_Account_Log__r.Account__r.Name,
                Utility_Account_Log__r.Account__r.Cancellation_Comments__c,
                Utility_Account_Log__r.Account__r.Send_Bills_Contact__c,
                Utility_Account_Log__r.Account__r.Send_Bills_Contact__r.Email,
                Utility_Account_Log__r.Account__r.Send_Bills_Contact__r.FirstName,
                Utility_Account_Log__r.Account__r.Send_Bills_Contact__r.Additional_Email__c,
                Utility_Account_Log__r.Account__r.Additional_Contact__r.Email,
                Opportunity__r.Product__r.Cancellation_Paragraph_Two__c,
                Opportunity__r.Product__r.Cancellation_Paragraph_Three__c
            FROM Utility_Account_Subscription__c
            WHERE Utility_Account_Log__r.Account__c = :accounts
        ];
    }

    public static List<Utility_Account_Subscription__c> selectByUAL(Set<Id> ualIds) {
        return [
            SELECT Id,
                Utility_Account_Log__c,
                Utility_Account_Log__r.Name,
                Utility_Account_Log__r.Account__c,
                Utility_Account_Log__r.Account__r.Id,
                Utility_Account_Log__r.Account__r.Name,
                Utility_Account_Log__r.Account__r.Send_Bills_Contact__c,
                Utility_Account_Log__r.Account__r.Parent_Account__c
            FROM Utility_Account_Subscription__c
            WHERE Utility_Account_Log__c IN :ualIds
        ];
    }

    public static List<Utility_Account_Subscription__c> selectByIds(Set<Id> uasIds) {
        return [
            SELECT Id,
                Name,
                Opportunity__c,
                Opportunity__r.Id,
                Opportunity__r.Shared_Solar_System__r.Id
            FROM Utility_Account_Subscription__c
            WHERE Id IN :uasIds
        ];
    }

    public static Map<Id, Utility_Account_Subscription__c> selectByIdsAsMap(Set<Id> uasIds){
        Map<Id, Utility_Account_Subscription__c> uasWithClientMap = new Map<Id, Utility_Account_Subscription__c>([
            SELECT Id,
                Opportunity__r.Shared_Solar_System__r.BWC_Project_Entity_Manual__r.Client_Account__c,
                Externally_Serviced__c
            FROM Utility_Account_Subscription__c
            WHERE Id IN : uasIds
        ]);
        return uasWithClientMap;
    }

    public List<AggregateResult> getBrandKeySummary(Set<Id> parentAccountIds) {
        List<AggregateResult> uasSummary = [
            SELECT COUNT(Id) numberOfRecords,
                Opportunity__r.AccountId propertyAccount,
                Opportunity__r.Account.Parent_Account__c parentAccount,
                Opportunity__r.Shared_Solar_System__r.Client_Brand_Key__c sssBrandKey,
                Opportunity__r.Shared_Solar_System__r.BWC_Project_Entity_Manual__r.Client_Account__r.Client_Brand_Key__c entityBrandKey
            FROM Utility_Account_Subscription__c
            WHERE Opportunity__r.Account.Parent_Account__c IN : parentAccountIds
            GROUP BY Opportunity__r.AccountId,
                Opportunity__r.Account.Parent_Account__c,
                Opportunity__r.Shared_Solar_System__r.Client_Brand_Key__c,
                Opportunity__r.Shared_Solar_System__r.BWC_Project_Entity_Manual__r.Client_Account__r.Client_Brand_Key__c
        ];
        return uasSummary;
    }

    public List<Utility_Account_Subscription__c> selectActiveUASBySSS(Set<Id> sssIdList) {
        return [
            SELECT Id, Opportunity_Stage__c, Customer_Group__c,
                Opportunity__c, Next_Schedule_Z_Status__c, Shared_Solar_System__c,
                Customer_Subscription_KW_DC__c
            FROM Utility_Account_Subscription__c
            WHERE Shared_Solar_System__c IN : sssIdList
            AND Next_Schedule_Z_Status__c = 'Active Subscription'
        ];
    }
}