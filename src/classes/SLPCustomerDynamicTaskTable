<aura:component implements="forceCommunity:availableForAllPageTypes" controller="SLPCustomerHandler" access="global">
    <aura:attribute name="loanList" type="Object"  /> 
    <aura:attribute name="customer" type="Object"  />   
    <aura:attribute name="taskType" type="String" access="global" />
    <aura:attribute name="parentSubTaskButton" type="Boolean"  /> 
    <aura:attribute name="partnerTaskList" type="Object"  />
    <aura:attribute name="parentSubTaskList" type="Object"  /> 
    <aura:attribute name="subTaskList" type="Object"  />
    <aura:attribute name="customerWindowLoanList" type="Object"  /> 
    <aura:attribute name="customerWindowTaskList" type="Object"  />  
	<aura:attribute name="taskMap" type="Map"  />      
    <aura:attribute name="disbursalList" type="Object"  />
    <aura:attribute name="taskViewButtonToggle" type="Boolean"  />
	<aura:registerEvent name="customerEvent" type="c:SLPCustomerEvent"/>    
    <aura:handler event="c:SLPDashboardEvent" action="{!c.openCustomerWindow}" />  
    <aura:handler name="init" value="{!this}" action="{!c.doInit}" />  
<!-- main issues inclue the ability to break out subTasks within the task table. The tasks break out for each task with subTasks, filtering them by 
task type has been proven difficult due to sequence of the attribute's value after the loading of the subTasks and lock up of functionality 
when task is selected that doesn't equal the hard-coded value of task type. <Span> is also a solution that solves the framework error for 
accessing the attribute when unaccessible (this is a framework error) however it throws off the whole chart. The other issue is with regards to the 
view and canacel button. There is a rendering issue with making them dissapear and appear correctly. It only occurs when the task list is 
reloaded by clicking the view button on the dashboard page-->        
    <div aura:id = "customerPage" class="noDisplayBar"> 	
        <div aura:id="customerName" class="main2"> 
            <div  class="center"><h2> {!v.customer.Name} </h2></div>
            <br></br>    
        </div>
        <br></br>
        
          <div aura:id="taskBar" class="slds-wizard" role="navigation">    
          <ol class="slds-wizard__list">
            <li aura:id="credit" class="slds-wizard__item">
              <a href="javascript:void(0);" class="slds-wizard__link">
                <span class="slds-wizard__marker"></span>
                <span class="slds-wizard__label slds-text-title--caps slds-truncate" 
                      title="Navigation">Credit</span>
              </a>
            </li>          
            <li aura:id="systemInfo" class="slds-wizard__item">
              <a href="javascript:void(0);" class="slds-wizard__link">
                <span class="slds-wizard__marker"></span>
                <span class="slds-wizard__label slds-text-title--caps slds-truncate" 
                      title="Navigation">Information</span>
              </a>
            </li>
            <li aura:id="bwReview" class="slds-wizard__item">
              <a href="javascript:void(0);" class="slds-wizard__link">
                <span class="slds-wizard__marker"></span>
                <span class="slds-wizard__label slds-text-title--caps slds-truncate" 
                      title="Actions">Review</span>
              </a>
            </li>              
            <li aura:id="contract" class="slds-wizard__item">
              <a href="javascript:void(0);" class="slds-wizard__link">
                <span class="slds-wizard__marker"></span>
                <span class="slds-wizard__label slds-text-title--caps slds-truncate" 
                      title="Actions">Contract</span>
              </a>
            </li>
            <li aura:id="mechInstall" class="slds-wizard__item">
              <a href="javascript:void(0);" class="slds-wizard__link">
                <span class="slds-wizard__marker"></span>
                <span class="slds-wizard__label slds-text-title--caps slds-truncate" 
                      title="Compact Layout">Install</span>
              </a>
            </li>
            <li aura:id="interconnection" class="slds-wizard__item">
              <a href="javascript:void(0);" class="slds-wizard__link">
                <span class="slds-wizard__marker"></span>
                <span class="slds-wizard__label slds-text-title--caps slds-truncate" 
                      title="Review">Interconnect</span>
              </a>
            </li>
            <li aura:id="complete" class="slds-wizard__item">
              <a href="javascript:void(0);" class="slds-wizard__link">
                <span class="slds-wizard__marker"></span>
                <span class="slds-wizard__label slds-text-title--caps slds-truncate" 
                      title="Invite">Complete</span>
              </a>
            </li>
          </ol>
          <span class="slds-wizard__progress">
            <span aura:id="progressBar" class="slds-wizard__progress-bar"></span>
          </span>
        </div>
      	<div>
        <br></br>
        <br></br>
        <table class="slds-table slds-table--bordered  slds-table--striped box">
          <thead>
            <tr class="slds-text-heading--label  " >           
              <th scope="col"><span class="slds-truncate"><b>Agent</b></span></th>
              <th scope="col"><span class="slds-truncate"><b>Product</b></span></th>
              <th scope="col"><span class="slds-truncate"><b>System Cost</b></span></th>
              <th scope="col"><span class="slds-truncate"><b>Funded</b></span></th>
            </tr>
          </thead>
          <tbody>
              <tr>
                <th scope="row"> <b>{!v.customer.Sales_Agent__r.Name}</b> </th>  
                <th scope="row"> <b>{!v.customer.Product__r.ProductCode}</b> </th>
                <th scope="row"> <ui:outputCurrency value="{!v.customer.System_Costt__c}" /></th>    
                <th scope="row"> <ui:outputCurrency class="proximaNovaDataGreenSmall" value="{!v.customer.Total_Funds_Disbursed__c}" /></th>                
              </tr>          
          </tbody>
        </table>  
        <br></br> 
		<br></br>            
        <table aura:id="taskTable" class="slds-table slds-table--bordered slds-table--striped  box ">
          <thead>
            <tr class="slds-text-heading--label " >
              <th scope="col"><span class="slds-truncate"><b>Task</b></span></th> 
              <th scope="col"><span class="slds-truncate"><b>Status</b></span></th>              
              <th scope="col"><span class="slds-truncate"><b>Completion Date</b></span></th>              
              <th scope="col"><span aura:id = "viewParentSubTasks" class="slds-truncate"><b>Sub-Tasks</b></span></th>
              </tr>
          </thead>
          <tbody>
 			<aura:iteration items="{!v.partnerTaskList}" var="task">
                <tr>
                    <th scope="row"> <b>{!task.Name}</b> </th>                       
                    <th scope="row"> <b>{!task.Status__c}</b> </th>
                    <th scope="row"> <b>{!task.Completion_Date__c}</b> </th>
                    <aura:if isTrue="{!task.SubTasks__c}"> 
                        <th>                           
                           <ui:button aura:id="viewButton"
                               label="View"           
                               class=""
                               labelClass="{!task.Id}"          
                               press="{!c.openParentSubTasks}"/>
                           <ui:button aura:id="closeButton"        
                               label="Close"
                               class=""
                               labelClass="{!task.Id}"
                               press="{!c.exitParentSubTasks}"/>
                        </th>
                        <aura:set attribute="else">
                            <th>
                                <ui:button disabled="true" />
                            </th>
                        </aura:set>                              
                    </aura:if>
                </tr>                
			<aura:if isTrue="{!task.SubTasks__c}">         
                <aura:iteration items="{!v.parentSubTaskList}" var="parentSubTask">
                    <!--<aura:if isTrue="{!task.Task_Type__c == !v.taskType}">-->
                    <tr>
                        <th scope="row" class="slds-text-align--left bwbluePaddingRight"> <b>{!parentSubTask.Name}</b></th>                       
                        <th scope="row"> <b>{!parentSubTask.Status__c}</b> </th>
                        <th scope="row"> <b>{!parentSubTask.Completion_Date__c}</b> </th>
                        <aura:if isTrue="{!parentSubTask.SubTasks__c}">                        
                            <th>                           
                               <ui:button aura:id="viewButtonParentSubTask"
                                   label="View"           
                                   class=""
                                   labelClass="{!parentSubTask.Id}"          
                                   press="{!c.openSubTasks}"/>
                               <ui:button aura:id="closeButtonParentSubTask"        
                                   label="Close"
                                   class=""
                                   labelClass="{!parentSubTask.Id}"
                                   press="{!c.exitSubTasks}"/>
                            </th>                                                          
                            <aura:set attribute="else">
                                <th>
                                    <ui:button disabled="true" />
                                </th>
                            </aura:set> 
                    	</aura:if> 
                    </tr>                    
					<aura:if isTrue="{!parentSubTask.SubTasks__c}">                
                        <aura:iteration items="{!v.subTaskList}" var="subTask">
                            <tr>
                                <th scope="row" class="slds-text-align--left bwTeal"> <b>{!subTask.Name}</b></th>                       
                                <th scope="row"> <b>{!subTask.Status__c}</b> </th>
                                <th scope="row"> <b>{!subTask.Completion_Date__c}</b> </th>
                                <th scope="row"></th>
                            </tr>                    
                        </aura:iteration>                     
           		 	</aura:if> 
				<!--</aura:if>-->                                                                                                                     
            	</aura:iteration>                     
            </aura:if>                
            </aura:iteration>             
          </tbody>
        </table>                      
        </div>
        <div>
        <br></br>                                 
        <table aura:id="disbursalTable" class="slds-table slds-table--bordered  slds-table--striped box ">
          <thead>
            <tr class="slds-text-heading--label " >
              <th scope="col"><span class="slds-truncate"><b>Disbursal</b></span></th>   
              <th scope="col"><span class="slds-truncate"><b>Amount</b></span></th>              
              <th scope="col"><span class="slds-truncate"><b>Status</b></span></th>
              <th scope="col"><span class="slds-truncate"><b>Date</b></span></th>                         
              </tr>
          </thead>
          <tbody>
 			<aura:iteration items="{!v.disbursalList}" var="disbursal">
              		<tr>
                		<th scope="row"> <b>{!disbursal.Name}</b> </th>
                    	<th scope="row"> <ui:outputCurrency class="proximaNovaDataGreenSmall" value="{!disbursal.Amount__c}" /></th>                          
                		<th scope="row"> <b>{!disbursal.Status__c}</b> </th>
                        <th scope="row"> <b>{!disbursal.Date_of_Disbursal__c}</b> </th>    
                  		<td> <div class="slds-form-element">
                    		<label class="slds-checkbox--toggle slds-grid">
                        		<input name="checkbox" type="checkbox" aria-describedby="toggle-desc" />
                        		<span id="toggle-desc" class="slds-checkbox--faux_container" aria-live="assertive">
                                <span class="slds-checkbox--faux"></span>
                                <span class="slds-checkbox--on">Confirmed</span>
                                <span class="slds-checkbox--off">Unconfirmed</span>
                        </span>
                    </label>
                    </div>
                </td>                        
                    </tr>                    
            </aura:iteration>          
          </tbody>
        </table>               
   	 </div>        
    	<div>
            <br></br>
            <br></br>
            <lightning:button aura:id="exitCustomerWindow" 
              variant="brand" 
              class="proximaNova" 
              label="Exit" 
              onclick="{! c.exitCustomerWindow }" />    
    	</div>        
    </div>    
</aura:component>