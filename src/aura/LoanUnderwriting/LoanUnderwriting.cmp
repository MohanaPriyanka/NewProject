<aura:component controller="LoanUnderwriting">
  <ltng:require scripts="{!$Resource.jQuery}"/>

  <aura:handler name="init" value="{!this}" action="{!c.doInit}" />
  <aura:registerEvent name="apexErrorEvent" type="c:ApexCallbackError"/>
  <aura:attribute name="leadId" type="String"/>
  <aura:attribute name="lead" type="Lead"/>
  <aura:attribute name="pcr" type="LASERCA__Personal_Credit_Report__c"/>
  <aura:attribute name="bestFICO" type="Integer"/>
  <aura:attribute name="bestDTI" type="Decimal"/>
  <aura:attribute name="combinedIncome" type="Decimal"/>
  <!-- These attributes support the modal dialog that shows the really wide Adverse Credit Notice picklist -->
  <aura:attribute name="isOpen" type="Boolean" default="false"/>
  <aura:attribute name="adverseObject" type="String"/>
  <aura:attribute name="adverseField" type="String"/>
  <aura:attribute name="adverseValue" type="String"/>

  <aura:if isTrue="{!v.isOpen}">
    <div role="dialog" tabindex="-1" aria-labelledby="header99" class="slds-modal slds-fade-in-open slds-modal_large">
      <div class="slds-modal__container">
        <div class="slds-modal__header">
          <button class="slds-button slds-modal__close slds-button--icon-inverse" title="Close" onclick="{!c.closeModel}">
            X
            <span class="slds-assistive-text">Close</span>
          </button>
          <h2 class="slds-text-heading--medium">Adverse Credit Notice to Consumer</h2>
        </div>
        <div class="slds-modal__content slds-p-around--medium">
          <ui:inputSelect class="dynamic" aura:id="AdverseCreditNotice" value="{!v.adverseValue}" required="true"/>
        </div>
        <div class="slds-modal__footer">
          <button class="slds-button slds-button--neutral" onclick="{!c.closeModel}" >Cancel</button>
          <button class="slds-button slds-button--brand" onclick="{!c.closeAndSaveModel}">Save</button>
        </div>
      </div>
    </div>
    <div class="slds-backdrop slds-backdrop--open"></div>
  </aura:if>

  <h1 class="slds-page-header__title slds-align_absolute-center slds-border_bottom" title="Customer Name">
    <ui:outputText value="{!v.lead.Name}"/>
  </h1>

  <div class="slds-align_absolute-center slds-border_bottom">
    <lightning:buttonGroup>
      <lightning:button label="Save Changes" />
      <lightning:button label="Send Main Applicant Credit Decline" onclick="{!c.emailCreditDecline}" disabled="{!v.lead.Manual_Credit_Decline__c}"/>
      <lightning:button label="Send Co-App Credit Decline" onclick="{!c.emailCoAppCreditDecline}" disabled="{!v.lead.Co_App_Manual_Credit_Decline__c}"/>
    </lightning:buttonGroup>
  </div>
  
  <table class="slds-border_bottom slds-m-top_xx-small slds-m-bottom_xx-small" border="0">
    <tr>
      <td width="33%">
        <div class="slds-align_absolute-center">
          <b>Product: &nbsp; </b> <ui:outputText value="{!v.lead.Product__r.Name}"/>
        </div>
      </td>      
      <td width="33%">
        <div class="slds-align_absolute-center">
          <b>Min FICO: &nbsp;</b> <ui:outputText value="{!v.lead.Product__r.Credit_Minimum__c}"/>
        </div>
      </td>
      <td width="33%">
        <div class="slds-align_absolute-center">
          <b> Max DTI: &nbsp;</b> <ui:outputText value="{!v.lead.Product__r.Debt_To_Income_Maximum__c}"/>%
        </div>
      </td>
    </tr>
  </table>

  <div class= "cellDivWhiteHeader">
    <div class = "slds-box slds-text-heading_small">
      <strong>Avidia Review Status:
        <ui:inputSelect class="dynamic" aura:id="AvidiaReviewStatus" value="{!v.lead.Personal_Credit_Report__r.Avidia_Review_Status__c}" required="true" change="{!c.updateReviewStatus}"/></strong>
    </div>
  </div>

  <div class = "cellDiv">
    <div class = "table">
      <div class = "tableRowEven">
        <div class = "tableCell">
          Loan Amount Requested: 
        </div>
        <div class = "tableCell">
          System Cost:
        </div>
      </div>
      <div class = "tableRowOdd">
        <div class = "tableCell">
          Approval Status: <ui:inputSelect class="dynamic" aura:id="SolarLoanApprovalStatus" value="{!v.lead.Personal_Credit_Report__r.Solar_Loan_Approval_Status__c}" required="true" change="{!c.updateSLApprovalStatus}"/>
        </div>
        <div class = "tableCell">
        </div>
      </div>
      <div class = "tableRowEven">
        <div class = "tableCell">
          FICO:<ui:outputText value="{!v.bestFICO}"/>
        </div>
        <div class = "tableCell">
          DTI: <ui:outputText value="{!v.bestDTI}"/>
        </div>
      </div>
      <div class = "tableRowOdd">
        <div class = "tableCell">
        </div>
        <div class = "tableCell">
          Combined Income:  <ui:outputText value="{!v.combinedIncome}"/>
        </div>
      </div>
    </div>
  </div>  

  <br></br>

  <div class = "containerDiv">
    <div class= "cellDivHeader">
      <div class = "slds-box slds-align_absolute-center slds-theme_info">
        <p> <b> Main Applicant </b></p>
      </div>
    </div>
    <div class = "cellDivHeader">
      <div class = "slds-box slds-align_absolute-center slds-theme_info">
        <p> <b> Co Applicant </b></p>
      </div>
    </div>


    <!-- CREDIT ROW -->
    <div class = "rowDiv">
      <!-- APPLICANT: -->
      <div class = "cellDiv">
        <br></br>
        <div class = "slds-box slds-box_small slds-align_absolute-center slds-size_1-of-2 slds-theme_default ">
          <b>Credit</b>
        </div>
        <br></br>

        <div class = "table">
          <div class = "tableRowEven">
            <div class = "tableCellLong">
              Link to Personal Credit Report:<ui:outputURL value="{!'/' + v.lead.Personal_Credit_Report__r.Id}" label="{!v.lead.Personal_Credit_Report__r.Name}" target="_blank"/>
            </div>
          </div>
          <div class = "tableRowOdd">
            <div class = "tableCell">
              FICO: <ui:outputText value="{!v.lead.Personal_Credit_Report__r.LASERCA__Credit_Score_TransUnion__c}"/>
            </div> 
          </div>
          <div class = "tableRowEven">
            <div class = "tableCell">
              <lightning:input type="checkbox" disabled="true" label="Adverse Credit Notice Sent" name="AdverseCreditCheckbox" checked="{!v.lead.Manual_Credit_Decline__c}"/>
            </div>
          </div>
          <div class = "tableRowOdd">
            <div class = "tableCell">
              Adverse Credit Notices:
            </div>
          </div>
        </div>  

        <div class = "table">
          <div class = "tableRowOdd">
            <div class = "tableCell25px">
            </div> 
            <div class = "tableCell">
              Code
            </div> 
            <div class = "tableCell">
              Detail
            </div> 
            <div class = "tableCell">
              Adverse Credit Notice
            </div> 
          </div>
          <div class = "tableRowEven">
            <div class = "tableCell25px">
              1
            </div> 
            <div class = "tableCell">
              <ui:outputText value="{!v.lead.Personal_Credit_Report__r.LASERCA__Code__c}"/>
            </div> 
            <div class = "tableCell">
              <ui:outputText value="{!v.lead.Personal_Credit_Report__r.LASERCA__Detail_1__c}"/>
            </div> 
            <div class = "tableCell">
              <ui:outputText value="{!v.lead.Personal_Credit_Report__r.Adverse_Credit_Notice_1__c}"/>
              &nbsp;[<a href="#" onclick="{!c.openModel}" data-objectname="Personal_Credit_Report__r" data-fieldname="Adverse_Credit_Notice_1__c">Change</a>]
            </div> 
          </div>
          <div class = "tableRowOdd">
            <div class = "tableCell25px">
              2
            </div> 
            <div class = "tableCell">
              <ui:outputText value="{!v.lead.Personal_Credit_Report__r.LASERCA__Code_2__c}"/>
            </div> 
            <div class = "tableCell">
              <ui:outputText value="{!v.lead.Personal_Credit_Report__r.LASERCA__Detail_2__c}"/>
            </div> 
            <div class = "tableCell">
              <ui:outputText value="{!v.lead.Personal_Credit_Report__r.Adverse_Credit_Notice_2__c}"/>
              &nbsp;[<a href="#" onclick="{!c.openModel}" data-objectname="Personal_Credit_Report__r" data-fieldname="Adverse_Credit_Notice_2__c">Change</a>]
            </div> 
          </div>
          <div class = "tableRowEven">
            <div class = "tableCell25px">
              3
            </div> 
            <div class = "tableCell">
              <ui:outputText value="{!v.lead.Personal_Credit_Report__r.LASERCA__Code_3__c}"/>
            </div> 
            <div class = "tableCell">
              <ui:outputText value="{!v.lead.Personal_Credit_Report__r.LASERCA__Detail_3__c}"/>
            </div> 
            <div class = "tableCell">
              <ui:outputText value="{!v.lead.Personal_Credit_Report__r.Adverse_Credit_Notice_3__c}"/>
              &nbsp;[<a href="#" onclick="{!c.openModel}" data-objectname="Personal_Credit_Report__r" data-fieldname="Adverse_Credit_Notice_3__c">Change</a>]
            </div> 
          </div>
        </div>
      </div>


      <!-- CO APPLICANT: -->
      <div class = "cellDiv">
        <br></br>
        <div class = "slds-box slds-box_small slds-align_absolute-center slds-size_1-of-2 slds-theme_default">
          <b>Credit</b>
        </div>
        <br></br>

        <div class = "table">
          <div class = "tableRowEven">
            <div class = "tableCellLong">
              Link to Personal Credit Report:<ui:outputURL value="{!'/' + v.lead.Personal_Credit_Report_Co_Applicant__r.Id}" label="{!v.lead.Personal_Credit_Report_Co_Applicant__r.Name}" target="_blank"/>
            </div>
          </div>
          <div class = "tableRowOdd">
            <div class = "tableCell">
              FICO: <ui:outputText value="{!v.lead.Personal_Credit_Report_Co_Applicant__r.LASERCA__Credit_Score_TransUnion__c}"/>
            </div> 
          </div>
          <div class = "tableRowEven">
            <div class = "tableCell">
              <lightning:input type="checkbox" disabled="true" label="Adverse Co App Credit Notice Sent" name="AdverseCoAppCreditCheckbox" checked="{!v.lead.Co_App_Manual_Credit_Decline__c}"/>
            </div>
          </div>
          <div class = "tableRowOdd">
            <div class = "tableCell">
              Adverse Credit Notices:
            </div>
          </div>
        </div>  

        <div class = "table">
          <div class = "tableRowOdd">
            <div class = "tableCell25px">
            </div> 
            <div class = "tableCell">
              Code
            </div> 
            <div class = "tableCell">
              Detail
            </div> 
            <div class = "tableCell">
              Adverse Credit Notice
            </div> 
          </div>
          <div class = "tableRowEven">
            <div class = "tableCell25px">
              1
            </div> 
            <div class = "tableCell">
              <ui:outputText value="{!v.lead.Personal_Credit_Report_Co_Applicant__r.LASERCA__Code__c}"/>
            </div> 
            <div class = "tableCell">
              <ui:outputText value="{!v.lead.Personal_Credit_Report_Co_Applicant__r.LASERCA__Detail_1__c}"/>
            </div> 
            <div class = "tableCell">
              <ui:outputText value="{!v.lead.Personal_Credit_Report_Co_Applicant__r.Adverse_Credit_Notice_1__c}"/>
              &nbsp;[<a href="#" onclick="{!c.openModel}" data-objectname="Personal_Credit_Report_Co_Applicant__r" data-fieldname="Adverse_Credit_Notice_1__c">Change</a>]
            </div> 
          </div>
          <div class = "tableRowOdd">
            <div class = "tableCell25px">
              2
            </div> 
            <div class = "tableCell">
              <ui:outputText value="{!v.lead.Personal_Credit_Report_Co_Applicant__r.LASERCA__Code_2__c}"/>
            </div> 
            <div class = "tableCell">
              <ui:outputText value="{!v.lead.Personal_Credit_Report_Co_Applicant__r.LASERCA__Detail_2__c}"/>
            </div> 
            <div class = "tableCell">
              <ui:outputText value="{!v.lead.Personal_Credit_Report_Co_Applicant__r.Adverse_Credit_Notice_2__c}"/>
              &nbsp;[<a href="#" onclick="{!c.openModel}" data-objectname="Personal_Credit_Report_Co_Applicant__r" data-fieldname="Adverse_Credit_Notice_2__c">Change</a>]
            </div> 
          </div>
          <div class = "tableRowEven">
            <div class = "tableCell25px">
              3
            </div> 
            <div class = "tableCell">
              <ui:outputText value="{!v.lead.Personal_Credit_Report_Co_Applicant__r.LASERCA__Code_3__c}"/>
            </div> 
            <div class = "tableCell">
              <ui:outputText value="{!v.lead.Personal_Credit_Report_Co_Applicant__r.LASERCA__Detail_3__c}"/>
            </div> 
            <div class = "tableCell">
              <ui:outputText value="{!v.lead.Personal_Credit_Report_Co_Applicant__r.Adverse_Credit_Notice_3__c}"/>
              &nbsp;[<a href="#" onclick="{!c.openModel}" data-objectname="Personal_Credit_Report_Co_Applicant__r" data-fieldname="Adverse_Credit_Notice_3__c">Change</a>]
            </div> 
          </div>
        </div>
      </div>
    </div>


    <!-- DTI CELL -->
    <div class = "rowDiv">
      <!-- APPLICANT -->
      <div class = "cellDiv">
        <br></br>
        <div class = "slds-box slds-box_small slds-align_absolute-center slds-size_1-of-2 slds-theme_default">
          <b>DTI</b>
        </div>
        <br></br>
        <div class ="table">
          <div class = "tableRowEven">
            <div class = "tableCell">
              Adjusted DTI:
            </div>
            <div class = "tableCell">
            </div> 
          </div>
          <div class = "tableRowOdd">
            <div class = "tableCell">
              DTI After: <ui:outputText value="{!v.lead.Personal_Credit_Report__r.DTI_After__c}"/>
            </div> 
            <div class = "tableCell">
              DTI Before: <ui:outputText value="{!v.lead.Personal_Credit_Report__r.DTI_Before__c}"/>
            </div> 
          </div>
        </div>
        <div class="table">
          <div class = "tableRowEven">  
            <div class = "tableCellLong">
              DTI After Notes: <ui:outputText value="{!v.lead.Personal_Credit_Report__r.DTI_After_Notes__c}"/>
            </div> 
          </div>
        </div>
      </div>


      <!-- Co APPLICANT -->
      <div class = "cellDiv">
        <br></br>
        <div class = "slds-box slds-box_small slds-align_absolute-center slds-size_1-of-2 slds-theme_default">
          <b>DTI</b>
        </div>
        <br></br>
        <div class ="table">
          <div class = "tableRowEven">
            <div class = "tableCell">
              Adjusted DTI:
            </div>
            <div class = "tableCell">
            </div> 
          </div>
          <div class = "tableRowOdd">
            <div class = "tableCell">
              DTI After: <ui:outputText value="{!v.lead.Personal_Credit_Report_Co_Applicant__r.DTI_After__c}"/>
            </div> 
            <div class = "tableCell">
              DTI Before: <ui:outputText value="{!v.lead.Personal_Credit_Report_Co_Applicant__r.DTI_Before__c}"/>
            </div> 
          </div>
        </div>
        <div class="table">
          <div class = "tableRowEven">  
            <div class = "tableCellLong">
              DTI After Notes: <ui:outputText value="{!v.lead.Personal_Credit_Report_Co_Applicant__r.DTI_After_Notes__c}"/>
            </div> 
          </div>
        </div>
      </div>
    </div>

    <!-- DEBT CELL -->
    <div class = "rowDiv">
      <!-- APPLICANT: -->
      <div class = "cellDiv">
        <br></br>
        <div class = "slds-box slds-box_small slds-align_absolute-center slds-size_1-of-2 slds-theme_default">
          <b>Debt</b>
        </div>
        <br></br>  
        <div class ="table">
          <div class = "tableRowEven">
            <div class = "tableCell">
              Monthly Personal Debt: 
            </div>
            <div class = "tableCell">
              Adjusted Monthly Personal Debt:
            </div> 
          </div>
          <div class = "tableRowOdd">
            <div class = "tableCell">
            </div> 
            <div class = "tableCell">
              Adjusted Personal Debt Notes: 
            </div> 
          </div>
          <div class = "tableRowEven">  
            <div class = "tableCell">
              Total Debt:
            </div> 
            <div class = "tableCell">
              Real Estate Payment:
            </div> 
          </div>
          <div class = "tableRowOdd">
            <div class = "tableCell">
              Total High Credit:
            </div> 
            <div class = "tableCell">
              Revolving Balance:
            </div> 
          </div>
          <div class = "tableRowEven">
            <div class = "tableCell">
            </div>
            <div class = "tableCell">
              Installment Balance:
            </div>
          </div>
        </div>
      </div>




      <!-- CO APPLICANT -->
      <div class = "cellDiv">
        <br></br>
        <div class = "slds-box slds-box_small slds-align_absolute-center slds-size_1-of-2 slds-theme_default">
          <b>Debt</b>
        </div>
        <br></br>

        <div class ="table">
          <div class = "tableRowEven">
            <div class = "tableCell">
              Monthly Personal Debt: 
            </div>
            <div class = "tableCell">
              Adjusted Monthly Personal Debt:
            </div> 
          </div>
          <div class = "tableRowOdd">
            <div class = "tableCell">
            </div> 
            <div class = "tableCell">
              Adjusted Personal Debt Notes: 
            </div> 
          </div>
          <div class = "tableRowEven">  
            <div class = "tableCell">
              Total Debt:
            </div> 
            <div class = "tableCell">
              Real Estate Payment:
            </div> 
          </div>
          <div class = "tableRowOdd">
            <div class = "tableCell">
              Total High Credit:
            </div> 
            <div class = "tableCell">
              Revolving Balance:
            </div> 
          </div>
          <div class = "tableRowEven">
            <div class = "tableCell">
            </div>
            <div class = "tableCell">
              Installment Balance:
            </div>
          </div>
        </div>
      </div>
    </div>



    <!-- INCOME CELL -->
    <div class = "rowDiv">
      <!-- APPLICANT: -->
      <div class = "cellDiv">
        <br></br>
        <div class = "slds-box slds-box_small slds-align_absolute-center slds-size_1-of-2 slds-theme_default">
          <b>Income</b>
        </div>
        <br></br>

        <div class ="table">
          <div class = "tableRowEven">
            <div class = "tableCell">
              Annual Income: <ui:outputText value="{!v.lead.Annual_Income_Currency__c}"/>
            </div>
            <div class = "tableCell">
              Adjusted Annual Income:
            </div> 
          </div>
          <div class = "tableRowOdd">
            <div class = "tableCell">
            </div> 
            <div class = "tableCell">
              Adjusted Annual Income Notes:
            </div> 
          </div>
          <div class = "tableRowEven">
            <div class = "tableCell">
              Monthly Income:
            </div>
            <div class = "tableCell">
              Lived at residence more than 6 months? 
            </div> 
          </div>
          <div class = "tableRowOdd">
            <div class = "tableCell">
              Income Type:
            </div> 
            <div class = "tableCell">
              Employed for more than 1 year? 
            </div> 
          </div>
          <div class = "tableRowEven">
            <div class = "tableCell">
              Monthly Income Details:
            </div>
            <div class = "tableCell">
              Employed for more than 6 months?
            </div> 
          </div>
        </div>

      </div>

      <!-- CO APPLICANT -->
      <div class = "cellDiv">
        <br></br>
        <div class = "slds-box slds-box_small slds-align_absolute-center slds-size_1-of-2 slds-theme_default">
          <b>Income</b>
        </div>
        <br></br>
        <div class ="table">
          <div class = "tableRowEven">
            <div class = "tableCell">
              Annual Income:
            </div>
            <div class = "tableCell">
              Adjusted Annual Income:
            </div> 
          </div>
          <div class = "tableRowOdd">
            <div class = "tableCell">
            </div> 
            <div class = "tableCell">
              Adjusted Annual Income Notes:
            </div> 
          </div>
          <div class = "tableRowEven">
            <div class = "tableCell">
              Monthly Income:
            </div>
            <div class = "tableCell">
              Lived at residence more than 6 months?
            </div> 
          </div>
          <div class = "tableRowOdd">
            <div class = "tableCell">
              Income Type:
            </div> 
            <div class = "tableCell">
              Employed for more than 1 year?
            </div> 
          </div>
          <div class = "tableRowEven">
            <div class = "tableCell">
              Monthly Income Details:
            </div>
            <div class = "tableCell">
              Employed for more than 6 months? 
            </div> 
          </div>
        </div>

      </div>

    </div>



  </div>


  <!-- </div> -->




  <br></br>
  Income Documentation:
  <table>
    <aura:iteration items="{!v.lead.Attachments}" var="attachment" >
      <tr>  
        <td>
          <ui:outputURL value="{!'/servlet/servlet.FileDownload?file=' + attachment.Id}" label="{!attachment.Name}" target="_blank"/>
        </td>
      </tr>  
    </aura:iteration> 
  </table>







  <!-- </div> -->

  <!-- </div> -->
  <br></br>

</aura:component>
