<aura:component implements="forceCommunity:availableForAllPageTypes" controller="SLPCustomerHandler" access="global"
                extends="c.BlueWaveParent">
  <aura:attribute name="customer" type="Object"/>
  <aura:attribute name="customerInformation" type="Object"/>
  <aura:attribute name="licenseType" type="Boolean"/>
  <aura:attribute name="partnerTaskList" type="Object"/>
  <aura:attribute name="subTaskList" type="Object"/>
  <aura:attribute name="srecQuarters" type="List"/>
  <aura:attribute name="ptoFileAttached" type="Boolean"/>
  <aura:attribute name="ptoFileName" type="String"/>
  <aura:attribute name="completeDisbursalList" type="Object"/>
  <aura:attribute name="incompleteDisbursalList" type="Object"/>
  <aura:attribute name="blueWaveReviewAlert" type="Boolean"/>
  <aura:attribute name="disbursed" type="Boolean"/>
  <aura:attribute name="bwExecuted" type="Boolean"/>
  <aura:attribute name="vendorIdLabel" type="String"/>
  <aura:attribute name="interconnectionTaskStatus" type="String"/>
  <aura:attribute name="firstDisbursalAmount" type="Decimal"/>
  <aura:attribute name="showBuildingPermitModal" type="Boolean"/>
  <aura:attribute name="otherLaborPerformed" type="Boolean"/>
  <aura:attribute name="otherMaterialsSupplied" type="Boolean"/>
  <aura:attribute name="contractSent" type="Boolean"/>
  <aura:attribute name="buildingPermits" type="Object"/>
  <aura:registerEvent name="customerEvent" type="c:SLPCustomerEvent"/>
  <aura:handler event="c:SLPafterFileUpload" action="{!c.handleAfterFileUpload}"/>
  <aura:handler event="c:SLPDashboardEvent" action="{!c.openCustomerWindow}"/>
  <aura:handler event="c:SLPAllCustomersEvent" action="{!c.openCustomerWindow}"/>
  <aura:handler name="init" value="{!this}" action="{!c.doInit}"/>
  <aura:handler name="change" value="{!v.customerInformation}" action="{!c.fieldChanges}"/>
  <aura:handler name="change" value="{!v.customerInformation.Labor_Performed__c}" action="{!c.checkForOtherLabor}"/>
  <aura:handler name="change" value="{!v.customerInformation.Materials_Supplied__c}"
                action="{!c.checkForOtherMaterials}"/>
  <ltng:require styles="{!$Resource.animations}"/>
  <aura:attribute name="equipmentUpdate"
                  type="Residential_Equipment__c"
                  default="{'sobjectType' : 'Residential_Equipment__c',
                           'Name': '',
                           'Generator_Nameplate_Capacity__c': '',
                           'Type_of_Module__c': '',
                           'Number_of_Modules__c': '',
                           'Module_Manufacturer__c': '',
                           'Module_Model_Number__c':'',
                           'Type_of_Inverter__c': '',
                           'Number_of_Inverters__c': '',
                           'Inverter_Manufacturer__c': '',
                           'Inverter_Model_Number__c': '',
                           'Mechanical_Installation_Date__c': '',
                           'Interconnection_Date__c': '',
                           'Mechanically_Installed__c': '',
                           'Interconnected__c':'',
                           'SREC_Opt_In_Calendar_Quarter__c':'',
                           'Module_Power_Rating__c' : '',
                           'Number_of_Modules__c' : '',
                           'Module_Array_Mounting_Type__c' : '',
                           'Module_Array_Azimuth__c' : '',
                           'Module_Array_Tilt__c' : '',
                           'Module_Mounting_Location__c' : '',
                           'Inverter_Manufacturer__c' : '',
                           'Number_of_Inverters__c' : '',
                           'Inverter_Model_Number__c' : '',
                           'Remote_Monitoring_System_Vendor__c' : '',
                           'Remote_Monitorin_Systegm_Identifier__c' : '',
                           'Number_of_Meters__c' : '',
                           'Solar_Meter_Manufacturer__c' : '',
                           'Solar_Meter_Model__c' : '',
                           'Solar_Meter_Serial_Number__c' : '',
                           'Percentage_of_System_Shaded__c' : '',
                           'Contract_Execution_Date__c' : '',
                           'Generator_Installation_Date__c' : '',
                           'Generator_Interconnection_Date__c' : '',
                           'Generator_Energized_Online_Date__c' : '',
                           'Generator_Type__c' : '',
                           'Generator_Nameplate_Capacity__c' : '',
                           'Annual_Production_kWh_kW__c' : '' ,
                           'MA_Facility_Sector__c' : '',
                           'Auto_Reporting_to_PTS__c' : '',
                           'Storage_Grid_Hybrid__c': '',
                           'Storage_Full_or_Partial_Home__c': '',
                           'Storage_Capacity__c': '',
                           'Storage_Manufacturer__c': '',
                           'Storage_Model__c': '',
                           'Storage_Inverter_Manufacturer__c': '',
                           'Storage_Inverter_Model__c': '',
                           'GE_Serial_Number__c' : ''
                           }"/>
  <aura:attribute name="loanUpdate" type="Loan__c"
                  default="{'sobjectType' : 'Loan__c',
                           'Estimated_Completion_Date__c': '',
                           'Requested_Loan_Amount__c':'',
                           }"/>
  <aura:attribute name="changeOrder" type="Object"/>
  <aura:handler name="change" value="{!v.changeOrder}" action="{!c.enableRequestButton}"/>
  <aura:attribute name="requestButtonText" type="String" default="Save"/>
  <aura:attribute name="docuSignPresent" type="Boolean"/>
  <aura:attribute name="requestButtonEnabled" type="Boolean"/>
  <aura:attribute name="completionDateString" type="String"/>
  <aura:attribute name="confirmMessage" type="String"/>
  <aura:attribute name="availableStorageManufacturers" type="List" />
  <aura:attribute name="availableStorageInverterManufacturers" type="List" />
  <aura:attribute name="enableStorage" type="Boolean" default="false" />
  <aura:attribute name="storageHybrid" type="String" default='No'/>
  <aura:attribute name="homeBackupOptions" type="List"/>

  <!-- main issues include the ability to break out subTasks within the task
       table. The tasks break out for each task with subTasks,
       filtering them by task type has been proven difficult due to
       sequence of the attribute's value after the loading of the
       subTasks and lock up of functionality when task is selected
       that doesn't equal the hard-coded value of task type. <Span> is
       also a solution that solves the framework error for accessing
       the attribute when unaccessible (this is a framework error)
       however it throws off the whole chart. The other issue is with
       regards to the view and cancel button. There is a rendering
       issue with making them disappear and appear correctly. It only
       occurs when the task list is reloaded by clicking the view
       button on the dashboard page -->

  <div aura:id="customerPage" class="noDisplayBar">
    <div aura:id="customerName" class="main2 slds-grid">
      <div class="proximaNovaBrand slds-col slds-align-left">
        <h1>{!v.customer.Loan__r.Name}</h1>
      </div>
      <div class="slds-align-right">
        <lightning:button aura:id="additionalFileUpload"
                          label="Upload Applicant Files"
                          onclick="{!c.openAdditionalFileUpload}"/>
        <lightning:button aura:id="customerInformationButton"
                          label="Change Loan and System Information"
                          onclick="{!c.openCustomerModal}"/>
        <aura:if isTrue="{!v.licenseType}">
          <lightning:button aura:id="disbursalInformationButton"
                            label="View Disbursal Information"
                            onclick="{!c.openDisbursalInformation}"/>
        </aura:if>
      </div>
      <hr/>
    </div>
    <div>
      <!--  _________________________________CUSTOMER INFO CARD ___________________________________ -->
      <div class="slds-card-wrapper slds-grid slds-wrap slds-form slds-p-bottom_small">
        <div class="slds-col slds-size_1-of-3 slds-form-element slds-p-bottom_small">
          <label class="slds-form-element__label">Sales Agent</label>
          <div class="slds-form-element__control">
            <ui:outputText value="{!v.customer.Loan__r.Sales_Agent__r.Name}"/>
          </div>
        </div>
        <div class="slds-col slds-size_1-of-3 slds-form-element slds-p-bottom_small">
          <label class="slds-form-element__label">Product</label>
          <div class="slds-form-element__control">
            <ui:outputText value="{!v.customer.Loan__r.Product__r.External_Name__c}"/>
          </div>
        </div>
        <div class="slds-col slds-size_1-of-3 slds-form-element slds-p-bottom_small">
          <label class="slds-form-element__label">Requested Loan Amount</label>
          <div class="slds-form-element__control">
            <ui:outputCurrency value="{!v.customer.Loan__r.Requested_Loan_Amount__c}"/>
            <aura:if isTrue="{!v.licenseType}">
              &nbsp;(<ui:outputCurrency value="{!v.customer.Loan__r.Total_Funds_Disbursed__c}"/> funded)
            </aura:if>
          </div>
        </div>
        <div class="slds-col slds-size_1-of-3 slds-form-element slds-p-bottom_small">
          <label class="slds-form-element__label">System Size</label>
          <div class="slds-form-element__control">
            <ui:outputNumber value="{!v.customerInformation.Generator_Nameplate_Capacity__c}"/>
          </div>
        </div>
        <aura:if isTrue="{!v.customerInformation.Loan__r.Lead__r.Change_Order_Status__c != null}">
          <div class="slds-col slds-size_1-of-3 slds-form-element slds-p-bottom_small">
            <label class="slds-form-element__label">Estimated Date of Completion</label>
            <div class="slds-form-element__control">
              <ui:outputDate value="{!v.customerInformation.Loan__r.Estimated_Completion_Date__c}"/>
            </div>
          </div>
          <div class="slds-col slds-size_1-of-3 slds-form-element slds-p-bottom_small">
            <label class="slds-form-element__label">Change Order Status</label>
            <div class="slds-form-element__control">
              <ui:outputText class="input-changed" value="{!v.customerInformation.Loan__r.Lead__r.Change_Order_Status__c + ' '}"/>
              <aura:if isTrue="{!or(v.customerInformation.Loan__r.Lead__r.Change_Order_Status__c == 'Requested', v.customerInformation.Loan__r.Lead__r.Change_Order_Status__c == 'Customer Rejected')}">
                <a onclick="{!c.openCustomerModal}" class="slds-text-link">(more info)</a>
              </aura:if>
            </div>
          </div>
          <aura:set attribute="else">
            <div class="slds-col slds-size_2-of-3 slds-form-element slds-p-bottom_small">
              <label class="slds-form-element__label">Estimated Date of Completion</label>
              <div class="slds-form-element__control">
                <ui:outputDate value="{!v.customerInformation.Loan__r.Estimated_Completion_Date__c}"/>
              </div>
            </div>
          </aura:set>
        </aura:if>
        <div class="slds-col slds-size_1-of-3 slds-form-element slds-p-bottom_small">
          <label class="slds-form-element__label">Module Manufacturer</label>
          <div class="slds-form-element__control">
            <ui:outputText value="{!v.customerInformation.Module_Manufacturer__c}"/>
          </div>
        </div>
        <div class="slds-col slds-size_1-of-3 slds-form-element slds-p-bottom_small">
          <label class="slds-form-element__label">Module Model Number/Type</label>
          <div class="slds-form-element__control">
            <ui:outputText value="{!v.customerInformation.Module_Model_Number__c}"/>
          </div>
        </div>
        <div class="slds-col slds-size_1-of-3 slds-form-element slds-p-bottom_small">
          <label class="slds-form-element__label">Number of Modules</label>
          <div class="slds-form-element__control">
            <ui:outputNumber value="{!v.customerInformation.Number_of_Modules__c}"/>
          </div>
        </div>
        <div class="slds-col slds-size_1-of-3 slds-form-element slds-p-bottom_small">
          <label class="slds-form-element__label">Inverter Manufacturer</label>
          <div class="slds-form-element__control">
            <ui:outputText value="{!v.customerInformation.Inverter_Manufacturer__c}"/>
          </div>
        </div>
        <div class="slds-col slds-size_1-of-3 slds-form-element slds-p-bottom_small">
          <label class="slds-form-element__label">Inverter Model Number/Type</label>
          <div class="slds-form-element__control">
            <ui:outputText value="{!v.customerInformation.Inverter_Model_Number__c}"/>
          </div>
        </div>
        <div class="slds-col slds-size_1-of-3 slds-form-element slds-p-bottom_small">
          <label class="slds-form-element__label">Number of Inverters</label>
          <div class="slds-form-element__control">
            <ui:outputNumber value="{!v.customerInformation.Number_of_Inverters__c}"/>
          </div>
        </div>
        <aura:if isTrue="{!v.customerInformation.Loan__r.Lead__r.Storage__c}">
            <div class="slds-col slds-size_1-of-3 slds-form-element slds-p-bottom_small">
              <label class="slds-form-element__label">Does the system provide backup power when the grid is down?</label>
              <div class="slds-form-element__control">
                <aura:if isTrue="{!v.customerInformation.Storage_Grid_Hybrid__c}">
                  <ui:outputText value="Yes"/>
                </aura:if>
                <aura:if isTrue="{!not(v.customerInformation.Storage_Grid_Hybrid__c)}">
                  <ui:outputText value="No"/>
                </aura:if>
              </div>
            </div>
            <aura:if isTrue="{!v.customerInformation.Storage_Grid_Hybrid__c}">
              <div class="slds-col slds-size_1-of-3 slds-form-element slds-p-bottom_small">
                <label class="slds-form-element__label">Partial or full home backup</label>
                <div class="slds-form-element__control">
                  <ui:outputText value="{!v.customerInformation.Storage_Full_or_Partial_Home__c}"/>
                </div>
              </div>
            </aura:if>
            <div class="slds-col slds-size_1-of-3 slds-form-element slds-p-bottom_small">
              <label class="slds-form-element__label">Storage Capacity (kW)</label>
              <div class="slds-form-element__control">
                <ui:outputNumber value="{!v.customerInformation.Storage_Capacity__c}"/>
              </div>
            </div>
            <div class="slds-col slds-size_1-of-3 slds-form-element slds-p-bottom_small">
              <label class="slds-form-element__label" for="input-03">Battery Manufacturer</label>
              <div class="slds-form-element__control">
                <ui:outputText value="{!v.customerInformation.Storage_Manufacturer__c}"/>
              </div>
            </div>
            <div class="slds-col slds-size_2-of-3 slds-form-element slds-p-bottom_small">
              <label class="slds-form-element__label" for="input-03">Model Number</label>
              <div class="slds-form-element__control">
                <ui:outputText value="{!v.customerInformation.Storage_Model__c}"/>
              </div>
            </div>
            <div class="slds-col slds-size_1-of-3 slds-form-element slds-p-bottom_small">
              <label class="slds-form-element__label" for="input-03">Battery Inverter Manufacturer</label>
              <div class="slds-form-element__control">
                <ui:outputText value="{!v.customerInformation.Storage_Inverter_Manufacturer__c}"/>
              </div>
            </div>
            <div class="slds-col slds-size_2-of-3 slds-form-element slds-p-bottom_small">
              <label class="slds-form-element__label" for="input-03">Battery Inverter Model Number</label>
              <div class="slds-form-element__control">
                <ui:outputText value="{!v.customerInformation.Storage_Inverter_Model__c}"/>
              </div>
            </div>
        </aura:if>
      </div>
      <br/>
      <!--  _________________________________CHANGE ORDER MODAL ___________________________________ -->
      <div aura:id="generalSystemInformationModal" role="dialog" tabindex="-1" aria-labelledby="header43"
           class="slds-modal  slds-modal--large">
        <div class="slds-modal__container slds-scrollable">
          <div class="slds-modal__header blueBackground">
            <h2 id="header43" class="slds-text-heading--medium--white">{!v.customer.Loan__r.Name}</h2>
          </div>
          <aura:if isTrue="{!or(v.disbursed, v.bwExecuted)}">
            <div class="slds-modal__content slds-p-around--medium">
              This loan has been disbursed or executed. Please call BlueWave Partner Support at the number below to make changes
            </div>
            <div class="slds-modal__footer">
              <lightning:button aura:id="closeCustomerModalButton"
                                class="slds-button"
                                onclick="{!c.closeCustomerModal}"
                                label="Close"/>
            </div>
          </aura:if>
          <aura:if isTrue="{!and(not(v.disbursed), not(v.bwExecuted))}">
            <div aura:id="systemInformationInputs">
              <div class="slds-modal__content slds-p-around--medium">
                <div>
                  <fieldset class="slds-form--compound">
                    <div class="slds-form-element__group">
                      <div class="slds-form-element__row">
                        <div class="slds-form-element slds-p-horizontal--small slds-size_1-of-2">
                          <label class="slds-form-element__label slds-size_1-of-1"><b>Change Status</b></label>
                          <ui:outputText class="slds-p-right_small" value="{!v.customerInformation.Loan__r.Lead__r.Change_Order_Status__c==null?'New':v.customerInformation.Loan__r.Lead__r.Change_Order_Status__c}"/>
                          <aura:if isTrue="{!v.customerInformation.Loan__r.Lead__r.Change_Order_Status__c == 'Requested'}">
                            <lightning:button class="slds-button slds-text-body--small"
                                              onclick="{!c.withdrawChange}"
                                              label="Withdraw"/>
                          </aura:if>
                          <aura:if isTrue="{!v.customerInformation.Loan__r.Lead__r.Change_Order_Status__c == 'Customer Rejected'}">
                            <div class="slds-text-body--small">
                              Reason: <ui:outputText value="{!v.changeOrder.Reject_Reason}"/>
                            </div>
                          </aura:if>
                        </div>
                        <div class="slds-form-element slds-p-horizontal--small slds-size_1-of-2">
                          <label class="slds-form-element__label slds-size_1-of-1"><b>Requested By</b></label>
                          <aura:if isTrue="{!v.changeOrder.RequestedBy__change != null}">
                            <ui:outputText value="{!v.changeOrder.RequestedBy__change + ' (' + v.changeOrder.RequestedDate__change + ')'}"/>
                          </aura:if>
                        </div>
                      </div>
                      <div class="slds-form-element__row">
                        <div class="slds-form-element slds-p-horizontal--small slds-size_1-of-3">
                          <label class="{!'slds-form-element__label ' + (v.customerInformation.Loan__r.Lead__r.System_Cost__c!=v.changeOrder.System_Cost__change?'input-changed':'')}">
                            <b>System Cost</b>
                          </label>
                          <ui:inputCurrency class="{!'slds-input ' + (v.customerInformation.Loan__r.Lead__r.System_Cost__c!=v.changeOrder.System_Cost__change?'input-changed':'')}"
                                            value="{!v.changeOrder.System_Cost__change}"/>
                        </div>
                        <div class="slds-form-element slds-p-horizontal--small slds-size_1-of-3">
                          <label class="{!'slds-form-element__label ' + ((v.customerInformation.Loan__r.Lead__r.System_Cost__c - v.customerInformation.Loan__r.Lead__r.Requested_Loan_Amount__c) != v.changeOrder.Down_Payment__change?'input-changed':'')}">
                            <b>Down Payment</b>
                          </label>
                          <ui:inputCurrency class="{!'slds-input ' + (((v.customerInformation.Loan__r.Lead__r.System_Cost__c - v.customerInformation.Loan__r.Lead__r.Requested_Loan_Amount__c) != v.changeOrder.Down_Payment__change)?'input-changed':'')}"
                                            value="{!v.changeOrder.Down_Payment__change}"/>
                        </div>
                        <div class="slds-form-element slds-p-horizontal--small slds-size_1-of-3">
                          <label class="{!'slds-form-element__label ' + (v.customerInformation.Loan__r.Lead__r.Requested_Loan_Amount__c != (v.changeOrder.System_Cost__change - v.changeOrder.Down_Payment__change)?'input-changed':'')}">
                            <b>Requested Loan Amount</b>
                          </label>
                          <ui:inputCurrency value="{!v.changeOrder.System_Cost__change - v.changeOrder.Down_Payment__change}"
                                            class="{!'slds-input ' + (v.customerInformation.Loan__r.Lead__r.Requested_Loan_Amount__c != (v.changeOrder.System_Cost__change - v.changeOrder.Down_Payment__change)?'input-changed':'')}"
                                            disabled="true"/>
                        </div>
                      </div>
                      <div class="slds-form-element__row">
                        <div class="slds-form-element slds-p-horizontal--small slds-size_1-of-3">
                          <label class="{!'slds-form-element__label ' + (v.customerInformation.Generator_Nameplate_Capacity__c!=v.changeOrder.Generator_Nameplate_Capacity__change?'input-changed':'')}">
                            <b>System Size</b>
                          </label>
                          <ui:inputNumber aura:id="systemSize"
                                          class="{!'slds-input ' + (v.customerInformation.Generator_Nameplate_Capacity__c!=v.changeOrder.Generator_Nameplate_Capacity__change?'input-changed':'')}"
                                          value="{!v.changeOrder.Generator_Nameplate_Capacity__change}"/>
                        </div>
                        <div aura:id="dateOfCompletion"
                             class="slds-form-element slds-m-bottom_small slds-p-horizontal--small animated slds-size_1-of-3">
                          <label class="{!'slds-form-element__label ' + (v.completionDateString!=v.changeOrder.Estimated_Completion_Date__change?'input-changed':'')}">
                            <b>Estimated Date of Completion</b>
                          </label>
                          <div class="slds-form-element__control">
                            <c:BlueWaveDate class="{!(v.completionDateString!=v.changeOrder.Estimated_Completion_Date__change?'input-changed':'')}"
                                            value="{!v.changeOrder.Estimated_Completion_Date__change}"
                                            label="Estimated Date of Completion"/>
                          </div>
                        </div>
                      </div>
                    </div>
                  </fieldset>
                  <fieldset class="slds-form--compound">
                    <div class="slds-form-element__group">
                      <div class="slds-form-element__row">
                        <div class="slds-form-element slds-p-horizontal--small slds-size_1-of-3">
                          <label class="{!'slds-form-element__label ' + (v.customerInformation.Module_Manufacturer__c!=v.changeOrder.Module_Manufacturer__change?'input-changed':'')}">
                            <b>Module Manufacturer</b>
                          </label>
                          <ui:inputText aura:id="moduleManfuacturer"
                                        class="{!'slds-input ' + (v.customerInformation.Module_Manufacturer__c!=v.changeOrder.Module_Manufacturer__change?'input-changed':'')}"
                                        value="{!v.changeOrder.Module_Manufacturer__change}"/>
                        </div>
                        <div class="slds-form-element slds-p-horizontal--small slds-size_1-of-3">
                          <label class="{!'slds-form-element__label ' + (v.customerInformation.Module_Model_Number__c!=v.changeOrder.Module_Model_Number__change?'input-changed':'')}">
                            <b>Module Model Number/Type</b>
                          </label>
                          <ui:inputText aura:id="moduleType"
                                        class="{!'slds-input ' + (v.customerInformation.Module_Model_Number__c!=v.changeOrder.Module_Model_Number__change?'input-changed':'')}"
                                        value="{!v.changeOrder.Module_Model_Number__change}"/>
                        </div>
                        <div class="slds-form-element slds-p-horizontal--small slds-size_1-of-3">
                          <label class="{!'slds-form-element__label ' + (v.customerInformation.Number_of_Modules__c!=v.changeOrder.Number_of_Modules__change?'input-changed':'')}">
                            <b>Number of Modules</b>
                          </label>
                          <ui:inputNumber aura:id="moduleNumber"
                                          class="{!'slds-input ' + (v.customerInformation.Number_of_Modules__c!=v.changeOrder.Number_of_Modules__change?'input-changed':'')}"
                                          value="{!v.changeOrder.Number_of_Modules__change}"/>
                        </div>
                      </div>
                    </div>
                  </fieldset>
                  <fieldset class="slds-form--compound">
                    <div class="slds-form-element__group">
                      <div class="slds-form-element__row">
                        <div class="slds-form-element slds-p-horizontal--small slds-size_1-of-3">
                          <label class="{!'slds-form-element__label ' + (v.customerInformation.Inverter_Manufacturer__c!=v.changeOrder.Inverter_Manufacturer__change?'input-changed':'')}">
                            <b>Inverter Manufacturer</b>
                          </label>
                          <ui:inputText aura:id="inverterManufacturer"
                                        class="{!'slds-input ' + (v.customerInformation.Inverter_Manufacturer__c!=v.changeOrder.Inverter_Manufacturer__change?'input-changed':'')}"
                                        value="{!v.changeOrder.Inverter_Manufacturer__change}"/>
                        </div>
                        <div class="slds-form-element slds-p-horizontal--small slds-size_1-of-3">
                          <label class="{!'slds-form-element__label ' + (v.customerInformation.Inverter_Model_Number__c!=v.changeOrder.Inverter_Model_Number__change?'input-changed':'')}">
                            <b>Inverter Model Number/Type</b>
                          </label>
                          <ui:inputText aura:id="inverterType"
                                        class="{!'slds-input ' + (v.customerInformation.Inverter_Model_Number__c!=v.changeOrder.Inverter_Model_Number__change?'input-changed':'')}"
                                        value="{!v.changeOrder.Inverter_Model_Number__change}"/>
                        </div>
                        <div class="slds-form-element slds-p-horizontal--small slds-size_1-of-3">
                          <label class="{!'slds-form-element__label ' + (v.customerInformation.Number_of_Inverters__c!=v.changeOrder.Number_of_Inverters__change?'input-changed':'')}">
                            <b>Number of Inverters</b>
                          </label>
                          <ui:inputNumber aura:id="inverterNumber"
                                          class="{!'slds-input ' + (v.customerInformation.Number_of_Inverters__c!=v.changeOrder.Number_of_Inverters__change?'input-changed':'')}"
                                          value="{!v.changeOrder.Number_of_Inverters__change}"/>
                        </div>
                      </div>
                    </div>
                  </fieldset>
                  <aura:if isTrue="{!v.enableStorage &amp;&amp; v.customer.Loan__r.Product__r.External_Name__c != 'MSLP' &amp;&amp; v.customerInformation.Loan__r.Lead__r.Storage__c == false}">
                    <div class="slds-text-heading--label slds-m-left_small slds-m-bottom_medium slds-m-top_small">
                      <lightning:input type="checkbox" label="Add Storage"
                                       checked="{!v.addStorage}"/>
                    </div>
                  </aura:if>
                  <aura:if isTrue="{!or(v.customerInformation.Loan__r.Lead__r.Storage__c, v.addStorage)}">
                    <fieldset class="slds-form--compound">
                      <div class="slds-form-element__group">
                        <div class="slds-form-element__row">
                            <div class="slds-p-horizontal--small slds-size_1-of-3">
                              <label class="{!'slds-form-element__label ' + (v.customerInformation.Storage_Grid_Hybrid__c!=v.changeOrder.Storage_Grid_Hybrid__change?'input-changed':'')}">
                                <b>Does the system provide backup power when the grid is down?</b>
                              </label>
                              <ui:inputSelect aura:id="backupStorage"
                                              class="{!'slds-form-element__label ' + (v.customerInformation.Storage_Grid_Hybrid__c!=v.changeOrder.Storage_Grid_Hybrid__change?'input-changed':'')}"
                                              value="{!v.storageHybrid}">
                                <ui:inputSelectOption label="Yes" text="Yes"/>
                                <ui:inputSelectOption label="No" text="No"/>
                              </ui:inputSelect>
                            </div>
                          <div class="slds-form-element slds-p-horizontal--small slds-size_1-of-3">
                            <label class="{!'slds-form-element__label ' + (v.customerInformation.Storage_Capacity__c!=v.changeOrder.Storage_Capacity__change?'input-changed':'')}">
                              <b>Storage Capacity (kW)</b>
                            </label>
                            <ui:inputNumber aura:id="storageCost"
                                            class="{!'slds-input ' + (v.customerInformation.Storage_Capacity__c!=v.changeOrder.Storage_Capacity__change?'input-changed':'')}"
                                            value="{!v.changeOrder.Storage_Capacity__change}"/>
                          </div>
                        </div>
                        <aura:if isTrue="{!v.storageHybrid == 'Yes'}">
                          <div class="slds-form-element__row">
                              <div class="slds-p-horizontal--small slds-size_1-of-3">
                                <label class="{!'slds-form-element__label ' + (v.customerInformation.Storage_Full_or_Partial_Home__c!=v.changeOrder.Storage_Full_or_Partial_Home__change?'input-changed':'')}">
                                  <b>Partial or full home backup</b>
                                </label>
                                <ui:inputSelect aura:id="partialOrFullHome"
                                                class="{!'slds-form-element__label ' + (v.customerInformation.Storage_Full_or_Partial_Home__c!=v.changeOrder.Storage_Full_or_Partial_Home__change?'input-changed':'')}"
                                                value="{!v.changeOrder.Storage_Full_or_Partial_Home__change}">
                                  <aura:iteration items="{!v.homeBackupOptions}" var="opts">
                                    <ui:inputSelectOption label="{!opts.text}" text="{!opts.text}" value="{!opts.text == v.customerInformation.Storage_Full_or_Partial_Home__c}"/>
                                  </aura:iteration>
                                </ui:inputSelect>
                              </div>
                          </div>
                        </aura:if>
                      </div>
                    </fieldset>
                    <fieldset class="slds-form--compound">
                      <div class="slds-form-element__group">
                        <div class="slds-form-element__row">
                          <div class="slds-p-horizontal--small slds-size_1-of-3">
                            <label class="{!'slds-form-element__label ' + (v.customerInformation.Storage_Manufacturer__c!=v.changeOrder.Storage_Manufacturer__change?'input-changed':'')}">
                              <b>Battery Manufacturer</b>
                            </label>
                            <ui:inputSelect aura:id="storageManufacturer"
                                            class="{!'slds-form-element__label ' + (v.customerInformation.Storage_Manufacturer__c!=v.changeOrder.Storage_Manufacturer__change?'input-changed':'')}"
                                            value="{!v.customerInformation.Storage_Manufacturer__change}">
                              <ui:inputSelectOption text="" label="Select"/>
                              <aura:iteration items="{!v.availableStorageManufacturers}" var="product">
                                <ui:inputSelectOption label="{!product.text}" text="{!product.text}" value="{!product.text == v.customerInformation.Storage_Manufacturer__c}"/>
                              </aura:iteration>
                            </ui:inputSelect>
                          </div>
                          <div class="slds-form-element slds-p-horizontal--small slds-size_1-of-3">
                            <label class="{!'slds-form-element__label ' + (v.customerInformation.Storage_Model__c!=v.changeOrder.Storage_Model__change?'input-changed':'')}">
                              <b>Battery Model Number</b>
                            </label>
                            <ui:inputText aura:id="storageModel"
                                          class="{!'slds-input ' + (v.customerInformation.Storage_Model__c!=v.changeOrder.Storage_Model__change?'input-changed':'')}"
                                          value="{!v.changeOrder.Storage_Model__change}"/>
                          </div>
                        </div>
                        <div class="slds-form-element__row">
                          <div class="slds-p-horizontal--small slds-size_1-of-3">
                            <label class="{!'slds-form-element__label ' + (v.customerInformation.Storage_Inverter_Manufacturer__c!=v.changeOrder.Storage_Inverter_Manufacturer__change?'input-changed':'')}">
                              <b>Inverter Manufacturer</b>
                            </label>
                            <ui:inputSelect aura:id="storageInverterManufacturer"
                                            class="{!'slds-form-element__label ' + (v.customerInformation.Storage_Inverter_Manufacturer__c!=v.changeOrder.Storage_Inverter_Manufacturer__change?'input-changed':'')}"
                                            value="{!v.customerInformation.Storage_Inverter_Manufacturer__change}">
                              <ui:inputSelectOption text="" label="Select"/>
                              <aura:iteration items="{!v.availableStorageInverterManufacturers}" var="product">
                                <ui:inputSelectOption label="{!product.text}" text="{!product.text}" value="{!product.text == v.customerInformation.Storage_Inverter_Manufacturer__c}"/>
                              </aura:iteration>
                            </ui:inputSelect>
                          </div>
                          <div class="slds-form-element slds-p-horizontal--small slds-size_1-of-3">
                            <label class="{!'slds-form-element__label ' + (v.customerInformation.Storage_Inverter_Model__c!=v.changeOrder.Storage_Inverter_Model__change?'input-changed':'')}">
                              <b>Inverter Model Number</b>
                            </label>
                            <ui:inputText aura:id="storageInverterModel"
                                          class="{!'slds-input ' + (v.customerInformation.Storage_Inverter_Model__c!=v.changeOrder.Storage_Inverter_Model__change?'input-changed':'')}"
                                          value="{!v.changeOrder.Storage_Inverter_Model__change}"/>
                          </div>
                        </div>
                        <div class="slds-form-element_row slds-m-left_small slds-m-bottom_small slds-m-top_small slds-text-title">
                          <p>
                            We are always looking to expand our storage equipment list to include additional high quality vendors, if a vendor that you would like to use is missing from our list please call Partner Support at (888) 817-2703.
                          </p>
                        </div>
                      </div>
                    </fieldset>
                  </aura:if>
                </div>
                <aura:if isTrue="{!not(v.contractSent)}">
                  <div class="slds-p-horizontal--small">
                    Upon submitting completed system information, a loan contract will be generated as soon as the applicant is pre-qualified and completes confirmations.
                  </div>
                </aura:if>
              </div>
            </div>
            <div class="slds-modal__footer">
              <lightning:button aura:id="closeCustomerModalButton"
                                class="slds-button"
                                onclick="{!c.closeCustomerModal}"
                                label="Close"/>
              <lightning:button aura:id="saveChangeOrder"
                                class="slds-button"
                                onclick="{!c.saveAndRequestChangeOrder}"
                                label="{!v.requestButtonText}"
                                disabled="{!not(v.requestButtonEnabled)}"/>
              <ui:spinner aura:id="customerInformationSpinner" class="floatRight" isVisible="false"/>
            </div>
          </aura:if>
        </div>
      </div>
      <div aura:id="confirmModal" role="dialog" tabindex="-1" class="slds-modal">
        <div class="slds-modal__container slds-scrollable">
          <div class="slds-modal__header blueBackground">
            <h2 class="slds-text-heading--medium--white">{!v.customer.Loan__r.Name}</h2>
          </div>
          <div>
            <div class="slds-modal__content slds-p-around--medium">
              <div class="slds-align--absolute-center ">
                <p class="proximaNovaBlue slds-m-top_xx-large slds-m-bottom_xx-large"><b>{!v.confirmMessage}</b></p>
              </div>
            </div>
          </div>
          <div class="slds-modal__footer">
            <lightning:button aura:id="closeCustomerModalButton"
                              class="slds-button"
                              onclick="{!c.closeConfirmModal}"
                              label="Close"/>
          </div>
        </div>
      </div>
      <div aura:id="srecInformationModal"
           role="dialog" tabindex="-1"
           aria-labelledby="header43"
           class="slds-modal slds-modal--large">
        <div class="slds-modal__container ">
          <div class="slds-modal__header blueBackground">
            <button class="slds-button slds-modal__close slds-button--icon-inverse" title="Close">
              <span class="slds-assistive-text">Close</span>
            </button>
            <h2 id="header43" class="slds-text-heading--medium proximaNovaWhite">{!v.customer.Loan__r.Name}</h2>
          </div>
          <div class="slds-modal__content slds-p-around--medium">
            <div aura:id="SrecInterconnectionPage">
              <div class="slds-size_1-of-2">
                <div class="slds-form-element slds-p-horizontal--small slds-m-around--x-small">
                  <label class="slds-form-element__label" for="autoPts">
                    Is this system interconnected and operating?
                  </label>
                  <aura:if isTrue="{!v.customerInformation.Interconnected__c}">
                    <div class="slds-form-element__control">
                      <div class="slds-radio--button-group">
                        <span class="slds-button slds-radio--button">
                          <input type="radio" id="interconnectYes" name="interconnect"
                                 checked="true" onclick="{!c.setInterconnectedTrue}"/>
                          <label class="slds-radio--button__label alignCenter interconnectModalButtonWidth"
                                 for="interconnectYes">
                            <span class="slds-radio_faux">Yes</span>
                          </label>
                        </span>
                        <span class="slds-button slds-radio--button">
                          <input type="radio" id="interconnectNo" name="interconnect" checked="false"
                                 onclick="{!c.setInterconnectedFalse}"/>
                          <label class="slds-radio--button__label alignCenter interconnectModalButtonWidth"
                                 for="interconnectNo">
                            <span class="slds-radio_faux">No</span>
                          </label>
                        </span>
                      </div>
                    </div>
                    <aura:set attribute="else">
                      <div class="slds-form-element__control">
                        <div class="slds-radio--button-group">
                          <span class="slds-button slds-radio--button">
                            <input type="radio" id="interconnectYes2" name="interconnect2"
                                   checked="false"
                                   onclick="{!c.setInterconnectedTrue}"/>
                            <label class="slds-radio--button__label alignCenter interconnectModalButtonWidth"
                                   for="interconnectYes2">
                              <span class="slds-radio_faux">Yes</span>
                            </label>
                          </span>
                          <span class="slds-button slds-radio--button">
                            <input type="radio" id="interconnectNo2" name="interconnect2"
                                   checked="true" onclick="{!c.setInterconnectedFalse}"/>
                            <label class="slds-radio--button__label alignCenter interconnectModalButtonWidth"
                                   for="interconnectNo2">
                              <span class="slds-radio_faux">No</span>
                            </label>
                          </span>
                        </div>
                      </div>
                    </aura:set>
                  </aura:if>
                </div>
              </div>
              <div class="slds-form-element slds-p-horizontal--small slds-m-top--small slds-m-around--x-small">
                <label class="slds-form-element__label" for="input-03">
                  When did the system get interconnected?
                </label>
                <div class="inputWidth25">
                  <ui:inputDate aura:id="interconnectionDateChanger"
                                class="slds-input"
                                displayDatePicker="true"
                                value="{!v.customerInformation.Interconnection_Date__c}"/>
                </div>
              </div>
              <hr></hr>
              <fieldset>
                <div class="slds-size_1-of-2">
                  <legend
                    class="slds-form-element__legend slds-form-element__label slds-p-horizontal--small slds-m-around--x-small">
                    SREC Opt-in Calendar Quarter
                  </legend>
                  <div class="slds-form-element__control slds-p-horizontal--small slds-m-around--x-small">
                    <div class="slds-radio--button-group">
                      <aura:iteration items="{!v.srecQuarters}" var="srecQuarter">
                        <span class="slds-button slds-radio--button">
                          <aura:if isTrue="{!srecQuarter == v.customerInformation.SREC_Opt_In_Calendar_Quarter__c}">
                            <input type="radio" name="radio" id="{!srecQuarter}"
                                   aura:id="{!srecQuarter}"
                                   value="{!srecQuarter}"
                                   checked="TRUE"
                                   onclick="{!c.setSrecOptInCalendarQuarter}"/>
                            <aura:set attribute="else">
                              <input type="radio"
                                     name="radio"
                                     id="{!srecQuarter}"
                                     aura:id="{!srecQuarter}"
                                     value="{!srecQuarter}"
                                     onclick="{!c.setSrecOptInCalendarQuarter}"/>
                            </aura:set>
                          </aura:if>
                          <label class="slds-radio--button__label" for="{!srecQuarter}">
                            <span class="slds-radio--faux">{!srecQuarter}</span>
                          </label>
                        </span>
                      </aura:iteration>
                    </div>
                  </div>
                </div>
              </fieldset>
              <div class="slds-size_1-of-2">
                <div>
                  <div class="slds-form-element slds-p-horizontal--small slds-m-around--x-small">
                    <aura:if isTrue="{!v.ptoFileAttached}">
                      <label class="slds-form-element__label" for="file">You have uploaded
                        <b> {!v.ptoFileName} </b> as PTO Documentation. If this is the incorrect file,
                        please upload the correct file here.
                      </label>
                      <aura:set attribute="else">
                        <label class="slds-form-element__label" for="file">
                          Please upload PTO Documentation here.
                        </label>
                      </aura:set>
                    </aura:if>
                    <lightning:input type="file" label=" " name="file" onchange="{!c.savePtoDoc}"/>
                  </div>
                </div>
              </div>
              <br></br>
            </div>
            <fieldset aura:id="SrecGeneratorPage" class="slds-form--compound noDisplay">
              <div class="slds-form-element__group">
                <div class="slds-form-element__row">
                  <div class="slds-form-element slds-p-horizontal--small slds-m-around--x-small ">
                    <label class="slds-form-element__label" for="input-03">Generator Type</label>
                    <ui:inputText aura:id="generatorType" class="slds-input"
                                  value="{!v.equipmentUpdate.Generator_Type__c}"
                                  placeholder="{!v.customerInformation.Generator_Type__c}"/>
                  </div>
                  <div class="slds-form-element slds-p-horizontal--small slds-m-around--x-small ">
                    <label class="slds-form-element__label" for="input-03">
                      Generator Nameplate Capacity (KW DC)
                    </label>
                    <ui:inputText aura:id="generatorNameplateCapacity" class="slds-input"
                                  value="{!v.equipmentUpdate.Generator_Nameplate_Capacity__c}"
                                  placeholder="{!v.customerInformation.Generator_Nameplate_Capacity__c}"/>
                  </div>
                  <div class="slds-form-element slds-p-horizontal--small slds-m-around--x-small ">
                    <label class="slds-form-element__label" for="input-03">Annual Production (KWH)</label>
                    <ui:inputNumber aura:id="annualProduction" class="slds-input "
                                    value="{!v.equipmentUpdate.Annual_Production_kWh_kW__c}"
                                    placeholder="{!v.customerInformation.Annual_Production_kWh_kW__c}"/>
                  </div>
                </div>
                <div class="slds-form-element__row">
                  <div aura:id="maFacilitySector" class="inputWidth25">
                    <div class="slds-form-element slds-p-horizontal--small slds-m-around--x-small">
                      <label class="slds-form-element__label" for="maFacilitySector">MA Facility Sector</label>
                      <div class="slds-form-element__control">
                        <div class="slds-select_container">
                          <select id="maFacilitySector"
                                  class="slds-select"
                                  onchange="{!c.setFacilitySector}"
                                  value="{!v.equipmentUpdate.MA_Facility_Sector__c}">
                            <option>Select</option>
                            <option>Residential</option>
                            <option>Commercial</option>
                            <option>Government</option>
                          </select>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </fieldset>
            <fieldset aura:id="SrecModulePage" class="slds-form--compound noDisplay">
              <div class="slds-form-element__group">
                <div class="slds-form-element__row">
                  <div class="slds-form-element slds-p-horizontal--small">
                    <label class="slds-form-element__label" for="input-03">Module Manufacturer</label>
                    <ui:inputText aura:id="moduleManufacturer" class="slds-input"
                                  value="{!v.equipmentUpdate.Module_Manufacturer__c}"
                                  placeholder="{!v.customerInformation.Module_Manufacturer__c}"/>
                  </div>
                  <div class="slds-form-element slds-p-horizontal--small">
                    <label class="slds-form-element__label" for="input-03">Module Model Number</label>
                    <ui:inputText aura:id="moduleType" class="slds-input"
                                  value="{!v.equipmentUpdate.Module_Model_Number__c}"
                                  placeholder="{!v.customerInformation.Module_Model_Number__c}"/>
                  </div>
                </div>
                <div class="slds-form-element__row">
                  <div class="slds-form-element slds-p-horizontal--small">
                    <label class="slds-form-element__label" for="input-03">Module Power Rating</label>
                    <ui:inputText aura:id="modulePowerRating" class="slds-input"
                                  value="{!v.equipmentUpdate.Module_Power_Rating__c}"
                                  placeholder="{!v.customerInformation.Module_Power_Rating__c}"/>
                  </div>
                  <div class="slds-form-element slds-p-horizontal--small">
                    <label class="slds-form-element__label" for="input-03">Number of Modules</label>
                    <ui:inputText aura:id="moduleNumber" class="slds-input"
                                  value="{!v.equipmentUpdate.Number_of_Modules__c}"
                                  placeholder="{!v.customerInformation.Number_of_Modules__c}"/>
                  </div>
                  <div class="slds-form-element slds-p-horizontal--small">
                    <label class="slds-form-element__label" for="input-03">Module Array Mounting Type</label>
                    <ui:inputText aura:id="modualArrayMountingType" class="slds-input"
                                  value="{!v.equipmentUpdate.Module_Array_Mounting_Type__c}"
                                  placeholder="{!v.customerInformation.Module_Array_Mounting_Type__c}"/>
                  </div>
                </div>
                <div class="slds-form-element__row">
                  <div class="slds-form-element slds-p-horizontal--small">
                    <label class="slds-form-element__label" for="input-03">Module Array Azimuth</label>
                    <ui:inputText aura:id="moduleArrayAzimuth" class="slds-input"
                                  value="{!v.equipmentUpdate.Module_Array_Azimuth__c}"
                                  placeholder="{!v.customerInformation.Module_Array_Azimuth__c}"/>
                  </div>
                  <div class="slds-form-element slds-p-horizontal--small">
                    <label class="slds-form-element__label" for="input-03">Module Array Tilt</label>
                    <ui:inputText aura:id="moduleArrayTilt" class="slds-input"
                                  value="{!v.equipmentUpdate.Module_Array_Tilt__c}"
                                  placeholder="{!v.customerInformation.Module_Array_Tilt__c}"/>
                  </div>
                  <div class="slds-form-element slds-p-horizontal--small">
                    <label class="slds-form-element__label" for="input-03">Module Mounting Location</label>
                    <ui:inputText aura:id="moduleMountingLocation" class="slds-input"
                                  value="{!v.equipmentUpdate.Module_Mounting_Location__c}"
                                  placeholder="{!v.customerInformation.Module_Mounting_Location__c}"/>
                  </div>
                </div>
              </div>
            </fieldset>
            <fieldset aura:id="SrecInverterPage" class="slds-form--compound noDisplay">
              <div class="slds-form-element__group">
                <div class="slds-form-element__row">
                  <div class="slds-form-element slds-p-horizontal--small">
                    <label class="slds-form-element__label" for="input-03">Inverter Manufacturer</label>
                    <ui:inputText aura:id="inverterManufacturer" class="slds-input"
                                  value="{!v.equipmentUpdate.Inverter_Manufacturer__c}"
                                  placeholder="{!v.customerInformation.Inverter_Manufacturer__c}"/>
                  </div>
                  <div class="slds-form-element slds-p-horizontal--small">
                    <label class="slds-form-element__label" for="input-03">Number of Inverters</label>
                    <ui:inputText aura:id="inverterNumber" class="slds-input"
                                  value="{!v.equipmentUpdate.Number_of_Inverters__c}"
                                  placeholder="{!v.customerInformation.Number_of_Inverters__c}"/>
                  </div>
                  <div class="slds-form-element slds-p-horizontal--small">
                    <label class="slds-form-element__label" for="input-03">Inverter Model Number</label>
                    <ui:inputText aura:id="inverterType" class="slds-input"
                                  value="{!v.equipmentUpdate.Inverter_Model_Number__c}"
                                  placeholder="{!v.customerInformation.Inverter_Model_Number__c}"/>
                  </div>
                </div>
              </div>
            </fieldset>
            <fieldset aura:id="SrecRemoteMonitoringPage" class="slds-form--compound noDisplay">
              <div class="proximaNovaDataBlue50">
                If this system will be auto-reporting using PowerDash,
                please provide full admin access and privileges to
                BlueWave in order for us to enter in the system's PTS
                ID when it is generated after registration approval by
                the state. If this system will be auto-reporting using
                SolarEdge, please provide full admin access and
                privileges to info@solsystemscompany.com in order for
                us to add the system's PTS ID when it is generated
                after registration approval by the state.
              </div>
              <br></br>
              <div class="slds-size_1-of-2">
                <div class="slds-form-element slds-p-horizontal--small slds-m-around--x-small">
                  <label class="slds-form-element__label" for="autoPts">
                    Will this system be auto-reporting PTS?
                  </label>
                  <aura:if isTrue="{!v.customerInformation.Auto_Reporting_to_PTS__c}">
                    <div class="slds-form-element__control">
                      <div class="slds-radio--button-group">
                        <span class="slds-button slds-radio--button">
                          <input type="radio" id="yesAutoPTS" name="autoPTS" checked="true"
                                 onclick="{!c.setAutoPTSTrue}"/>
                          <label class="slds-radio--button__label alignCenter interconnectModalButtonPTS"
                                 for="yesAutoPTS">
                            <span class="slds-radio_faux">Yes</span>
                          </label>
                        </span>
                        <span class="slds-button slds-radio--button">
                          <input type="radio" id="noAutoPTS" name="autoPTS" checked="false"
                                 onclick="{!c.setAutoPTSFalse}"/>
                          <label class="slds-radio--button__label alignCenter interconnectModalButtonPTS"
                                 for="noAutoPTS">
                            <span class="slds-radio_faux">No, customer will self-report</span>
                          </label>
                        </span>
                      </div>
                    </div>
                    <aura:set attribute="else">
                      <div class="slds-form-element__control">
                        <div class="slds-radio--button-group">
                          <span class="slds-button slds-radio--button">
                            <input type="radio" id="yesAutoPTS2" name="autoPTS2" checked="false"
                                   onclick="{!c.setAutoPTSTrue}"/>
                            <label class="slds-radio--button__label alignCenter interconnectModalButtonPTS"
                                   for="yesAutoPTS2">
                              <span class="slds-radio_faux">Yes</span>
                            </label>
                          </span>
                          <span class="slds-button slds-radio--button">
                            <input type="radio" id="noAutoPTS2" name="autoPTS2" checked="true"
                                   onclick="{!c.setAutoPTSFalse}"/>
                            <label class="slds-radio--button__label alignCenter interconnectModalButtonPTS"
                                   for="noAutoPTS2">
                              <span class="slds-radio_faux">No, customer will self-report</span>
                            </label>
                          </span>
                        </div>
                      </div>
                    </aura:set>
                  </aura:if>
                </div>
              </div>
              <div class="slds-form-element__group">
                <div class="slds-form-element__row">
                  <div aura:id="vendorSelection" class="slds-size_1-of-2 noDisplay">
                    <div class="slds-form-element slds-p-horizontal--small slds-m-around--x-small">
                      <label class="slds-form-element__label" for="autoReportingVendor">
                        Who will be the auto-reporting vendor?
                      </label>
                      <div class="slds-form-element__control">
                        <div class="slds-select_container">
                          <select id="autoReportingVendor" class="slds-select"
                                  onchange="{!c.setAutoReportingVendor}"
                                  value="{!v.equipmentUpdate.Remote_Monitoring_System_Vendor__c}">
                            <option>Select</option>
                            <option>eGauge Systems</option>
                            <option>PowerDash</option>
                            <option>SolarEdge</option>
                            <option>SolarLog</option>
                            <option>Locus</option>
                            <option>Other</option>
                          </select>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div aura:id="vendorUniqueId" class="slds-size_1-of-2 noDisplay">
                    <div class="slds-form-element slds-p-horizontal--small slds-m-around--x-small">
                      <label class="slds-form-element__label" for="input-03">{!v.vendorIdLabelb}</label>
                      <ui:inputText aura:id="remoteMonitoringSystem" class="slds-input"
                                    value="{!v.equipmentUpdate.Remote_Monitorin_Systegm_Identifier__c}"
                                    placeholder="{!v.customerInformation.Remote_Monitorin_Systegm_Identifier__c}"/>
                    </div>
                  </div>
                  <div aura:id="geSerialNumber" class="slds-size_1-of-2 slds-float_right noDisplay">
                    <div class="slds-form-element slds-p-horizontal--small slds-m-around--x-small">
                      <label class="slds-form-element__label" for="input-03">GE Serial Number</label>
                      <ui:inputText aura:id="remoteMonitoringSystem" class="slds-input"
                                    value="{!v.equipmentUpdate.GE_Serial_Number__c}"
                                    placeholder="{!v.customerInformation.GE_Serial_Number__c}"/>
                    </div>
                  </div>
                </div>
              </div>
            </fieldset>
            <fieldset aura:id="SrecSolarMeterPage" class="slds-form--compound noDisplay">
              <div class="slds-form-element__group">
                <div class="slds-form-element__row">
                  <div class="slds-form-element slds-p-horizontal--small">
                    <label class="slds-form-element__label" for="input-03">Solar Meter Manufacturer</label>
                    <ui:inputText aura:id="meterManufacturer" class="slds-input"
                                  value="{!v.equipmentUpdate.Solar_Meter_Manufacturer__c}"
                                  placeholder="{!v.customerInformation.Solar_Meter_Manufacturer__c}"/>
                  </div>
                  <div class="slds-form-element slds-p-horizontal--small">
                    <label class="slds-form-element__label" for="input-03">Solar Meter Model</label>
                    <ui:inputText aura:id="meterModel" class="slds-input"
                                  value="{!v.equipmentUpdate.Solar_Meter_Model__c}"
                                  placeholder="{!v.customerInformation.Solar_Meter_Model__c}"/>
                  </div>
                  <div class="slds-form-element slds-p-horizontal--small">
                    <label class="slds-form-element__label" for="input-03">Number of Meters</label>
                    <ui:inputNumber aura:id="meterNumber" class="slds-input"
                                    value="{!v.equipmentUpdate.Number_of_Meters__c}"
                                    placeholder="{!v.customerInformation.Number_of_Meters__c}"/>
                  </div>
                </div>
                <div class="slds-form-element__row">
                  <div class="slds-form-element slds-p-horizontal--small">
                    <label class="slds-form-element__label" for="input-03">Solar Meter Serial Number</label>
                    <ui:inputText aura:id="meterSerialNumber" class="slds-input"
                                  value="{!v.equipmentUpdate.Solar_Meter_Serial_Number__c}"
                                  placeholder="{!v.customerInformation.Solar_Meter_Serial_Number__c}"/>
                  </div>
                </div>
              </div>
            </fieldset>
            <fieldset aura:id="SrecMiscPage" class="slds-form--compound noDisplay">
              <div class="slds-form-element__group">
                <div class="slds-form-element__row">
                  <div class="slds-form-element slds-p-horizontal--small">
                    <label class="slds-form-element__label" for="input-03">Percentage of System Shaded</label>
                    <ui:inputText aura:id="percentShaded" class="slds-input"
                                  value="{!v.equipmentUpdate.Percentage_of_System_Shaded__c}"
                                  placeholder="{!v.customerInformation.Percentage_of_System_Shaded__c}"/>
                  </div>
                </div>
              </div>
            </fieldset>
            <fieldset aura:id="SrecInstallationTimeLinePage" class="slds-form--compound noDisplay">
              <div class="slds-form-element__group">
                <div class="slds-form-element__row">
                  <div class="slds-form-element slds-p-horizontal--small">
                    <label class="slds-form-element__label" for="input-03">Contract Execution Date</label>
                    <ui:inputDate aura:id="contractDate" class="slds-input"
                                  value="{!v.equipmentUpdate.Contract_Execution_Date__c}" format="MM/DD/YYYY"/>
                  </div>
                  <div class="slds-form-element slds-p-horizontal--small">
                    <label class="slds-form-element__label" for="input-03">Generator Installation Date</label>
                    <ui:inputDate aura:id="installDate" class="slds-input"
                                  value="{!v.equipmentUpdate.Generator_Installation_Date__c}" format="MM/DD/YYYY"/>
                  </div>
                </div>
                <div class="slds-form-element__row">
                  <div class="slds-form-element slds-p-horizontal--small">
                    <label class="slds-form-element__label" for="input-03">Generator Interconnection Date</label>
                    <ui:inputDate aura:id="interconnectDate" class="slds-input"
                                  value="{!v.equipmentUpdate.Generator_Interconnection_Date__c}" format="MM/DD/YYYY"/>
                  </div>
                  <div class="slds-form-element slds-p-horizontal--small">
                    <label class="slds-form-element__label" for="input-03">Generator Energized/Online Date</label>
                    <ui:inputDate aura:id="energizedDate" class="slds-input"
                                  value="{!v.equipmentUpdate.Generator_Energized_Online_Date__c}" format="MM/DD/YYYY"/>
                  </div>
                </div>
              </div>
            </fieldset>
          </div>
          <div class="slds-modal__footer">
            <div class="slds-align--absolute-center">
              <fieldset>
                <legend class="slds-form-element__legend slds-form-element__label"></legend>
                <div class="slds-form-element__control">
                  <div class="slds-radio--button-group">
                    <span class="slds-button slds-radio--button">
                      <input type="radio" name="srecPageOptions" aura:id="srecInterconnectionToggle"
                             id="srecInterconnectionToggle"
                             onclick="{!c.getSrecInterconnectionPage}"
                             checked="true"/>
                      <label class="slds-radio--button__label proximaNovaDataBlue50" for="srecInterconnectionToggle">
                        <span class="slds-radio--faux">Interconnection/SREC</span>
                      </label>
                    </span>
                    <span class="slds-button slds-radio--button">
                      <input type="radio" name="srecPageOptions" aura:id="srecGeneratorToggle"
                             id="srecGeneratorToggle"
                             onclick="{!c.getGeneratorInformationPage}"/>
                      <label class="slds-radio--button__label proximaNovaDataBlue50" for="srecGeneratorToggle">
                        <span class="slds-radio--faux">Generator Info</span>
                      </label>
                    </span>
                    <span class="slds-button slds-radio--button">
                      <input type="radio" name="srecPageOptions" aura:id="SrecModuleToggle"
                             id="SrecModuleToggle" onclick="{!c.getModuleInformationPage}"/>
                      <label class="slds-radio--button__label proximaNovaDataBlue50" for="SrecModuleToggle">
                        <span class="slds-radio--faux">Module Info</span>
                      </label>
                    </span>
                    <span class="slds-button slds-radio--button">
                      <input type="radio" name="srecPageOptions" aura:id="SrecInverterToggle"
                             id="SrecInverterToggle" onclick="{!c.getInverterInformationPage}"/>
                      <label class="slds-radio--button__label proximaNovaDataBlue50" for="SrecInverterToggle">
                        <span class="slds-radio--faux">Inverter Info</span>
                      </label>
                    </span>
                    <span class="slds-button slds-radio--button">
                      <input type="radio" name="srecPageOptions" aura:id="SrecRemoteMonitoringToggle"
                             id="SrecRemoteMonitoringToggle" onclick="{!c.getRemoteMonitoringInformationPage}"/>
                      <label class="slds-radio--button__label proximaNovaDataBlue50" for="SrecRemoteMonitoringToggle">
                        <span class="slds-radio--faux">System Reporting Info</span>
                      </label>
                    </span>
                    <span class="slds-button slds-radio--button">
                      <input type="radio" name="srecPageOptions" aura:id="SrecMeterToggle"
                             id="SrecMeterToggle" onclick="{!c.getSolarMeterInformationPage}"/>
                      <label class="slds-radio--button__label proximaNovaDataBlue50" for="SrecMeterToggle">
                        <span class="slds-radio--faux">Solar Meter Info</span>
                      </label>
                    </span>
                    <span class="slds-button slds-radio--button">
                      <input type="radio" name="srecPageOptions" aura:id="SrecMiscToggle"
                             id="SrecMiscToggle" onclick="{!c.getMiscInformationPage}"/>
                      <label class="slds-radio--button__label proximaNovaDataBlue50" for="SrecMiscToggle">
                        <span class="slds-radio--faux">Miscellaneous Info</span>
                      </label>
                    </span>
                    <span class="slds-button slds-radio--button">
                      <input type="radio" name="srecPageOptions" aura:id="SrecInstallationTimeLineToggle"
                             id="SrecInstallationTimeLineToggle" onclick="{!c.getInstallationTimeLineInformationPage}"/>
                      <label class="slds-radio--button__label proximaNovaDataBlue50"
                             for="SrecInstallationTimeLineToggle">
                        <span class="slds-radio--faux">Installation Dates</span>
                      </label>
                    </span>
                  </div>
                </div>
              </fieldset>
            </div>
            <lightning:button aura:id="closeSrecModalButton" class="slds-button marginTopp5"
                              onclick="{!c.closeInterconnectionModal}" label="Close"/>
            <lightning:button aura:id="saveSrecModalButton" class="slds-button marginTopp5"
                              onclick="{!c.saveEquipmentInformation}" label="Save"/>
            <ui:spinner aura:id="srecSaveSpinner" class="floatRight" isVisible="false"/>
          </div>
        </div>
      </div>


      <aura:if isTrue="{!v.showBuildingPermitModal}">
        <div aura:id="buildingPermitModal"
             role="dialog" tabindex="-1"
             class="slds-modal slds-modal--large slds-fade-in-open">
          <div class="slds-modal__container ">
            <div class="slds-modal__header blueBackground">
              <button class="slds-button slds-modal__close slds-button--icon-inverse" title="Close">
                <span class="slds-assistive-text">Close</span>
              </button>
              <h2 class="slds-text-heading--medium proximaNovaWhite">{!v.customer.Loan__r.Name}</h2>
            </div>
            <ui:scrollerWrapper >
              <div>
                <div class="slds-modal__content slds-p-around--medium">
                  <fieldset aura:id="buildingPermitInputs" class="slds-form--compound slds-p-bottom_small">
                    <div class="slds-form-element__group">
                      <div class="slds-p-bottom_small">
                        In order to disburse funds, we need you to certify that {!v.customer.Loan__r.Partner__r.Name}
                        has incurred at least
                        <ui:outputCurrency value="{!v.firstDisbursalAmount}"/>
                        for the time required to perform the following
                        labor and for materials supplied to {!v.customer.Loan__r.Name} to date.
                      </div>
                      <div>
                        <b>Labor Performed:</b>
                        <div class="slds-form-element">
                          <div class="slds-form-element__control">
                            <c:BlueWaveMultiCheck sObject="Residential_Equipment__c"
                                                  field="Labor_Performed__c"
                                                  valueString="{!v.customerInformation.Labor_Performed__c}"/>
                          </div>
                        </div>
                        <aura:if isTrue="{!v.otherLaborPerformed}">
                          <lightning:input type="text" label="Other Labor Performed:"
                                           value="{!v.customerInformation.Other_Labor_Performed__c}"/>
                        </aura:if>
                      </div>
                    </div>

                    <div class="slds-p-top_medium slds-p-bottom_medium">
                      <b>Materials Supplied:</b>
                      <div class="slds-form-element">
                        <div class="slds-form-element__control">
                          <c:BlueWaveMultiCheck sObject="Residential_Equipment__c"
                                                field="Materials_Supplied__c"
                                                valueString="{!v.customerInformation.Materials_Supplied__c}"/>
                        </div>
                      </div>
                      <aura:if isTrue="{!v.otherMaterialsSupplied}">
                        <lightning:input type="text" label="Other Materials Supplied"
                                         value="{!v.customerInformation.Other_Materials_Supplied__c}"/>
                      </aura:if>
                    </div>

                    <lightning:input type="file"
                                     label="Upload your approved building permit"
                                     onchange="{!c.handlePermitUpload}"/>
                    <ui:spinner aura:id="buildingPermitUploadSpinner" class="slds-icon" isVisible="false"/>
                    <aura:if isTrue="{!not(empty(v.buildingPermits))}">
                      <div class="slds-box_border slds-text-body_small slds-p-top_small">
                        Uploaded building permit:
                        <div class="slds-grid slds-wrap">
                          <div class="slds-col slds-size--1-of-1">
                            <table class="slds-table">
                              <tbody>
                              <aura:iteration items="{!v.buildingPermits}" var="attachment">
                                <tr>
                                  <td>
                                    <div class="slds-text-body_small">{!attachment}</div>
                                  </td>
                                </tr>
                              </aura:iteration>
                              </tbody>
                            </table>
                          </div>
                        </div>
                      </div>
                    </aura:if>
                  </fieldset>
                  <div aura:id="buildingPermitSubmitConfirmation" class="noDisplay">
                    <div class="slds-p-around--medium">
                      <div class="slds-align--absolute-center ">
                        <p class="proximaNovaBlue slds-m-top_xx-large slds-m-bottom_xx-large"><b>The building permit
                            information has been saved, thank you! </b></p>
                      </div>
                    </div>
                  </div>
                  <div class="slds-float_right">
                    <lightning:button aura:id="closeBuildingPermitModalButton"
                                      class="slds-button marginTopp5"
                                      onclick="{!c.closeBuildingPermitModal}"
                                      label="Close"/>
                    <lightning:button aura:id="saveBuildingPermitModalButton"
                                      class="slds-button marginTopp5"
                                      onclick="{!c.saveBuildingPermit}"
                                      label="Certify"/>
                    <ui:spinner aura:id="buildingPermitSaveSpinner" class="floatRight" isVisible="false"/>
                  </div>
                </div>
              </div>
            </ui:scrollerWrapper>
          </div>
        </div>
      </aura:if>

      <div aura:id="modalBackDrop" class="slds-backdrop--open"></div>
      <!--  _________________________________TASK TABLE ___________________________________ -->
      <table aura:id="taskTable" class="slds-table slds-table--bordered slds-table--striped  box ">
        <thead>
        <tr class="slds-text-heading--label ">
          <th scope="col"><span class="slds-truncate"><b>Task</b></span></th>
          <th scope="col"><span class="slds-truncate"><b>Owner</b></span></th>
          <th scope="col"><span class="slds-truncate"><b>Status</b></span></th>
          <th scope="col"><span class="slds-truncate"><b>Completed On</b></span></th>
          <th scope="col"><span class="slds-truncate"><b>Action</b></span></th>
        </tr>
        </thead>
        <tbody>
        <aura:iteration items="{!v.partnerTaskList}" var="task">
          <tr>
            <th scope="row">
              <div class="slds-form-element slds-p-horizontal--small">
                <b>{!task.Task_Label__c}</b>
                <aura:if isTrue="{!task.Help_Text__c != null}">
                  <c:BlueWaveInputToolTip popoverBody="{!task.Help_Text__c}"/>
                </aura:if>
              </div>
            </th>
            <th scope="row"><b>{!task.Owner__c}</b></th>
            <th scope="row" class="{!task.Effective_Status__c == 'Pending'?'proximaNovaDataStream':''}">
              <b>{!task.Effective_Status__c}</b>
            </th>
            <th scope="row"><b>
                <ui:outputDate value="{!task.Completion_Date__c}"/>
              </b></th>
            <th>
              <aura:if isTrue="{!and(task.Effective_Status__c == 'Pending', task.Owner__c == 'Installer', task.Action_Label__c != '')}">

                <ui:button aura:id="viewButton"
                           label="{!task.Action_Label__c}"
                           class="{!task.Name}"
                           labelClass="{!task.Help_Text__c}"
                           press="{!c.handleTaskAction}"/>
              </aura:if>
            </th>
          </tr>
        </aura:iteration>
        </tbody>
      </table>
      {!v.body}
    </div>
    <aura:if isTrue="{!v.licenseType}">
      <div>
        <!--  _________________________________DISBURSAL INFORMATION ___________________________________ -->
        <div aura:id="disbursalModal" role="dialog" tabindex="-1" aria-labelledby="header43"
             class="slds-modal  slds-modal--large animated">
          <div class="slds-modal__container ">
            <div class="slds-modal__header blueBackground">
              <button class="slds-button slds-modal__close slds-button--icon-inverse" title="Close">
                <span class="slds-assistive-text">Close</span>
              </button>
              <h2 id="header43" class="slds-text-heading--medium--white">{!v.customer.Loan__r.Name}</h2>
            </div>
            <div class="slds-modal__content slds-p-around--medium">
              <div aura:id="completeDisbursals" class="bwBluePaddingBelow slds-scrollable noDisplay">
                <h3>Completed Disbursals</h3>
              </div>
              <table aura:id="disbursalCompleteTable"
                     class="slds-table slds-table--bordered slds-table--striped box noDisplay">
                <thead>
                <tr class="slds-text-heading--label ">
                  <th scope="col"><span class="slds-truncate"><b>Disbursal</b></span></th>
                  <th scope="col"><span class="slds-truncate"><b>Amount</b></span></th>
                  <th scope="col"><span class="slds-truncate"><b>Status</b></span></th>
                  <th scope="col"><span class="slds-truncate"><b>Method</b></span></th>
                  <th scope="col"><span class="slds-truncate"><b>Date</b></span></th>
                </tr>
                </thead>
                <tbody>
                <aura:iteration items="{!v.completeDisbursalList}" var="disbursal">
                  <tr>
                    <th scope="row"><b>{!disbursal.Name}</b></th>
                    <th scope="row">
                      <ui:outputCurrency class="proximaNovaDataStream" value="{!disbursal.Amount__c}"/>
                    </th>
                    <th scope="row"><b>{!disbursal.Status__c}</b></th>
                    <th scope="row"><b>{!disbursal.Disbursal_Method__c}</b></th>
                    <th scope="row"><b>{!disbursal.Date_of_Disbursal__c}</b></th>
                    <td>
                      <div class="slds-form-element">
                        <label class="slds-checkbox--toggle slds-grid">
                          <ui:inputCheckBox aura:id="disbursalCheck"
                                            name="{!disbursal.Id}"
                                            value="{!disbursal.Partner_Confirmation__c}"
                                            change="{!c.updateDisbursal}"/>
                          <span id="toggle-desc" class="slds-checkbox--faux_container" aria-live="assertive">
                              <span class="slds-checkbox--faux"></span>
                              <span class="slds-checkbox--on">Confirmed</span>
                              <span class="slds-checkbox--off">Unconfirmed</span>
                            </span>
                        </label>
                      </div>
                    </td>
                  </tr>
                </aura:iteration>
                </tbody>
              </table>
              <br></br>
              <div aura:id="pendingDisbursals" class="bwBluePaddingBelow slds-scrollable noDisplay">
                <h3>Pending Disbursals</h3>
              </div>
              <table aura:id="disbursalIncompleteTable"
                     class="slds-table slds-table--bordered slds-table--striped box noDisplay">
                <thead>
                <tr class="slds-text-heading--label ">
                  <th scope="col"><span class="slds-truncate"><b>Disbursal</b></span></th>
                  <th scope="col"><span class="slds-truncate"><b>Amount</b></span></th>
                  <th scope="col"><span class="slds-truncate"><b>Status</b></span></th>
                </tr>
                </thead>
                <tbody>
                <aura:iteration items="{!v.incompleteDisbursalList}" var="disbursal">
                  <tr>
                    <th scope="row"><b>{!disbursal.Name}</b></th>
                    <th scope="row">
                      <ui:outputCurrency class="proximaNovaDataStream" value="{!disbursal.Amount__c}"/>
                    </th>
                    <th scope="row"><b>{!disbursal.Status__c}</b></th>
                    <th scope="row"><b>{!disbursal.Date_of_Disbursal__c}</b></th>
                  </tr>
                </aura:iteration>
                </tbody>
              </table>
            </div>
            <div class="slds-modal__footer">
              <lightning:button aura:id="closeDisbursalModal"
                                class="slds-button floatRight"
                                onclick="{!c.closeDisbursalModal}" label="Close"/>
            </div>
          </div>
        </div>
      </div>
    </aura:if>
  </div>
</aura:component>