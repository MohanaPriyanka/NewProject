<aura:component controller="CAPController" access="global" extends="c:CAPParent">
  <aura:set attribute="STAGENAME" value="NAV_Personal_Information"/>
  <aura:handler event="c:CAPNavigationEvent" action="{!c.handleNavEvent}"/>
  <aura:attribute name="leadId" type="Id"/>
  <aura:attribute name="leadEmail" type="String"/>
  <aura:attribute name="billingAddressSame" type="Boolean" default="true"/>
  <aura:attribute name="bankAffiliation" type="Boolean"/>
  <aura:attribute name="coAppbankAffiliation" type="Boolean"/>
  <aura:attribute name="coAppAddressSame" type="Boolean" default="true"/>
  <aura:attribute name="states" type="String[]"/>
  <aura:attribute name="coSigner" type="Boolean" default="false"/>
  <aura:attribute name="piLocked" type="Boolean" default="false"
                  description="Set by CAPStart or CAPCreditStatus if credit is already run"/>
  <aura:attribute name="coAppLocked" type="Boolean" default="false"/>
  <lightning:overlayLibrary aura:id="overlayLib"/>

  <!-- INDIVIDUAL OR JOINT -->
  <aura:if isTrue="{!v.page == 'IndividualOrJoint'}">
    <div class="slds-col slds-col--padded slds-p-top--small">
      <form class="slds-form--stacked">
        <div class="slds-form-element slds-is-required">
          <div class="slds-form-element__control">
            {!$Label.c.PI_Individual_or_Joint}
            <ui:inputSelect aura:id="appType" class="slds-input" value="{!v.lead.Application_Type__c}"
                            disabled="{!coAppLocked}">
              <ui:inputSelectOption text="Individual"/> 
              <ui:inputSelectOption text="Joint"/> 
            </ui:inputSelect>
          </div>
        </div>
        <div class="slds-form-element__row slds-p-top--small">
          <lightning:button aura:id="confirmSubmit" label="Next" onclick="{!c.setAppType}"/>
        </div>
      </form>
    </div>
  </aura:if>
  <!-- / INDIVIDUAL OR JOINT -->

  <!-- PRIMARY PI -->
  <aura:if isTrue="{!v.page == 'PrimaryPI'}">
    <div class="slds-col slds-col--padded slds-p-top--small">
      <form class="slds-form--stacked">
        <div class="slds-form-element slds-is-required">
          <div class="slds-form-element__control">
            {!$Label.c.PI_Primary_PI_Next}
          </div>
        </div>
        <div class="slds-grid slds-wrap slds-form-element__row">
          <div class="slds-col_padded slds-large-size_1_of_2 slds-medium-size_1-of-2 slds-small-size_1-of-1" aura:id="firstNameElement">
            <label class="proximaNovaDataBlue">First Name</label>
            <ui:inputText value="{!v.lead.FirstName}" disabled="{!v.piLocked}"/>
          </div>
          <div class="slds-col_padded slds-large-size_1_of_2 slds-medium-size_1-of-2 slds-small-size_1-of-1" aura:id="lastNameElement">
            <label class="proximaNovaDataBlue">Last Name</label>
            <ui:inputText value="{!v.lead.LastName}" disabled="{!v.piLocked}"/>
          </div>
        </div>
        <div class="slds-grid slds-wrap slds-form-element__row">
          <div class="slds-col_padded slds-large-size_1_of_2 slds-medium-size_1-of-2 slds-small-size_1-of-1" aura:id="phoneElement">
            <label class="proximaNovaDataBlue">Phone</label>
            <ui:inputPhone value="{!v.lead.Phone}" disabled="{!v.piLocked}"/>
          </div>
          <div class="slds-col_padded slds-large-size_1_of_2 slds-medium-size_1-of-2 slds-small-size_1-of-1" aura:id="emailElement">
            <label class="proximaNovaDataBlue">Email</label>
            <ui:inputText value="{!v.lead.Email}" disabled="{!v.piLocked}"/>
          </div>
        </div>
        <div class="slds-grid slds-wrap slds-form-element__row slds-p-top_medium">
          <div class="slds-size_1-of-1">
            <label>Installation Address</label>
          </div>
        </div>
        <div class="slds-grid slds-wrap slds-form-element__row">
          <div class="slds-col_padded slds-large-size_1_of_2 slds-medium-size_1-of-2 slds-small-size_1-of-1" aura:id="ownHouseElement">
            <lightning:input type="checkbox" 
                             checked="{!v.lead.lived_residence_six_months__c}"
                             label="I own the house where solar panels will be installed"
                             disabled="{!v.piLocked}"/>
          </div>
        </div>
        <div class="slds-grid slds-wrap slds-form-element__row">
          <div class="slds-col_padded slds-large-size_1_of_2 slds-medium-size_1-of-2 slds-small-size_1-of-1" aura:id="homeAddressElement">
            <label class="proximaNovaDataBlue">Street Address</label>
            <ui:inputText value="{!v.lead.LASERCA__Home_Address__c}" disabled="{!v.piLocked}"/>
          </div>
          <div class="slds-col_padded slds-large-size_1_of_2 slds-medium-size_1-of-2 slds-small-size_1-of-1" aura:id="cityElement">
            <label class="proximaNovaDataBlue">City</label>
            <ui:inputText value="{!v.lead.LASERCA__Home_City__c}" disabled="{!v.piLocked}"/>
          </div>
        </div>
        <div class="slds-grid slds-wrap slds-form-element__row">
          <div class="slds-col_padded slds-large-size_1_of_2 slds-medium-size_1-of-2 slds-small-size_1-of-1">
            <label class="proximaNovaDataBlue">State</label>
            <ui:inputText value="{!v.lead.LASERCA__Home_State__c}" disabled="true"/>
          </div>
          <div class="slds-col_padded slds-large-size_1_of_2 slds-medium-size_1-of-2 slds-small-size_1-of-1" aura:id="zipCodeElement">
            <label class="proximaNovaDataBlue">Zip Code</label>
            <ui:inputText value="{!v.lead.LASERCA__Home_Zip__c}" disabled="{!v.piLocked}"/>
          </div>
        </div>
        <div class="slds-grid slds-wrap slds-form-element__row">
          <div class="slds-col_padded slds-large-size_1_of_2 slds-medium-size_1-of-2 slds-small-size_1-of-1">
            <lightning:input type="checkbox" 
                             checked="{!v.billingAddressSame}"
                             label="My billing address is the same as my installation address"
                             disabled="{!v.piLocked}"/>
          </div>
        </div>
        <aura:if isTrue="{!not(v.billingAddressSame)}">
          <div class="slds-grid slds-wrap slds-form-element__row slds-p-top_medium">
            <div class="slds-size_1-of-1">
              <label>Billing Address</label>
            </div>
          </div>
          <div class="slds-grid slds-wrap slds-form-element__row">
            <div class="slds-col_padded slds-large-size_1_of_2 slds-medium-size_1-of-2 slds-small-size_1-of-1">
              <label class="proximaNovaDataBlue">Billing Street</label>
              <ui:inputText value="{!v.lead.Street}" disabled="{!v.piLocked}"/>
            </div>
            <div class="slds-col_padded slds-large-size_1_of_2 slds-medium-size_1-of-2 slds-small-size_1-of-1">
              <label class="proximaNovaDataBlue">Billing City</label>
              <ui:inputText value="{!v.lead.City}" disabled="{!v.piLocked}"/>
            </div>
          </div>
          <div class="slds-grid slds-wrap slds-form-element__row">
            <div class="slds-col_padded slds-large-size_1_of_2 slds-medium-size_1-of-2 slds-small-size_1-of-1">
              <label class="proximaNovaDataBlue">Billing State</label>
              <ui:inputSelect aura:id="billingState" value="{!v.lead.State}" disabled="{!v.piLocked}">
                <aura:iteration items="{!v.states}" var="state">
                  <ui:inputSelectOption text="{!state}" value="{!state == v.lead.State}"/>
                </aura:iteration>
              </ui:inputSelect>
            </div>
            <div class="slds-col_padded slds-large-size_1_of_2 slds-medium-size_1-of-2 slds-small-size_1-of-1">
              <label class="proximaNovaDataBlue">Billing Zip</label>
              <ui:inputText value="{!v.lead.PostalCode}" disabled="{!v.piLocked}"/>
            </div>
          </div>
        </aura:if>
        <div class="slds-form-element__row slds-p-top--small">
          <lightning:button aura:id="confirmSubmit" label="Save and Next" onclick="{!c.savePI}"/>
        </div>
      </form>
    </div>
  </aura:if>
  <!-- / PRIMARY PI -->

  <!-- PRIMARY SSN -->
  <aura:if isTrue="{!v.page == 'PrimarySSN'}">
    <div class="slds-col slds-col--padded slds-p-top--small">
      <form class="slds-form--stacked">
        <div class="slds-form-element slds-is-required">
          <div class="slds-form-element__control">
            {!$Label.c.PI_Primary_SSN}
          </div>
        </div>
        <div class="slds-grid slds-wrap slds-form-element__row">
          <div class="slds-col_padded slds-large-size_1_of_2 slds-medium-size_1-of-2 slds-small-size_1-of-1" aura:id="ssnElement">
            <label class="proximaNovaDataBlue">Social Security Number</label>
            <ui:inputSecret placeholder="XXX-XX-XXXX" value="{!v.lead.LASERCA__SSN__c}" disabled="{!v.piLocked}"/>
          </div>
          <div class="slds-col_padded slds-large-size_1_of_2 slds-medium-size_1-of-2 slds-small-size_1-of-1" aura:id="birthdateElement">
            <label class="proximaNovaDataBlue">Date of Birth</label>
            <c:BlueWaveDate value="{!v.lead.LASERCA__Birthdate__c}" disabled="{!v.piLocked}"/>
          </div>
        </div>
        <div class="slds-grid slds-wrap slds-form-element__row">
          <div class="slds-col_padded slds-large-size_1_of_2 slds-medium-size_1-of-2 slds-small-size_1-of-1" aura:id="incomeElement">
            <label class="proximaNovaDataBlue">Annual Income</label>
            <ui:inputCurrency value="{!v.lead.Annual_Income_Currency__c}" disabled="{!v.piLocked}"/>
          </div>
          <div class="slds-col_padded slds-large-size_1_of_2 slds-medium-size_1-of-2 slds-small-size_1-of-1" aura:id="mortgageElement">
            <label class="proximaNovaDataBlue">Approximate Monthly Mortgage Payment</label>
            <ui:inputCurrency value="{!v.lead.Monthly_Mortgage_Tax_and_Insurance__c}" disabled="{!v.piLocked}"/>
          </div>
        </div>
        <div class="slds-grid slds-wrap slds-form-element__row">
          <div class="slds-col_padded slds-size_1-of-1" aura:id="creditCheckElement">
            <lightning:input type="checkbox" 
                             checked="{!v.lead.Credit_Check_Acknowledged__c}"
                             label="I give BlueWave and it's affliates permission to access my credit history"
                             disabled="{!v.piLocked}"/>
          </div>
        </div>
        <div class="slds-grid slds-wrap slds-form-element__row" aura:id="privacyPolicyElement">
          <div class="slds-col_padded slds-size_1-of-1 slds-grid">
            <aura:if isTrue="{!v.lenderOfRecord == 'Avidia'}">
              <lightning:input type="checkbox" 
                               checked="{!v.lead.Privacy_Policy_Acknowledged__c}"
                               label="I acknowledge BlueWave's privacy policy and Avidia's privacy policy and accept their terms"
                               disabled="{!v.piLocked}"/>
              <aura:set attribute="else">
                <lightning:input type="checkbox" 
                                 checked="{!v.lead.Privacy_Policy_Acknowledged__c}"
                                 label="I acknowledge BlueWave's privacy policy and accept its terms"
                                 disabled="{!v.piLocked}"/>
              </aura:set>
            </aura:if>
            <div onclick="{!c.handleShowModal}" class="slds-align-middle">
              <lightning:icon class="paddingLeft" iconName="utility:info" size="x-small"/>
            </div>
          </div>
        </div>
        <div class="slds-grid slds-wrap slds-form-element__row">
          <div class="slds-col_padded slds-size_1-of-1">
            <lightning:input type="checkbox" 
                             checked="{!v.bankAffiliation}"
                             label="I am currently employed by or have a service/business affiliation with a bank"
                             disabled="{!v.piLocked}"/>
          </div>
        </div>
        <aura:if isTrue="{!v.bankAffiliation}">
          <div class="slds-grid slds-wrap slds-form-element__row">
            <div class="slds-col_padded slds-size_1-of-1">
              <lightning:input type="checkbox" 
                               checked="{!v.lead.Other_Bank_Executive__c}"
                               label="I am an executive officer or director at a financial institution"
                               disabled="{!v.piLocked}"/>
            </div>
          </div>
          <div class="slds-grid slds-wrap slds-form-element__row">
            <div class="slds-col_padded slds-size_1-of-1">
              <lightning:input type="checkbox" 
                               checked="{!v.lead.Avidia_Service_Provider__c}"
                               label="I am a service provider of Avidia Bank and provide this service:"
                               disabled="{!v.piLocked}"/>
              <aura:if isTrue="{!v.lead.Avidia_Service_Provider__c}">
                <ui:inputSelect aura:id="appType" class="slds-input" value="{!v.lead.Type_of_Avidia_Service_Provider__c}">
                  <ui:inputSelectOption text="Accountant"/> 
                  <ui:inputSelectOption text="Real Estate Appraiser"/> 
                  <ui:inputSelectOption text="Attorney"/> 
                  <ui:inputSelectOption text="Consultant"/> 
                  <ui:inputSelectOption text="None of the above"/> 
                </ui:inputSelect>
              </aura:if>
            </div>
          </div>
        </aura:if>
        <div class="slds-form-element__row slds-p-top--small">
          <lightning:button aura:id="confirmSubmit" label="Save and Next" onclick="{!c.saveSSN}"/>
        </div>
      </form>
    </div>
  </aura:if>
  <!-- / PRIMARY SSN -->

  <!-- CO APPLICANT PI -->
  <aura:if isTrue="{!v.page == 'CoAppPI'}">
    <div class="slds-col slds-col--padded slds-p-top--small">
      <form class="slds-form--stacked">
        <div class="slds-form-element slds-is-required">
          <div class="slds-form-element__control">
            <aura:if isTrue="{!v.coSigner}">
              {!$Label.c.Co_Signer_PI_Next}
              <aura:set attribute="else">
                {!$Label.c.Co_Applicant_PI_Next}
              </aura:set>
            </aura:if>
          </div>
        </div>
        <div class="slds-grid slds-wrap slds-form-element__row">
          <div class="slds-col_padded slds-large-size_1_of_2 slds-medium-size_1-of-2 slds-small-size_1-of-1" aura:id="coAppFirstNameElement">
            <label class="proximaNovaDataBlue">First Name</label>
            <ui:inputText value="{!v.lead.CoApplicant_Contact__r.FirstName}" disabled="{!v.coAppLocked}"/>
          </div>
          <div class="slds-col_padded slds-large-size_1_of_2 slds-medium-size_1-of-2 slds-small-size_1-of-1" aura:id="coAppLastNameElement">
            <label class="proximaNovaDataBlue">Last Name</label>
            <ui:inputText value="{!v.lead.CoApplicant_Contact__r.LastName}" disabled="{!v.coAppLocked}"/>
          </div>
        </div>
        <div class="slds-grid slds-wrap slds-form-element__row">
          <div class="slds-col_padded slds-large-size_1_of_2 slds-medium-size_1-of-2 slds-small-size_1-of-1" aura:id="coAppPhoneElement">
            <label class="proximaNovaDataBlue">Phone</label>
            <ui:inputPhone value="{!v.lead.CoApplicant_Contact__r.Phone}" disabled="{!v.coAppLocked}"/>
          </div>
          <div class="slds-col_padded slds-large-size_1_of_2 slds-medium-size_1-of-2 slds-small-size_1-of-1" aura:id="coAppEmailElement">
            <label class="proximaNovaDataBlue">Email</label>
            <ui:inputText value="{!v.lead.CoApplicant_Contact__r.Email}" disabled="{!v.coAppLocked}"/>
          </div>
        </div>
        <div class="slds-grid slds-wrap slds-form-element__row">
          <div class="slds-col_padded slds-large-size_1_of_2 slds-medium-size_1-of-2 slds-small-size_1-of-1">
            <aura:if isTrue="{!v.coSigner}">
              <lightning:input type="checkbox" 
                               checked="{!v.coAppAddressSame}"
                               label="Co-signers's address is the same"
                               disabled="{!v.coAppLocked}"/>
              <aura:set attribute="else">
                <lightning:input type="checkbox" 
                                 checked="{!v.coAppAddressSame}"
                                 label="Co-applicant's address is the same"
                                 disabled="{!v.coAppLocked}"/>
              </aura:set>
            </aura:if>
          </div>
        </div>
        <aura:if isTrue="{!not(v.coAppAddressSame)}">
          <div class="slds-grid slds-wrap slds-form-element__row">
            <div class="slds-col_padded slds-large-size_1_of_2 slds-medium-size_1-of-2 slds-small-size_1-of-1" aura:id="coAppHomeAddressElement">
              <label class="proximaNovaDataBlue">Street Address</label>
              <ui:inputText value="{!v.lead.CoApplicant_Contact__r.LASERCA__Home_Address__c}" disabled="{!v.coAppLocked}"/>
            </div>
            <div class="slds-col_padded slds-large-size_1_of_2 slds-medium-size_1-of-2 slds-small-size_1-of-1" aura:id="coAppCityElement">
              <label class="proximaNovaDataBlue">City</label>
              <ui:inputText value="{!v.lead.CoApplicant_Contact__r.LASERCA__Home_City__c}" disabled="{!v.coAppLocked}"/>
            </div>
          </div>
          <div class="slds-grid slds-wrap slds-form-element__row">
            <div class="slds-col_padded slds-large-size_1_of_2 slds-medium-size_1-of-2 slds-small-size_1-of-1" aura:id="coAppStateElement">
              <label class="proximaNovaDataBlue">State</label>
              <ui:inputText value="{!v.lead.CoApplicant_Contact__r.LASERCA__Home_State__c}" disabled="{!v.coAppLocked}"/>
            </div>
            <div class="slds-col_padded slds-large-size_1_of_2 slds-medium-size_1-of-2 slds-small-size_1-of-1" aura:id="coAppZipCodeElement">
              <label class="proximaNovaDataBlue">Zip Code</label>
              <ui:inputText value="{!v.lead.CoApplicant_Contact__r.LASERCA__Home_Zip__c}" disabled="{!v.coAppLocked}"/>
            </div>
          </div>
        </aura:if>
        <div class="slds-form-element__row slds-p-top--small">
          <lightning:button aura:id="confirmSubmit" label="Save and Next" onclick="{!c.saveCoAppPI}"/>
        </div>
      </form>
    </div>
  </aura:if>
  <!-- / CO APPLICANT PI -->

  <!-- CO APPLICANT SSN -->
  <aura:if isTrue="{!v.page == 'CoAppSSN'}">
    <div class="slds-col slds-col--padded slds-p-top--small">
      <form class="slds-form--stacked">
        <div class="slds-form-element">
          <div class="slds-form-element__control">
            {!format($Label.c.Co_Applicant_SSN, v.lead.CoApplicant_Contact__r.FirstName)}
          </div>
        </div>
        <div class="slds-grid slds-wrap slds-form-element__row">
          <div class="slds-col_padded slds-large-size_1_of_2 slds-medium-size_1-of-2 slds-small-size_1-of-1" aura:id="coAppSSNElement">
            <label class="proximaNovaDataBlue">Social Security Number</label>
            <ui:inputSecret placeholder="XXX-XX-XXXX" value="{!v.lead.CoApplicant_Contact__r.LASERCA__Social_Security_Number__c}"
                            disabled="{!v.coAppLocked}"/>
          </div>
          <div class="slds-col_padded slds-large-size_1_of_2 slds-medium-size_1-of-2 slds-small-size_1-of-1" aura:id="coAppBirthdateElement">
            <label class="proximaNovaDataBlue">Date of Birth</label>
            <c:BlueWaveDate value="{!v.lead.CoApplicant_Contact__r.LASERCA__Co_Applicant_DOB__c}" disabled="{!v.coAppLocked}"/>
          </div>
        </div>
        <div class="slds-grid slds-wrap slds-form-element__row">
          <div class="slds-col_padded slds-large-size_1_of_2 slds-medium-size_1-of-2 slds-small-size_1-of-1" aura:id="coAppIncomeElement">
            <label class="proximaNovaDataBlue">Annual Income</label>
            <ui:inputCurrency value="{!v.lead.CoApplicant_Contact__r.Income__c}" disabled="{!v.coAppLocked}"/>
          </div>
        </div>
        <div class="slds-grid slds-wrap slds-form-element__row">
          <div class="slds-col_padded slds-size_1-of-1">
            <lightning:input type="checkbox" 
                             checked="{!v.lead.CoApplicant_Contact__r.Credit_Check_Acknowledged__c}"
                             label="I give BlueWave and it's affliates permission to access my credit history"
                             disabled="{!v.coAppLocked}"/>
          </div>
        </div>
        <div class="slds-grid slds-wrap slds-form-element__row">
          <div class="slds-col_padded slds-size_1-of-1 slds-grid">
            <aura:if isTrue="{!v.lenderOfRecord == 'Avidia'}">
              <lightning:input type="checkbox" 
                               checked="{!v.lead.CoApplicant_Contact__r.Privacy_Policy_Acknowledged__c}"
                               label="I acknowledge BlueWave's privacy policy and Avidia's privacy policy and accept their terms"
                               disabled="{!v.coAppLocked}"/>
              <aura:set attribute="else">
                <lightning:input type="checkbox" 
                                 checked="{!v.lead.CoApplicant_Contact__r.Privacy_Policy_Acknowledged__c}"
                                 label="I acknowledge BlueWave's privacy policy accept its terms"
                                 disabled="{!v.coAppLocked}"/>
              </aura:set>
            </aura:if>
            <div onclick="{!c.handleShowModal}" class="slds-align-middle">
              <lightning:icon class="paddingLeft" iconName="utility:info" size="x-small"/>
            </div>
          </div>
        </div>
        <div class="slds-grid slds-wrap slds-form-element__row">
          <div class="slds-col_padded slds-size_1-of-1">
            <lightning:input type="checkbox" 
                             checked="{!v.coAppBankAffiliation}"
                             label="I am currently employed by or have a service/business affiliation with a bank"
                             disabled="{!v.coAppLocked}"/>
          </div>
        </div>
        <aura:if isTrue="{!v.Bank_Affiliation__c}">
          <div class="slds-grid slds-wrap slds-form-element__row">
            <div class="slds-col_padded slds-size_1-of-1">
              <lightning:input type="checkbox" 
                               checked="{!v.lead.CoApplicant_Contact__r.Other_Bank_Executive__c}"
                               label="I am an executive officer or director at a financial institution"
                               disabled="{!v.coAppLocked}"/>
            </div>
          </div>
          <div class="slds-grid slds-wrap slds-form-element__row">
            <div class="slds-col_padded slds-size_1-of-1">
              <lightning:input type="checkbox" 
                               checked="{!v.lead.CoApplicant_Contact__r.Avidia_Service_Provider__c}"
                               label="I am a service provider of Avidia Bank and provide this service:"
                               disabled="{!v.coAppLocked}"/>
              <aura:if isTrue="{!v.lead.CoApplicant_Contact__r.Avidia_Service_Provider__c}">
                <ui:inputSelect aura:id="appType" class="slds-input" value="{!v.lead.CoApplicant_Contact__r.Type_of_Avidia_Service_Provider__c}">
                  <ui:inputSelectOption text="Accountant"/> 
                  <ui:inputSelectOption text="Real Estate Appraiser"/> 
                  <ui:inputSelectOption text="Attorney"/> 
                  <ui:inputSelectOption text="Consultant"/> 
                  <ui:inputSelectOption text="None of the above"/> 
                </ui:inputSelect>
              </aura:if>
            </div>
          </div>
        </aura:if>

        <div class="slds-form-element__row slds-p-top--small">
          <lightning:button aura:id="confirmSubmit" label="Save and Next" onclick="{!c.saveCoAppSSN}"/>
        </div>
      </form>
    </div>
  </aura:if>
  <!-- / CO APPLICANT SSN -->

</aura:component>
