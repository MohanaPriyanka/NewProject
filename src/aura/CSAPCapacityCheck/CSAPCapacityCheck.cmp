<aura:component controller="CSAPController" access="global" implements="forceCommunity:availableForAllPageTypes" extends="c:CSAPParent">
  <aura:attribute name="hasCapacity" type="String"/>
  <aura:attribute name="loading" type="Boolean"/>
  <aura:attribute name="loadingText" type="Boolean"/>
  <aura:attribute name="noCapacityReason" type="String"/>
  <aura:attribute name="attachments" type="Attachment[]"/>
  <aura:attribute name="electricBill1" type="Object"/>
  <aura:attribute name="isLargeFile" type="Boolean"/>
  <aura:attribute name="termsConditions" type="String" default="I agree to BlueWave's Privacy Policy. By checking this box, I also grant
                                                                BlueWave permission to perform a soft pull of my credit history
                                                                (which will NOT impact my credit score), to use my credit history to
                                                                process my application and for any other lawful purpose, to access my
                                                                electric utility billing history, and to contact me via the
                                                                phone number provided on this application.
                                                                I also understand that if I ask BlueWave whether it checked my credit,
                                                                BlueWave will inform me. They will then provide the name and address
                                                                of the consumer reporting agency that provided the information."/>

  <aura:set attribute="STAGENAME" value="NAV_Capacity_Check"/>
  <aura:handler event="c:CSAPNavigationEvent" action="{!c.handleNavEvent}"/>
  <ltng:require styles="{!$Resource.animations}"/>
  <lightning:notificationsLibrary aura:id="notifLib"/>


  <aura:if isTrue="{!v.page == 'CapacityCheck'}">
    <aura:if isTrue="{!v.loading}">
      <div class="slds-icon-eq slds-is-animated slds-align_absolute-center slds-p-top_medium" title="Description of the icon when needed">
        <div class="slds-icon-eq__bar"></div>
        <div class="slds-icon-eq__bar"></div>
        <div class="slds-icon-eq__bar"></div>
        <span class="slds-assistive-text">Text alternative when needed</span>
      </div>
      <div class="slds-text-body--regular slds-align_absolute-center">
        {!v.loadingText}
      </div>
    </aura:if>
    <aura:if isTrue="{!not(v.loading)}">
      <aura:if isTrue="{!v.hasCapacity == 'Yes'}">
        <fieldset class="slds-box slds-theme--default slds-container_center slds-size--11-of-12 slds-large-size--2-of-3">
          <legend id="ssnForm" class="slds-text-heading--medium slds-text-align--center slds-p-vertical--medium slds-align_absolute-center">
            <b class="slds-p-horizontal_large"> Almost finished! </b>
          </legend>
          <div class="slds-align--absolute-center" >
            <b> Upload your electric bill.</b>
          </div>
          <form class="slds-form--stacked">
            <lightning:layout aura:id="uploadBill" class="animated" multipleRows="true" horizontalAlign="center">
              <div class="slds-align--absolute-center slds-text-align--center slds-p-horizontal--large">
                Please upload a recent electric bill so we can determine how much community solar is right for you.
              </div>
              <lightning:layoutItem class="slds-align--absolute-center" padding="around-small" size="12" smallDeviceSize="12" mediumDeviceSize="12">
                <lightning:input  aura:id="field" type="file" name="files" multiple="true" onchange="{!c.handleEBill1}"/>
              </lightning:layoutItem>

                <aura:if isTrue="{!not(empty(v.electricBill1)) || not(empty(v.electricBill2))}">
                  <lightning:layoutItem class="slds-align--absolute-center" padding="around-small" size="12" smallDeviceSize="12" mediumDeviceSize="12">
                  Uploaded Bills:
                  </lightning:layoutItem>
                 <lightning:layoutItem class="slds-align--absolute-center" size="4">
                  <ul>
                    <aura:iteration items="{!v.electricBill1}" var="attachment">
                      <li class="slds-text-body--regular">{!attachment}</li>
                    </aura:iteration>
                    <aura:iteration items="{!v.electricBill2}" var="attachment">
                      <li>{!attachment}</li>
                    </aura:iteration>
                  </ul>
                 </lightning:layoutItem>
                </aura:if>


              <lightning:layoutItem padding="around-small" size="12" smallDeviceSize="12" mediumDeviceSize="12">
                <div class="slds-align--absolute-center" >
                  <b> What happens next?</b>
                </div>
                <div class="slds-align--absolute-center slds-text-align--center slds-p-horizontal--large" >
                  We’ll review your application to ensure everything fits with the community solar farm in your area. We’ll be in touch soon to finalize your subscription and answer any questions you may have before enrolling.
                </div>
              </lightning:layoutItem>
              <lightning:layoutItem padding="around-medium" size="12" smallDeviceSize="12" mediumDeviceSize="12">
                <div class="slds-align--absolute-center" >
                  <b> Terms and Conditions </b>
                </div>
                <lightning:input aura:id="field" name="leadPrivacyPolicyAcknowledged"
                                 label= "{!v.termsConditions}"
                                 type="checkbox"
                                 class="slds-text-body--regular slds-p-horizontal--large slds-align--absolute-center"
                                 checked="{!v.lead.Privacy_Policy_Acknowledged__c}"
                                 onchange="{!c.storeTermsConditions}"
                                 required="true"/>
              </lightning:layoutItem>
              <lightning:layoutItem padding="around-small" size="12" smallDeviceSize="12" mediumDeviceSize="12">
                <div class="slds-align--absolute-center">
                  <lightning:button label="Submit Application" onclick="{!c.finishStage}"/>
                </div>
              </lightning:layoutItem>
            </lightning:layout>
          </form>
        </fieldset>
      </aura:if>

      <aura:if isTrue="{!v.hasCapacity == 'No'}">
        <lightning:layout multipleRows="true" horizontalAlign="center">
          <aura:if isTrue="{!v.noCapacityReason == 'NYHasSolar'}">
            <lightning:layoutItem padding="around-small" size="12" smallDeviceSize="12" mediumDeviceSize="12">
              <div class="slds-align--absolute-center slds-text-body--large--blue">
                <b>Unfortunately, because of state regulations, customers who already have rooftop solar are not eligible to participate in the Community Solar program at this time.</b>
              </div>
            </lightning:layoutItem>
            <lightning:layoutItem padding="around-small" size="12" smallDeviceSize="12" mediumDeviceSize="12">
              <div class="slds-align--absolute-center slds-text-body--large--blue">
                <b>You can now close this window.</b>
              </div>
            </lightning:layoutItem>
          </aura:if>l

          <aura:if isTrue="{!!v.noCapacityReason}">
            <lightning:layoutItem padding="around-small" size="12" smallDeviceSize="12" mediumDeviceSize="12">
              <div class="slds-align--absolute-center slds-text-body--large--blue">
                <b>Unfortunately, we do not have any projects in your area.</b>
              </div>
            </lightning:layoutItem>
            <lightning:layoutItem padding="around-small" size="12" smallDeviceSize="12" mediumDeviceSize="12">
              <div class="slds-align--absolute-center slds-text-body--large--blue">
                <b>You've been added to our wait list and will be notified if and when we have a project in your area!</b>
              </div>
            </lightning:layoutItem>

            <aura:if isTrue="{!v.lead.Application_Source_Phase_2__c == null}">
              <lightning:layoutItem padding="around-small" size="12" smallDeviceSize="12" mediumDeviceSize="12">
                <div class="slds-align--absolute-center slds-text-body--large--blue">
                  <b>You can now close this window.</b>
                </div>
              </lightning:layoutItem>
              <aura:set attribute="else">
                <div class="slds-align--absolute-center slds-text-body--large--blue">
                  <b>If you are not redirected in 5 seconds click the button below to continue the application</b>
                </div>
                <lightning:layoutItem padding="around-small" size="12" smallDeviceSize="12" mediumDeviceSize="12" >
                  <div class="slds-align--absolute-center">
                    <lightning:button label="Continue" onclick="{!c.skipToEnd}"/>
                  </div>
                </lightning:layoutItem>
              </aura:set>
            </aura:if>
          </aura:if>
        </lightning:layout>
      </aura:if>
    </aura:if>
  </aura:if>

  <aura:if isTrue="{!v.page == 'ApplicationComplete'}">
    <fieldset class="slds-box slds-theme--default slds-container_center slds-size--11-of-12 slds-large-size--2-of-3">
      <legend id="ssnForm" class="slds-text-heading--medium slds-text-align--center slds-p-vertical--small slds-align_absolute-center">
        <b class="slds-p-horizontal_large"> All set! We'll take it from here! </b>
      </legend>
      <form class="slds-form--stacked">
        <lightning:layout aura:id="greatNews" class="animated" multipleRows="true" horizontalAlign="center">
          <lightning:layoutItem class="slds-align_absolute-center slds-p-horizontal--large slds-text-align--center" padding="around-medium" size="12" smallDeviceSize="12" mediumDeviceSize="12">
            Thank you for your application. We'll review your utility bill and energy usage, then contact you soon about next steps.
          </lightning:layoutItem>
          <lightning:layoutItem class="slds-align_absolute-center slds-p-horizontal--large slds-text-align--center" padding="around-small" size="12" smallDeviceSize="12" mediumDeviceSize="12">
            In the meantime, check out our Support Center and Blog to learn more about BlueWave Community Solar.
          </lightning:layoutItem>
          <!--<lightning:layoutItem size="12" largeDeviceSize="8" class="slds-grid&#45;&#45;align-center slds-align&#45;&#45;absolute-center slds-m-top&#45;&#45;medium">-->
            <lightning:layoutItem  size = "12" class="slds-align--absolute-center slds-m-top--medium">
              <div style="width: 200px">
                <a href="https://bluewavememberportal.force.com/Support/s/?_ga=2.183388271.870291340.1551394202-1521039906.1540480948">
                  <img src="{!$Resource.resourceIcon}" style="width: 50px"/>
                  <b class="slds-m-left--medium"> Support&nbsp;Center </b>
                </a>
              </div>
            </lightning:layoutItem>
            <lightning:layoutItem size ="12"  class="slds-align--absolute-center slds-m-top--medium slds-m-bottom--large">
              <div style="width: 200px">
                <a href="https://bluewavesolar.com/bw-resources/blog">
                  <img src="{!$Resource.blogIcon}" style="width: 50px"/>
                  <b class="slds-m-left--medium "> BlueWave Blog </b>
                </a>
              </div>
            </lightning:layoutItem>
          <!--</lightning:layoutItem>-->



            <!--<b><lightning:formattedUrl value="https://bluewavesolar.com/bw-resources/blog" label="&nbsp;Blog&nbsp;" tooltip="Go to Blog"/></b>-->
              <!--and-->
            <!--<b><lightning:formattedUrl value="https://bluewavememberportal.force.com/Support/s/?_ga=2.183388271.870291340.1551394202-1521039906.1540480948" label="&nbsp;Resource Center&nbsp;" tooltip="Go to Knowledge Base"/></b>-->
            <!--to learn more about BlueWave community solar.-->

        </lightning:layout>
      </form>
    </fieldset>
  </aura:if>
</aura:component>