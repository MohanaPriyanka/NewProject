<aura:component controller="CSAPController" access="global" extends="c:CSAPParent">
  <aura:attribute name="leadId" type="String"/>
  <aura:attribute name="applyingFor" type="String"/>
  <aura:attribute name="hasCapacity" type="String"/>
  <aura:attribute name="abbrevStates" type="String[]"/>
  <aura:attribute name="partnerId" type="String"/>
  <aura:attribute name="salesRepId" type="String"/>
  <aura:attribute name="loading" type="Boolean"/>
  <aura:attribute name="loadingText" type="Boolean"/>
  <aura:attribute name="referralCode" type="String"/>
  <aura:attribute name="ShowDateError" type="Boolean"/>
  <aura:attribute name="splitZones" type="String[]"/>
  <aura:attribute name="splitUtilities" type="Object[]"/>
  <aura:attribute name="options" type="List" default="[
      {'label': 'Home', 'value': 'Residential'},
      {'label': 'Business or non-profit', 'value': 'Non-Residential'}
      ]"/>
  <aura:attribute name="applicationType" type="String" default="Residential"/>

  <aura:set attribute="STAGENAME" value="NAV_Personal_Information"/>
  <aura:handler event="c:CSAPNavigationEvent" action="{!c.handleNavEvent}"/>
  <aura:handler name="init" value="{!this}" action="{!c.doInit}" />

  <!-- ABOUT_YOURSELF -->
  <aura:if isTrue="{!v.loading}">
    <div class="slds-icon-eq slds-is-animated slds-align_absolute-center slds-p-top_medium" title="Loading">
      <div class="slds-icon-eq__bar"></div>
      <div class="slds-icon-eq__bar"></div>
      <div class="slds-icon-eq__bar"></div>
      <span class="slds-assistive-text">Loading</span>
    </div>
    <div class="slds-text-body--regular slds-align_absolute-center">
      {!v.loadingText}
    </div>
  </aura:if>
  <aura:if isTrue="{!not(v.loading)}">
    <aura:if isTrue="{!v.page == 'AboutYourself'}">
      <div aria-labelledby="aboutYourselfForm">
        <fieldset class="slds-box slds-theme--default slds-container_center slds-size--2-of-3">
          <legend id="aboutYourselfForm" class="slds-text-heading--medium slds-p-vertical--small slds-align_absolute-center">
            <b class="slds-p-horizontal_large">  Great news, we have a project in your area!  </b>
          </legend>
          <div class="slds-align--absolute-center slds-p-horizontal--medium slds-text-align--center">
            To continue, please provide your contact information and billing address so we can verify your eligibility
              for this community solar project and contact you regarding your application. We take privacy and security
              seriously, and never share your personal information without your consent.
          </div>
           <div class="slds-p-bottom--medium slds-align--absolute-center">
             Check out our <lightning:formattedUrl value="https://bluewavesolar.com/privacy-policy" label="&nbsp;Privacy Policy" tooltip="Go to Privacy Policy"/>
          </div>
          <form class="slds-form--stacked">
            <lightning:layout multipleRows="true">
              <lightning:layoutItem padding="around-small" size="6" smallDeviceSize="12" mediumDeviceSize="6">
                <lightning:input aura:id="field" name="leadFirstName"
                                 label="First Name"
                                 value="{!v.lead.FirstName}"
                                 required="true"/>
              </lightning:layoutItem>
              <lightning:layoutItem padding="around-small" size="6" smallDeviceSize="12" mediumDeviceSize="6" >
                <lightning:input aura:id="field" name="leadLastName"
                                 label="Last Name"
                                 value="{!v.lead.LastName}"
                                 required="true"/>
              </lightning:layoutItem>
            </lightning:layout>
            <lightning:layout multipleRows="true">
              <lightning:layoutItem padding="around-small" size="6" smallDeviceSize="12" mediumDeviceSize="6">
                <lightning:input aura:id="field" name="leadEmail"
                                 type="email"
                                 label="Email"
                                 value="{!v.lead.Email}"
                                 required="true"/>
              </lightning:layoutItem>
              <lightning:layoutItem padding="around-small" size="6" smallDeviceSize="12" mediumDeviceSize="6" >
                <lightning:input aura:id="field" name="leadMobilePhone"
                                 type="tel"
                                 label="Mobile Phone"
                                 value="{!v.lead.MobilePhone}"
                                 pattern="[0-9]{10}"
                                 messageWhenPatternMismatch="Please enter your 10 digit mobile phone number"
                                 maxlength="10"
                                 required="true"/>
              </lightning:layoutItem>
            </lightning:layout>
            <!--<lightning:layout multipleRows="true">-->
            <!--<lightning:layoutItem padding="around-small" size="6" smallDeviceSize="12" mediumDeviceSize="6" >-->
            <!--<lightning:input aura:id="field" name="leadPhone"-->
            <!--type="tel"-->
            <!--label="Home Phone (optional)"-->
            <!--value="{!v.lead.Phone}"-->
            <!--maxlength="10"/>-->
            <!--</lightning:layoutItem>-->
            <!--</lightning:layout>-->
            
            <lightning:layout multipleRows="true">
              <aura:if isTrue="{!and(v.lead.Application_Source_Phase_2__c != null, v.lead.Application_Type__c != 'Non-Residential')}">
                <lightning:layoutItem padding="around-small" size="6" smallDeviceSize="12" mediumDeviceSize="6">
                  <lightning:input aura:id="field" name="name"
                                   label="Property Name"
                                   value="{!v.lead.Company}"
                                   required="true"/>
                </lightning:layoutItem>
              </aura:if>
            </lightning:layout>
              <lightning:layout multipleRows="true">
              <lightning:layoutItem padding="around-small" size="6" smallDeviceSize="12" mediumDeviceSize="6">
                <lightning:input aura:id="field" name="leadHomeAddress"
                                 label="Billing Address"
                                 value="{!v.lead.LASERCA__Home_Address__c}"
                                 required="true"/>
              </lightning:layoutItem>
              <lightning:layoutItem padding="around-small" size="6" smallDeviceSize="12" mediumDeviceSize="6" >
                <lightning:input aura:id="field" name="leadHomeCity"
                                 label="City"
                                 value="{!v.lead.LASERCA__Home_City__c}"
                                 required="true"/>
              </lightning:layoutItem>
            </lightning:layout>
            <lightning:layout multipleRows="true">
              <lightning:layoutItem padding="around-small" size="6" smallDeviceSize="12" mediumDeviceSize="6">
                <lightning:select aura:id="field" name="leadHomeState"
                                  label="State"
                                  value="{!v.lead.LASERCA__Home_State__c}"
                                  required="true">
                  <option value="">Choose state...</option>
                  <aura:iteration items="{!v.abbrevStates}" var="s">
                    <option value="{!s}" text="{!s}"></option>
                  </aura:iteration>
                </lightning:select>
              </lightning:layoutItem>
              <lightning:layoutItem padding="around-small" size="6" smallDeviceSize="12" mediumDeviceSize="6" >
                <lightning:input aura:id="field" name="leadHomeZip"
                                 label="Zip Code"
                                 value="{!v.lead.LASERCA__Home_Zip__c}"
                                 required="true"
                                 maxlength="5"
                                 minlength="5"
                                 messageWhenBadInput="Please enter a 5 digit zip-code"/>
              </lightning:layoutItem>
            </lightning:layout>
            <lightning:layout>
              <lightning:layoutItem size="12" smallDeviceSize="12" class="slds-align--absolute-center">
                <div class="slds-align--absolute-center slds-text-body--regular">
                  <lightning:radioGroup aura:id="field"
                                        name="radioApplicationType"
                                        label="I want community solar for my: "
                                        options="{!v.options}"
                                        value="{!v.applicationType}"
                                        type="radio"
                                        class="horizontalRadio slds-text-align--center slds-form-element__horizontal"/>
                </div>
              </lightning:layoutItem>
            </lightning:layout>
          </form>
          <aura:if isTrue="{!v.applicationType == 'Residential'}">
            <div class="slds-clearfix">
              <div class="slds-clearfix slds-p-top_medium">
                <div class="slds-float_right">
                  <aura:if isTrue="{!v.lead.Application_Source_Phase_2__c != null}">
                    <lightning:button label="Cancel Adding Property" onclick="{!c.cancelAddProperty}"/>
                  </aura:if>
                  <lightning:button label="Next" onclick="{!c.goToCheckCapacity}"/>
                </div>
              </div>
            </div>
          </aura:if>
        </fieldset>
      </div>

      <!--BUSINESS FORM-->
      <aura:if isTrue="{!v.applicationType == 'Non-Residential'}">
        <div aria-labelledby="businessForm">
          <fieldset class="slds-box slds-theme--default slds-container_center slds-size--2-of-3">
            <legend id="businessForm" class="slds-text-heading--medium slds-p-vertical--medium slds-align_absolute-center">
              <b class="slds-p-horizontal_large"> Tell us a bit about your business or non-profit </b>
            </legend>
            <form class="slds-form--stacked">
              <lightning:layout multipleRows="true">
                <lightning:layoutItem padding="around-small" size="6" smallDeviceSize="12" mediumDeviceSize="6">
                  <lightning:input aura:id="field" name="leadCompany"
                                   label="Name of Business"
                                   value="{!v.lead.Company}"
                                   maxlength="80"
                                   required="true"/>
                </lightning:layoutItem>
                <lightning:layoutItem padding="around-small" size="6" smallDeviceSize="12" mediumDeviceSize="6" >
                  <lightning:input aura:id="field" name="leadPhone"
                                   type="tel"
                                   label="Phone (optional)"
                                   value="{!v.lead.Phone}"
                                   maxlength="10"/>
                </lightning:layoutItem>
              </lightning:layout>

              <lightning:layout multipleRows="true">
                <lightning:layoutItem padding="around-small" size="6" smallDeviceSize="12" mediumDeviceSize="6" >
                  <lightning:select aura:id="field" name="leadTypeOfBusiness"
                                    label="Type of Business"
                                    value="{!v.lead.Type_of_Business__c}"
                                    required="false">
                    <option value="">Choose one...</option>
                    <option value="Arts/Entertainment/Media">Arts/Entertainment/Media</option>
                    <option value="Automotive">Automotive</option>
                    <option value="Biotechnology/Chemicals">Biotechnology/Chemicals</option>
                    <option value="Construction">Construction</option>
                    <option value="Education">Education</option>
                    <option value="Engineering">Engineering</option>
                    <option value="Facilities">Facilities</option>
                    <option value="Financial Services">Financial Services</option>
                    <option value="Government">Government</option>
                    <option value="Healthcare">Healthcare</option>
                    <option value="Hospitality">Hospitality</option>
                    <option value="Information Technology">Information Technology</option>
                    <option value="Insurance">Insurance</option>
                    <option value="Legal">Legal</option>
                    <option value="Manufacturing/Production">Manufacturing/Production</option>
                    <option value="Marketing">Marketing</option>
                    <option value="Non-Profit">Non-Profit</option>
                    <option value="Real Estate">Real Estate</option>
                    <option value="Religious Organization">Religious Organization</option>
                    <option value="Retail/Wholesale">Retail/Wholesale</option>
                    <option value="Transportation/Warehouse">Transportation/Warehouse</option>
                  </lightning:select>
                </lightning:layoutItem>
                <lightning:layoutItem padding="around-small" size="6" smallDeviceSize="12" mediumDeviceSize="6">
                  <lightning:input aura:id="field" name="leadBusinessTitle"
                                   label="Business Title of Applicant"
                                   value="{!v.lead.Business_Title__c}"
                                   maxlength="25"
                                   messageWhenValueMissing="Please Complete this field. For example: CEO, President, Manager"
                                   required="true"/>
                </lightning:layoutItem>
              </lightning:layout>
            </form>
      <div class="slds-clearfix">
        <div class="slds-clearfix slds-p-top_medium">
          <div class="slds-float_right">
            <aura:if isTrue="{!v.lead.Application_Source_Phase_2__c != null}">
              <lightning:button label="Cancel Adding Property" onclick="{!c.cancelAddProperty}"/>
            </aura:if>
            <lightning:button label="Next" onclick="{!c.goToCheckCapacity}"/>
          </div>
        </div>
      </div>
          </fieldset>
        </div>
      </aura:if>
    </aura:if>


    <!--SPLIT LOAD ZONE PAGE-->
    <!--Page only shows to customer if Zipcode is in Split Load Zone -->
    <!--For NY, does not ask for Load Zone - uses first returned -->
    <aura:if isTrue="{!v.page == 'SplitLoadZone'}">
      <div>
        <fieldset class="slds-box slds-theme--default slds-container_center slds-size--2-of-3">
          <legend id="utilityCheck" class="slds-text-heading--medium slds-p-vertical--medium slds-align_absolute-center">
            <b class="slds-p-horizontal_large"> Help us find you </b>
          </legend>
          <form class="slds-form--stacked">
            <div class="slds-p-horizontal--medium slds-p-bottom--medium slds-text-align--center">
              <b>
                <aura:if isTrue="{!v.lead.State == 'Massachusetts'}">
                  <b>Your zip code is serviced by multiple Load Zones or multiple Utilities. Please consult your utility bill
                  (for National Grid customers) or
                    <lightning:formattedUrl value="https://static1.squarespace.com/static/56fbfd2d37013b142d331d72/t/580fcb5a9de4bb7cf17a798b/1477430108492/RE_MA_Utility_Load_Zones_web.pdf" label="this map" tooltip="Go to Eversource Map"/>
                    (for Eversource) to provide us with your Load Zone or Utility so we can see if we have solar projects that can service you. </b>
                  <aura:set attribute="else">
                    <aura:if isTrue="{!v.lead.State == 'New York'}">
                      <b>Please select your Utility or Load Zone from the list below. You can find this information on your utility bill, or by entering your address in
                        <lightning:formattedUrl value="https://www.arcgis.com/home/webmap/viewer.html?url=https://services1.arcgis.com/Lsfphzk53dXVltQC/ArcGIS/rest/services/NYISO_Zones/FeatureServer/0&amp;source=sd" label="this map." tooltip="Go to NY Map"/>
                      </b>
                      <aura:set attribute="else">
                        <b>Please select your Utility or Load Zone from the list below. You can find this information on your utility bill. </b>
                      </aura:set>
                    </aura:if>
                  </aura:set>
                </aura:if>
              </b>
            </div>
            <lightning:layout multipleRows="true" horizontalAlign="center">
              <aura:if isTrue="{!v.splitZones.length > 1}">
                <lightning:layoutItem padding="around-small" size="4" smallDeviceSize="12" mediumDeviceSize="6">
                  <lightning:select aura:id="loadZone" name="loadZone"
                                    label="Load Zone"
                                    value="{!v.lead.LoadZone__c}"
                                    class="slds-align--absolute-center"
                                    required="true">
                    <option value="{!v.lead.LoadZone__c}">Choose Load Zone...</option>
                    <aura:iteration items="{!v.splitZones}" var="loadZone">
                      <option value="{!loadZone}">{!loadZone}</option>
                    </aura:iteration>
                  </lightning:select>
                </lightning:layoutItem>
              </aura:if>
              <aura:if isTrue="{!v.splitUtilities.length > 1}">
                <lightning:layoutItem padding="around-small" size="4" smallDeviceSize="12" mediumDeviceSize="6">
                  <lightning:select aura:id="utility" name="utility"
                                    label="Utility:"
                                    class="slds-align--absolute-center"
                                    value="{!v.lead.Utility_relationship__c}"
                                    required="true">
                    <option value="{!v.lead.Utility_relationship__c}">Choose Utility...</option>
                    <aura:iteration items="{!v.splitUtilities}" var="utility">
                      <option value="{!utility.Id}" label="{!utility.Name}">{!utility.Name}</option>
                    </aura:iteration>
                  </lightning:select>
                </lightning:layoutItem>
              </aura:if>
            </lightning:layout>
          </form>
      <div class="slds-clearfix">
        <div class="slds-clearfix slds-p-top_medium">
          <div class="slds-float_right">
            <lightning:button label="Next" onclick="{!c.saveUnsplitZone}"/>
          </div>
        </div>
      </div>
        </fieldset>
      </div>
    </aura:if>
  </aura:if>
</aura:component>