<aura:component description="SSFApplication" implements="forceCommunity:availableForAllPageTypes" access="global" controller="SimpleSignupFormController">
    <aura:attribute name="getInfo" type="Boolean"/>
    <aura:attribute name="getPayment" type="Boolean"/>
    <aura:attribute name="showComplete" type="Boolean"/>
    <aura:attribute name="userSelectedPaymentMethod" default="Credit Card" type="String"/>
    <aura:attribute name="spinnerMessage" type="String"/>
    <aura:attribute name="showSpinner" type="Boolean"/>
    <aura:attribute name="showCreditCheckInfoPage" type="Boolean" default="false"/>
    <aura:attribute name="lead" type="Object"/>
    <aura:attribute name="latestCreditReport" type="Object"/>
    <aura:attribute name="partnerVersion" type="Boolean" default="false"/>
    <aura:attribute name="paperlessBilling" type="Boolean" default="true"/>
    <aura:attribute name="collectPaperlessBillingOption" type="Boolean" default="false"/>
    <aura:handler name="init" value="{!this}" action="{!c.doInit}"/>
    <aura:handler event="c:ZuoraPaymentPageComplete" action="{!c.onPaymentMethodComplete}"/>
  
    <div class="slds-align_absolute-center slds-var-p-bottom_x-large ssf-container">
        <c:LightningErrorHandler/>
        <aura:if isTrue="{!v.getInfo}">
            <c:ssfDTC onconsentscomplete="{!c.handleConsents}"/>
        </aura:if>
        <aura:if isTrue="{!v.getPayment}">
            <div class="payment-page slds-p-around_medium">
                <p class="slds-var-p-around_medium slds-text-align_center slds-text-heading_large">
                    Subscribe Now, Pay Later!
                </p>
                <div class="slds-align_absolute-center">
                    <div class="info-text-box2 slds-p-around_small">
                        <p class="text-common" style="font-weight: bold; font-family: sans-serif">You will not be charged anything now.</p>
                        <p class="text-common">We will send you a statement before we charge your card.</p>
                    </div>
                </div>
                <aura:if isTrue="{!v.collectPaperlessBillingOption}">
                    <div class="slds-var-p-top_medium slds-var-p-left_medium slds-var-p-right_medium">
                        <span style="font-weight:bold">Billing Preference</span>
                        <div class="slds-p-around_small">
                            <lightning:input
                              type="checkbox"
                              label="Paperless Billing"
                              value="{!v.paperlessBilling}"
                              name="paperless"
                              checked="{!v.paperlessBilling}"
                              onchange="{!c.setPaperlessBillingOption}"
                              fieldLevelHelp="BlueWave is a paperless billing company. You will receive your first BlueWave bill via mail and email, and after your first billing cycle will be converted to paperless billing. To continue to receive paper bills, uncheck this option.">
                            </lightning:input>
                        </div>
                    </div>
                </aura:if>
                <div class="slds-var-p-around_medium">
                    <div class="slds-var-p-bottom_small">
                        <span style="font-weight:bold">Payment Type</span>
                    </div>
                    <div class="lds-var-p-bottom_small" style="max-width: 220px">
                        <ui:inputSelect class="slds-input"
                                        value="{!v.userSelectedPaymentMethod}">
                            <ui:inputSelectOption label="Bank Account" text="ACH"/>
                            <ui:inputSelectOption label="Credit Card/Debit Card" text="Credit Card"/>
                        </ui:inputSelect>
                    </div>
                    <div class="slds-m-top_medium">
                        <textarea id="payment-page-disclaimer" readonly="" style="resize:vertical; margin: 2px 2px 13px 0px; height: 100px; width: 100%;"> I understand that by clicking "Submit Securely" I am signing this payment authorization with an electronic signature and authorizing BlueWave or its servicer(s), or an assignee or its servicer(s), to initiate monthly debit entries (ACH) on the bank account or monthly charges to the credit card or debit card account designated above, in the amount shown on the monthly billing statement each month, on or after the payment due date shown on my statement. If any payment date falls on a weekend or holiday, I understand and agree that the payment may be executed on the next business day. If necessary, I also authorize BlueWave or its servicer(s), or an assignee or its servicer(s), to initiate one-time credit or debit transactions to correct any erroneous payment transaction. I also authorize BlueWave or its servicer(s), or an assignee or its servicer(s), to (a) initiate a one-time transaction to collect a fee of $0 if any payment is rejected by the bank for any reason (such as insufficient funds), (b) to collect any late fee due under the community solar agreement, or (c) to collect any early termination fee due under the community solar agreement. I understand that any debit entry from the account that is returned unpaid may be collected in the same manner as an unpaid paper check. I understand that the monthly payment amount debited from the bank account or charged to the credit card or debit card account may vary from month to month based on variable generation from the solar project. This authorization will remain in effect until all amounts I owe to BlueWave or an assignee in connection with the community solar agreement have been paid in full or this authorization is cancelled in writing by providing notice of cancellation to BCS Customer Management, LLC, at 111 Huntington Avenue, Suite 650, Boston, MA 02199, or to its designee. I understand and agree that BlueWave must receive written notice of any changes in the account information or termination of this authorization at least three (3) business days prior to the next billing date. I certify that I am the account holder or an authorized signer of the deposit account or the cardholder or an authorized user of the credit card or debt card account identified above, and that I will not dispute any payment initiated by BlueWave or its servicer(s), or an assignee or its servicer(s), provided that the transaction corresponds to the terms of this authorization. If I am signing on behalf of the account holder, I certify that I am authorized to do so, and that the account holder will not dispute any payment initiated by BlueWave or its servicer(s), or an assignee or its servicer(s), provided that the transaction corresponds to the terms of this authorization. If I am authorizing payments from a deposit account, I agree and certify that the account holder agrees to comply with and be bound by the Rules and Operating Guidelines of NACHA (formerly known as the National Automated Clearing House Association). I understand that I should print a copy of this completed authorization for my records.</textarea>
                    </div>
                    <aura:if isTrue="{!v.userSelectedPaymentMethod == 'Credit Card'}">
                        <div class="info-text-box slds-p-around_small slds-m-left_medium slds-m-right_medium slds-m-bottom_medium">
                            <p class="text-common slds-align_absolute-center ">
                                <span style="font-size: smaller">If you use a card for payment, a $1 temporary hold may show up on your card statement and will disappear within a few days.</span>
                            </p>
                        </div>
                    </aura:if>
                    <div class="slds-align_absolute-center">
                        <c:ZuoraPaymentPage
                          paymentType="{!v.userSelectedPaymentMethod}"
                          defaultName="{!join(' ', v.lead.firstName, v.lead.lastName)}"
                          defaultZip="{!v.lead.zipCode}"
                          postOnloadEvent="true">
                        </c:ZuoraPaymentPage>
                    </div>
                </div>
            </div>
        </aura:if>
        <aura:if isTrue="{!v.showCreditCheckInfoPage}">
            <aura:if isTrue="{!!v.showSpinner}">
                <c:ssfCreditPullForm
                    leadId="{!v.lead.id}"
                    latestCreditReport="{!v.latestCreditReport}"
                    onformcomplete="{!c.showComplete}"
                    applicantName="{!join(' ',v.lead.firstName, v.lead.lastName)}"
                    partnerVersion="{!v.partnerVersion}">
                </c:ssfCreditPullForm>
            </aura:if>
        </aura:if>
        <aura:if isTrue="{!v.showComplete}">
            <div class="applicationComplete">
                <p class="slds-var-p-around_medium slds-text-align_center slds-text-heading_large">
                    Application Complete!
                </p>
                <p class="slds-var-p-around_medium slds-text-align_center">
                    Your Community Solar application is now complete and under final review!
                </p>
                <p class="slds-var-p-around_medium slds-text-align_center">
                    We sent a copy of your agreement(s) to the email address provided in the application. If your application is approved based on our eligibility requirements, we will email you the final signed agreement along with other important information about your subscription.
                    Stay tuned, and thank you for choosing BlueWave Community Solar!
                </p>
            </div>
        </aura:if>
        <c:bluewaveSpinner fadeIn="true" spinnerMessage="{!v.spinnerMessage}" show="{!v.showSpinner}"/>
    </div>
</aura:component>