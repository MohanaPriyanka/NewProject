<aura:component implements="forceCommunity:availableForAllPageTypes" controller="SLPAddCustomer" access="global">
  <aura:attribute name="partnerRecord" type="Object" />
  <aura:registerEvent name="apexErrorEvent" type="c:ApexCallbackError"/>
  <aura:attribute name="creditStatusText" type="String"/>
  <aura:attribute name="creditStatusErrorText" type="String"/>
  <aura:attribute name="creditStatusPoller" type="Integer"/>
  <aura:attribute name="creditStatusTimeout" type="Integer"/>

  <style>
    @font-face {
    font-family: proximaNovaFont;
    src: url('{!$Resource.ProximaNova}');
    }
    .proximaNovaDataStream {
    font-family: proximaNovaFont;   
    font-size:100%;
    color: #00b2a9;
    }
    @font-face {
    font-family: proximaNovaFont;
    src: url('{!$Resource.ProximaNova}');
    }
    .proximaNovaDataBlue {
    font-family: proximaNovaFont;   
    font-size:100%;
    color: #266092;
    }        
    @font-face {
    font-family: proximaNovaFont;
    src: url('{!$Resource.ProximaNova}');
    }
    .proximaNovaDataMountaintop {
    font-family: proximaNovaFont;   
    font-size:100%;
    color: #7C98AB;
    }              
  </style> 
  <aura:attribute name="newLead" type="Lead" 
    default="{ 'sobjectType' : 'Lead',
    'FirstName': '',
    'LastName': '',
    'LASERCA__Home_Address__c': '',
    'LASERCA__Home_City__c': '',
    'LASERCA__Home_State__c': '',
    'LASERCA__Home_Zip__c': '',
    'Email': '',
    'LASERCA__Social_Security_Number__c': '',
    'System_Cost__c':'',
    'DOER_Solar_Loan__c':'',
    'Annual_Income_Currency__c':'',
    'Credit_Check_Acknowledged__c':'',
    'Privacy_Policy_Acknowledged__c':'',
    'Automatic_Product_Assignment__c':'true',
    'Loan_Term__c':'',
    'Product_Program__c':'n',
    'Pre_Approval_Form__c':'true',
    'Unfinished_Lead__c':'true',
    'Utility_Bill_Access_Acknowledged__c':'',
    'LASERCA__Birthdate__c':'',
    }"/>
<!--
    Enable during development for convenience
  <aura:attribute name="newLead" type="Lead" 
    default="{ 'sobjectType' : 'Lead',
    'FirstName': 'P',
    'LastName': 'Testcase',
    'LASERCA__Home_Address__c': '1 main',
    'LASERCA__Home_City__c': 'Boston',
    'LASERCA__Home_State__c': 'MA',
    'LASERCA__Home_Zip__c': '02144',
    'Email': 'py@sdf.com',
    'LASERCA__Social_Security_Number__c': '000000001',
    'System_Cost__c':'100',
    'DOER_Solar_Loan__c':'',
    'Annual_Income_Currency__c':'10000',
    'Credit_Check_Acknowledged__c':true,
    'Privacy_Policy_Acknowledged__c':true,
    'Automatic_Product_Assignment__c':true,
    'Loan_Term__c':'',
    'Product_Program__c':'n',
    'Pre_Approval_Form__c':true,
    'Unfinished_Lead__c':true,
    'Utility_Bill_Access_Acknowledged__c':true,
    'LASERCA__Birthdate__c':'1/1/1980',
    }"/>
-->

  <aura:handler name="init" value="{!this}" action="{!c.doInit}" />  
  <aura:if isTrue="{!v.partnerRecord.State__c == 'MA'}">
    <div aura:id="mslpAppButton"  class=" paddingBottom1 paddingTop1x5 noDisplayBar">
      <ui:button label=" Go to MSLP Application" class="slds-button slds-button--brand marginBottom25" press="{!c.changeApplicationToMSLP}">
      </ui:button>
    </div>         
    <div aura:id="bwslAppButton" class="paddingBottom1 paddingTop1x5">
      <ui:button label="Go to BlueWave Solar Loan Application" class="slds-button slds-button--brand" press="{!c.changeApplicationToBWSL}">
      </ui:button>
    </div>
  </aura:if>
  <aura:if isTrue="{!v.partnerRecord.State__c == 'MA'}">                      
    <div aura:id="mslpDisclaimer" class="box">
      <p class="marginAround marginTop proximaNovaDataBlue">
        Pre-Qualification does not guarantee that a loan will be granted.  All loans issued under the Mass Solar Loan Program will require full documentation of income, technical approval from the Massachusetts Clean Energy Center, and proof of identification in order to be fully approved.   If you are pre-qualified, you will need to provide this additional documentation and complete a full application in order to fully process your loan. 
      </p>

      <p class="marginAround  proximaNovaDataBlue">
        Avidia and BlueWave require that solar loan customers to sell their SRECs through BlueWave's long term SREC purchase program. Our SREC purchase program offers competitive rates and both fixed and floating price options.  This program ensures maximum revenue to our customers over time.  
      </p>

      <p class="marginAround  proximaNovaDataBlue">
        The information provided in this application is all we need to make a pre-qualification decision. In order to complete a full application you will need to provide your MassCEC Technical Approval for your solar system, proof of your stated income, and driver's license information, as well as additional personal information. You will be able to return to the full application after your pre-qualification application has been processed. 
      </p>            
      <br></br>
    </div>
  </aura:if>

  <div aura:id = "inputForm" class="box">            
    <div aura:id = "inputFormBox" class="box">
      <aura:if isTrue="{!v.partnerRecord.State__c == 'MA'}">
        <img aura:id = "avidiaLogo" class="slds-align--absolute-center paddingTop1x5 paddingBottom1" src="{!$Resource.avidiaLogo}"/>
      </aura:if>
      <fieldset class="slds-form--compound paddingTop1x5">
        <div class="slds-form-element__group">
          <div class="slds-form-element__row">
            <div class="slds-form-element slds-p-horizontal--small ">
              <label class="slds-form-element__label" for="input-03">First Name</label>
              <ui:inputText aura:id="firstName" class="slds-input" value="{!v.newLead.FirstName}"  />
            </div> 
            <div class="slds-form-element slds-p-horizontal--small ">
              <label class="slds-form-element__label" for="input-03">Last Name</label>
              <ui:inputText aura:id="lastName" class="slds-input" value="{!v.newLead.LastName}"/>          
            </div>   
          </div>
        </div>
      </fieldset>
      <fieldset class="slds-form--compound paddingTop1x5">
        <div class="slds-form-element__group">
          <div class="slds-form-element__row">
            <div class="slds-form-element slds-p-horizontal--small">
              <label class="slds-form-element__label" for="input-03">Email</label>
              <ui:inputText aura:id="email" class="slds-input" value="{!v.newLead.Email}" />          
            </div> 
            <div class="slds-form-element slds-p-horizontal--small slds-grid--align-center ">
              <label class="slds-form-element__label" for="input-03">Date of Birth</label>
              <ui:inputDate aura:id="dateofBirth" 
                            class="slds-input" 
                            format="MM/DD/YYYY"
                            displayDatePicker="false"
                            value="{!v.newLead.LASERCA__Birthdate__c}"/>
            </div>
          </div>
        </div>
      </fieldset>            
      <fieldset class="slds-form--compound">
        <div class="slds-form-element__group">
          <div class="slds-form-element__row">
            <div class="slds-form-element slds-p-horizontal--small">
              <label class="slds-form-element__label" for="input-03">Street Address</label>
              <ui:inputText aura:id="street" class="slds-input" value="{!v.newLead.LASERCA__Home_Address__c}" />          
            </div>                    
            <div class="slds-form-element slds-p-horizontal--small slds-grid--align-center ">
              <label class="slds-form-element__label" for="input-03">City</label>
              <ui:inputText aura:id="city" 
                            class="slds-input"       
                            value="{!v.newLead.LASERCA__Home_City__c}"/>
            </div>
          </div>
        </div>
      </fieldset>  
      <fieldset class="slds-form--compound">
        <div class="slds-form-element__group">
          <div class="slds-form-element__row">
            <div class="slds-form-element slds-p-horizontal--small paddingTop2">
              <label class="slds-form-element__label" for="input-03">State</label>
              <ui:inputSelect aura:id="state" 
                              class="slds-input" 
                              value="{!v.newLead.LASERCA__Home_State__c}" >
                <ui:inputSelectOption text="Select"/>                        
                <ui:inputSelectOption text="AL"/>
                <ui:inputSelectOption text="AK"/>
                <ui:inputSelectOption text="AZ"/>
                <ui:inputSelectOption text="AR"/>
                <ui:inputSelectOption text="CA"/>
                <ui:inputSelectOption text="CO"/>
                <ui:inputSelectOption text="CT"/>
                <ui:inputSelectOption text="DE"/>
                <ui:inputSelectOption text="FL"/>
                <ui:inputSelectOption text="GA"/>
                <ui:inputSelectOption text="HI"/>
                <ui:inputSelectOption text="ID"/>
                <ui:inputSelectOption text="IL"/>
                <ui:inputSelectOption text="IN"/>
                <ui:inputSelectOption text="IA"/>
                <ui:inputSelectOption text="KS"/>
                <ui:inputSelectOption text="KY"/>
                <ui:inputSelectOption text="LA"/>
                <ui:inputSelectOption text="ME"/>
                <ui:inputSelectOption text="MD"/>
                <ui:inputSelectOption text="MA"/>
                <ui:inputSelectOption text="MI"/>
                <ui:inputSelectOption text="MN"/>
                <ui:inputSelectOption text="MS"/>
                <ui:inputSelectOption text="MO"/>
                <ui:inputSelectOption text="MT"/>
                <ui:inputSelectOption text="NE"/>
                <ui:inputSelectOption text="NV"/>
                <ui:inputSelectOption text="NH"/>
                <ui:inputSelectOption text="NJ"/>
                <ui:inputSelectOption text="NM"/>
                <ui:inputSelectOption text="NY"/>
                <ui:inputSelectOption text="NC"/>
                <ui:inputSelectOption text="ND"/>
                <ui:inputSelectOption text="OH"/>
                <ui:inputSelectOption text="OK"/>
                <ui:inputSelectOption text="OR"/>
                <ui:inputSelectOption text="PA"/>
                <ui:inputSelectOption text="RI"/>
                <ui:inputSelectOption text="SC"/>
                <ui:inputSelectOption text="SD"/>
                <ui:inputSelectOption text="TN"/>
                <ui:inputSelectOption text="TX"/>
                <ui:inputSelectOption text="UT"/>
                <ui:inputSelectOption text="VT"/>
                <ui:inputSelectOption text="VA"/>
                <ui:inputSelectOption text="WA"/>
                <ui:inputSelectOption text="WV"/>
                <ui:inputSelectOption text="WI"/>
                <ui:inputSelectOption text="WY"/>
              </ui:inputSelect>
            </div>                  
            <div class="slds-form-element slds-p-horizontal--small">
              <label class="slds-form-element__label" for="input-03">Zip Code</label>
              <ui:inputText aura:id="zip" class="slds-input" value="{!v.newLead.LASERCA__Home_Zip__c}"  />          
            </div>                     
          </div>
        </div>
      </fieldset>
      <br></br>
      <hr></hr>
      <br></br>
      <fieldset class="slds-form--compound">
        <div class="slds-form-element__group">
          <div class="slds-form-element__row">                   
            <div class="slds-form-element slds-p-horizontal--small ">
              <label class="slds-form-element__label" for="input-03">Social Security Number</label>
              <ui:inputSecret aura:id="ssn" class="slds-input" value="{!v.newLead.LASERCA__Social_Security_Number__c}" required="true"/>
            </div>  
            <div class="slds-form-element slds-p-horizontal--small paddingTop1x5">
              <label class="slds-checkbox--toggle slds-grid">
                <label class="slds-form-element__label" for="creditToggle">I give BlueWave and Avidia Bank permission to access my credit history.</label>
                <ui:inputCheckbox name="creditToggle" value="{!v.newLead.Credit_Check_Acknowledged__c}" required="true" />
                <span id="toggle-desc" class="slds-checkbox--faux_container " aria-live="assertive">
                  <span class="slds-checkbox--faux"></span>
                  <span class="slds-checkbox--on bwSecondary">I Approve </span>
                  <span class="slds-checkbox--off"></span>
                </span>
              </label>
            </div>                            
          </div>
        </div>
      </fieldset>
      <fieldset class="slds-form--compound">
        <div class="slds-form-element__group">
          <div class="slds-form-element__row">
            <div class="slds-form-element slds-p-horizontal--small">
              <label class="slds-form-element__label" for="input-03">Requested Loan Amount</label>
              <ui:inputCurrency aura:id="loanAmount" class="slds-input" value="{!v.newLead.System_Cost__c}" required="true"  />          
            </div>                     
            <div class="slds-form-element slds-p-horizontal--small">
              <label class="slds-form-element__label" for="input-03">Estimated Annual Income</label>
              <ui:inputCurrency aura:id="income" class="slds-input" value="{!v.newLead.Annual_Income_Currency__c}" required="true"  />  
            </div>                  
          </div>
        </div>
      </fieldset>  
      <hr></hr>
      <a href="http://bluewaverenewables.com/about-us/privacy-policy/" class="slds-p-horizontal--small"> Click here to view our Privacy Policy</a>
      <fieldset class="slds-form--compound">
        <div class="slds-form-element__group">
          <div class="slds-form-element__row">                 
            <div class="slds-form-element slds-p-horizontal--small paddingTop1x5">
              <label class="slds-checkbox--toggle slds-grid">
                <label class="slds-form-element__label" for="creditToggle">I acknowledge BlueWave's privacy policy and accept its terms.</label>                        
                <ui:inputCheckbox name="interconnectToggle" value="{!v.newLead.Privacy_Policy_Acknowledged__c}" required="true"  />
                <span id="toggle-desc" class="slds-checkbox--faux_container " aria-live="assertive">
                  <span class="slds-checkbox--faux"></span>
                  <span class="slds-checkbox--on bwSecondary">I Approve</span>
                  <span class="slds-checkbox--off"></span>
                </span>
              </label>
            </div>                     
          </div>
        </div>
        <div class="slds-form-element__group">
          <div class="slds-form-element__row">                 
            <div class="slds-form-element slds-p-horizontal--small paddingTop1x5">
              <label class="slds-checkbox--toggle slds-grid">
                <label class="slds-form-element__label" for="energyAccessToggle">I give BlueWave and its affiliates permission to access my energy billing history.</label>
                <ui:inputCheckbox name="interconnectToggle" value="{!v.newLead.Utility_Bill_Access_Acknowledged__c}" required="true"  />
                <span id="toggle-desc" class="slds-checkbox--faux_container " aria-live="assertive">
                  <span class="slds-checkbox--faux"></span>
                  <span class="slds-checkbox--on bwSecondary">I Approve</span>
                  <span class="slds-checkbox--off"></span>
                </span>
              </label>
            </div>                     
          </div>
        </div>                
      </fieldset>  
      <fieldset class="slds-form--compound">
        <div class="slds-form-element__group">
          <div class="slds-form-element__row">                 
            <div class="slds-form-element slds-p-horizontal--small paddingTop1x5 noDisplay">
              <label class="slds-checkbox--toggle slds-grid">
                <label class="slds-form-element__label " for="mslpToggle">MSLP</label>                        
                <ui:inputCheckbox aura:id="mslpToggle" class="" name="mslpToggle" value="{!v.newLead.DOER_Solar_Loan__c}" required="true"  />
                <span id="toggle-desc" class="slds-checkbox--faux_container " aria-live="assertive">
                  <span class="slds-checkbox--faux "></span>
                  <span class="slds-checkbox--on bwSecondary ">I Approve</span>
                  <span class="slds-checkbox--off "></span>
                </span>
              </label>
            </div>                     
          </div>
        </div>             
      </fieldset>        
      <div aura:id="SubmitButton" class="slds-align--absolute-center paddingBottom1 paddingTop1x5">
        <ui:button label="Submit" class="slds-button slds-button--brand" press="{!c.addCustomer}"></ui:button>
      </div>
      <div class="slds-align--absolute-center paddingBottom1 paddingTop1x5">
        <ui:spinner aura:id="leadSpinner" isVisible="false"/>
      </div>
    </div>
  </div>

  <div aura:id="addedCustomerConfirmCredit" class="box noDisplayBar">
    <p class="marginAround marginTop proximaNovaDataBlue">
      <div class="paddingBottom1">
        You've added a new customer and application! 
      </div>
      <div class="paddingBottom1">
        Please double check their information before running a credit report by clicking the button below. If you need to modify the application, please contact BlueWave at 844-830-8270.
      </div>
      <div class="box">
        <fieldset class="slds-form--compound paddingTop1x5">
          <div class="slds-form-element__group">
            <div class="slds-form-element__row">
              <div class="slds-form-element slds-p-horizontal--small ">
                <label class="slds-form-element__label">First Name</label>
                <ui:outputText class="slds-output" value="{!v.newLead.FirstName}"  />
              </div> 
              <div class="slds-form-element slds-p-horizontal--small ">
                <label class="slds-form-element__label">Last Name</label>
                <ui:outputText class="slds-output" value="{!v.newLead.LastName}"/>
              </div>
            </div>
            <div class="slds-form-element__row">
              <div class="slds-form-element slds-p-horizontal--small">
                <label class="slds-form-element__label">Email</label>
                <ui:outputText class="slds-output" value="{!v.newLead.Email}" />
              </div>
              <div class="slds-form-element slds-p-horizontal--small slds-grid--align-center ">
                <label class="slds-form-element__label">Date of Birth</label>
                <ui:outputDate class="slds-outputput" value="{!v.newLead.LASERCA__Birthdate__c}"/>
              </div>
            </div>
            <div class="slds-form-element__row">
              <div class="slds-form-element slds-p-horizontal--small">
                <label class="slds-form-element__label">Street Address</label>
                <ui:outputText class="slds-output" value="{!v.newLead.LASERCA__Home_Address__c}"/>
              </div>
              <div class="slds-form-element slds-p-horizontal--small slds-grid--align-center ">
                <label class="slds-form-element__label">City</label>
                <ui:outputText class="slds-output" value="{!v.newLead.LASERCA__Home_City__c}"/>
              </div>
            </div>
            <div class="slds-form-element__row">
              <div class="slds-form-element slds-p-horizontal--small paddingTop2">
                <label class="slds-form-element__label">State</label>
                <ui:outputText class="slds-output" value="{!v.newLead.LASERCA__Home_State__c}"/>
              </div>
              <div class="slds-form-element slds-p-horizontal--small">
                <label class="slds-form-element__label">Zip Code</label>
                <ui:outputText class="slds-output" value="{!v.newLead.LASERCA__Home_Zip__c}"/>
              </div>
            </div>
            <div class="slds-form-element__row">
              <div class="slds-form-element slds-p-horizontal--small">
                <label class="slds-form-element__label">Requested Loan Amount</label>
                <ui:outputCurrency class="slds-output" value="{!v.newLead.System_Cost__c}"/>
              </div>
              <div class="slds-form-element slds-p-horizontal--small">
                <label class="slds-form-element__label">Estimated Annual Income</label>
                <ui:outputCurrency class="slds-output" value="{!v.newLead.Annual_Income_Currency__c}"/>
              </div>
            </div>
          </div>
        </fieldset>
      </div>
    </p> 
    <hr></hr>
    <div aura:id="pullCreditButtons" class="documentsButtonCenter noDisplayBar">
      <ui:button aura:id="creditStatusButton"
                 class=" box buttonLeft"
                 labelClass=""
                 label="Run Credit Report"
                 press="{!c.checkCredit}"/>
      <ui:button aura:id="addAnotherCustomerButton"
                 class=" box buttonRight"
                 labelClass=""
                 label="Cancel and start a new application"
                 press="{!c.navigateAddAnotherCustomer}"/>
    </div>
    <div class="slds-align--absolute-center">
      <ui:spinner aura:id="creditSpinner" isVisible="false"/>
    </div>
    <div aura:id="creditStatus"
         class="slds-align--absolute-center paddingTop1x5 noDisplay">
      <ui:outputText value="{!v.creditStatusText}"/>
    </div>
    <div aura:id="creditResultPass"
         class="slds-align--absolute-center noDisplay">
      <lightning:button aura:id="continueApplicationButton"
                        class="box"
                        iconName="utility:like"
                        iconPosition="left"
                        label="Credit Approved, Continue Application"
                        onclick="{!c.navigateCreditStatus}"/>
    </div>
    <div aura:id="creditResultPendingReview"
         class="slds-align--absolute-center noDisplay">
      <div class="slds-align--absolute-center">
        <ui:outputText value="Credit status requires additional BlueWave review. Please give us 1-2 business days to review."/>
      </div>
    </div>
    <div aura:id="creditResultUnqualified"
         class="slds-align--absolute-center noDisplay">
      <ui:outputText value="This application cannot be pre-qualified."/>
    </div>
    <div aura:id="creditResultError"
         class="slds-align--absolute-center noDisplay">
      <ui:outputText class="buttonLeft" value="{!'There was an error: ' + v.creditStatusErrorText}"/>
      <ui:button aura:id="startNewApplication"
                 class=" box buttonRight"
                 label="Cancel and start a new application"
                 press="{!c.navigateAddAnotherCustomer}"/>
    </div>
  </div>
</aura:component>
