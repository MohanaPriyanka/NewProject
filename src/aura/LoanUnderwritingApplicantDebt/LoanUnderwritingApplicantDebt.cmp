<aura:component extends="c:BlueWaveParent" controller="LoanUnderwriting">
  <aura:handler name="init" value="{!this}" action="{!c.doInit}" />
  <aura:attribute name="pcr" type="LASERCA__Personal_Credit_Report__c"/>
  <aura:attribute name="tradeAccounts" type="LASERCA__Trade_Accounts__c[]"/>
  <aura:attribute name="adjustedDebt" type="Decimal"/>
  <aura:attribute name="dtiBefore" type="Decimal"/>
  <aura:attribute name="dtiAfter" type="Decimal"/>
  <aura:registerEvent name="debtEvent" type="c:LoanUnderwritingDebtAdjustment"/>

  <div>
    <div class="slds-grid slds-wrap slds-grid--vertical-stretch">
      <div class="darkCell slds-col slds-size--1-of-1">
        Monthly Personal Debt:
        <br></br>
        <ui:outputCurrency value="{!v.adjustedDebt}"/>
      </div> 
    </div>
    <div class="slds-grid slds-wrap">
      <div class="darkCell slds-col slds-size--1-of-1">
        <table class="slds-table slds-table_striped">
          <thead>
            <tr class="slds-text-title_caps">
              <th scope="col">
                <div class="slds-truncate" title="Exclude">Exclude</div>
              </th>
              <th scope="col">
                <div class="slds-truncate" title="Account Name">Account Name</div>
              </th>
              <th scope="col">
                <div class="slds-truncate" title="Account Balance">Balance</div>
              </th>
              <th scope="col">
                <div class="slds-truncate" title="Monthly Payment">Monthly Payment</div>
              </th>
            </tr>
          </thead>
          <tbody>
            <aura:iteration items="{!v.tradeAccounts}" var="tradeAcct">
              <tr>
                <td>
                  <div class="slds-grid">
                    <div class="slds-size--1-of-1">
                      <lightning:input type="checkbox" 
                                       disabled="false" 
                                       label="Exclude"
                                       variant="label-hidden"
                                       name="{!tradeAcct.Id}"
                                       checked="{!tradeAcct.Exclude_From_Rollup__c}"
                                       onchange="{!c.updateExclude}"/>
                    </div>
                    <div class="slds-form-element slds-size--1-of-1">
                      <div class="slds-form-element__icon slds-align-middle">
                        <button class="slds-button slds-button_icon slds-button slds-button_icon"
                                aria-describedby="help"
                                title="Help"
                                name="{!tradeAcct.Id}"
                                onmouseenter="{!c.display}"
                                onmouseleave="{!c.displayOut}">
                          <lightning:icon iconName="utility:info" size="xx-small"/>
                        </button>
                      </div>
                    </div>
                    <div id="{!tradeAcct.Id + '_help'}"
                         class="toggle slds-popover slds-popover_tooltip slds-nubbin_bottom-left"
                         role="tooltip"
                         style="position: absolute; bottom: 30px; left: 30px;">
                      <div class="slds-popover__body">
                        <div class="slds-grid slds-wrap slds-grid--vertical-stretch">
                          <div class="slds-col slds-size--1-of-1">
                            Loan Type: <ui:outputText value="{!tradeAcct.LASERCA__Credit_Loan_Type__c}"/>
                          </div>
                          <div class="slds-col slds-size--1-of-1">
                            Ownership Type: <ui:outputText value="{!tradeAcct.LASERCA__Account_Ownership_Type__c}"/>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </td>
                <td>
                  <div>
                    <ui:outputURL value="{!'/' + tradeAcct.Id}" 
                                  label="{!tradeAcct.Name}" target="_blank"/>
                  </div>
                </td>
                <td>
                  <div>
                    <ui:outputCurrency value="{!tradeAcct.LASERCA__Account_Balance__c}"/>
                  </div>
                </td>
                <td>
                  <div>
                    <ui:outputCurrency value="{!tradeAcct.LASERCA__Monthly_Payment__c}"/>
                  </div>
                </td>
              </tr>
            </aura:iteration> 
          </tbody>
        </table>
      </div>
    </div>
  </div>
</aura:component>
