<!--
 - Created by PeterYao on 2/24/2020.
 -->

<!-- Simple Signup Form Basic Info -->
<template>
    <template if:false={showSpinner}>
        <div class="form">
            <h1 class="slds-size_1-of-1 slds-var-p-around_medium slds-text-align_center">
                Great news! There is community solar available in your area.<br/>
                Tell us a little more about your property.
            </h1>

            <h6>Contact Info<span class="blue-text">&nbsp;&gt;</span></h6>
            <div class="form-section">
                <div class="input-group half">
                    <lightning-input name="firstName" value={restLead.firstName} label="First Name" onchange={genericOnChange} required></lightning-input>
                </div>
                <div class="input-group half">
                    <lightning-input name="lastName" value={restLead.lastName} label="Last Name" onchange={genericOnChange} required></lightning-input>
                </div>
                <div class="input-group half">
                    <lightning-input name="email" value={restLead.email} label="Email" onchange={genericOnChange} type="email" required disabled={resumedApp}></lightning-input>
                </div>
                <template if:true={resiApplicationType}>
                    <div class="input-group half">
                        <lightning-input name="mobilePhone" value={restLead.mobilePhone}  label="Phone" onchange={phoneOnChange} type="tel" required></lightning-input>
                    </div>
                </template>
                <template if:false={sameHomeAddress}>
                    <div class="input-group half">
                        <lightning-input name="streetAddress" class="slds-var-m-bottom_small" label="Street" onchange={genericOnChange} value={restLead.streetAddress} required></lightning-input>
                    </div>
                    <div class="input-group half">
                        <lightning-input name="city" class="slds-var-m-bottom_small" label="City" onchange={genericOnChange} value={restLead.city} required></lightning-input>
                    </div>
                    <div class="input-group half">
                        <lightning-combobox name="state" class="slds-var-m-bottom_small slds-col" label="State" onchange={genericOnChange} options={stateOptions} placeholder="" value={restLead.state} required></lightning-combobox>
                    </div>
                    <div class="input-group half">
                        <lightning-input name="zipCode" class="slds-var-m-bottom_small" label="Zip" onchange={genericOnChange} value={restLead.zipCode} required></lightning-input>
                    </div>
                </template>
                <div class="input-group">
                    <lightning-input class="slds-var-p-left_medium" type="checkbox" label="My home address is the same as the property address on my utility account" checked={sameHomeAddress} onchange={homeAddressToggle}></lightning-input>
                </div>
            </div>
            
            <template if:false={resiApplicationType}>
                <h6>Business Info<span class="blue-text">&nbsp;&gt;</span></h6>
                <div class="form-section">
                    <div class="input-group">
                        <lightning-input name="businessName" value={restLead.businessName} class="slds-var-m-left_small slds-var-m-right_small" label="Name of Business or Organization" onchange={genericOnChange} required></lightning-input>
                    </div>
                    <div class="input-group">
                        <lightning-input name="businessTitle" value={restLead.businessTitle} class="slds-var-m-left_small slds-var-m-right_small"  label="Job Title or Organizational Affiliation" onchange={genericOnChange} required></lightning-input>
                    </div>
                    <div class="input-group">
                        <lightning-input name="businessPhone" value={restLead.businessPhone} class="slds-var-m-left_small slds-var-m-right_small"  label="Business Phone" onchange={phoneOnChange} type="tel" required></lightning-input>
                    </div>
                </div>
            </template>

            <h6>Billing Info<span class="blue-text">&nbsp;&gt;</span></h6>
            <div class="form-section">
                <template if:false={sameBillingAddress}>
                    <div class="input-group half">
                        <lightning-input name="billingStreet" class="slds-var-m-bottom_small" label="Billing Street" onchange={propertyAccountOnChange} value={propertyAccount.billingStreet} required></lightning-input>
                    </div>
                    <div class="input-group half">
                        <lightning-input name="billingCity" class="slds-var-m-bottom_small" label="City" onchange={propertyAccountOnChange} value={propertyAccount.billingCity} required></lightning-input>
                    </div>
                    <div class="input-group half">
                        <lightning-combobox name="billingState" class="slds-var-m-bottom_small slds-col" label="State" onchange={propertyAccountOnChange} options={stateOptions} placeholder="" value={propertyAccount.billingState} required></lightning-combobox>
                    </div>
                    <div class="input-group half">
                        <lightning-input name="billingPostalCode" class="slds-var-m-bottom_small" label="Zip" onchange={propertyAccountOnChange} value={propertyAccount.billingPostalCode} required></lightning-input>
                    </div>
                </template>
                <div class="input-group">
                    <lightning-input class="slds-var-p-left_medium" type="checkbox" label="My billing address is the same as the property address on my utility account" checked={sameBillingAddress} onchange={billingAddressToggle}></lightning-input>
                </div>
            </div>
            
            <h6>Utility Accounts<span class="blue-text">&nbsp;&gt;</span></h6>
            <div class="form-section-accordion">
                <lightning-accordion
                    allow-multiple-sections-open
                    active-section-name={utilityAccountSection}>
                        <template iterator:it={propertyAccount.utilityAccountLogs}>
                            <lightning-accordion-section key={it.value.localid} name={it.value.localid} label={it.value.name}>
                                <template if:false={it.first}>
                                    <template if:false={it.value.doNotDelete}>
                                        <lightning-button-menu name={it.index} key={it.value.localid} slot="actions" alternative-text="Show menu" icon-size="x-small" menu-alignment="auto" onselect={handleUtilityAccountMenu}>
                                            <lightning-menu-item name={it.index} value="remove" label="Remove" ></lightning-menu-item>
                                        </lightning-button-menu>
                                    </template>
                                </template>
                                <div class="form-section accordion" key={it.value.localid}>
                                    <div class="input-group half">
                                        <lightning-input key={it.value.localid}
                                                        data-row-index={it.index}
                                                        name="utilityAccountNumber"
                                                        class="slds-var-m-bottom_small slds-col"
                                                        label="Utility Account Number"
                                                        value={it.value.utilityAccountNumber}
                                                        onchange={utilityAccountOnChange}
                                                        required>
                                        </lightning-input>
                                    </div>
                                    <div class="input-group half">
                                        <lightning-combobox key={it.value.localid}
                                                            data-row-index={it.index}
                                                            placeholder=""
                                                            class="slds-var-m-bottom_small slds-col"
                                                            label="Utility"
                                                            name="selectedUtility"
                                                            value={selectedUtility}
                                                            options={utilityOptions}
                                                            onchange={genericOnChange}
                                                            required>
                                        </lightning-combobox>
                                    </div>
                                    <div class="input-group half">
                                        <lightning-input key={it.value.localid}
                                                        name="nameOnAccount"
                                                        data-row-index={it.index}
                                                        class="slds-var-m-bottom_small"
                                                        label="Name on Account"
                                                        value={it.value.nameOnAccount}
                                                        onchange={utilityAccountOnChange}
                                                        required>
                                        </lightning-input>
                                    </div>
                                    <div class="input-group half"></div>
                                    <div class="input-group half">
                                        <lightning-input key={it.value.localid}
                                                        name="serviceStreet"
                                                        data-row-index={it.index}
                                                        class="slds-var-m-bottom_small"
                                                        label="Service Street Address"
                                                        value={it.value.serviceStreet}
                                                        onchange={utilityAccountOnChange}
                                                        required>
                                        </lightning-input>
                                    </div>
                                    <div class="input-group half">
                                        <lightning-input key={it.value.localid}
                                                        name="serviceCity"
                                                        data-row-index={it.index}
                                                        class="slds-var-m-bottom_small"
                                                        label="City"
                                                        value={it.value.serviceCity}
                                                        onchange={utilityAccountOnChange}
                                                        required>
                                        </lightning-input>
                                    </div>
                                    <div class="input-group half">
                                        <lightning-combobox key={it.value.localid}
                                                            name="serviceState"
                                                            data-row-index={it.index}
                                                            class="slds-var-m-bottom_small slds-col"
                                                            placeholder=""
                                                            label="State"
                                                            value={it.value.serviceState}
                                                            onchange={utilityAccountOnChange}
                                                            options={stateOptions}
                                                            required>
                                        </lightning-combobox>
                                    </div>
                                    <div class="input-group half">
                                        <lightning-input type="select" key={it.value.localid}
                                                        name="servicePostalCode"
                                                        data-row-index={it.index}
                                                        class="slds-var-m-bottom_small"
                                                        label="Zip"
                                                        value={it.value.servicePostalCode}
                                                        onchange={utilityAccountOnChange}
                                                        disabled
                                                        required>
                                        </lightning-input>
                                    </div>
                                    <div class="input-group">
                                        <template if:true={it.value.showUpload}>
                                            <c-ssf-file-upload required input-text="Upload a copy of your utility bill" data-row-index={it.index} onfileuploaded={handleUpload}></c-ssf-file-upload>
                                        </template>
                                    </div>
                                    <div class="input-group">
                                        <template if:true={it.last}>
                                            <lightning-button 
                                                label="Add Another Utility Account"
                                                onclick={addAnotherUtilityAccount}>
                                            </lightning-button>
                                        </template>
                                    </div>
                                </div>
                            </lightning-accordion-section>
                        </template>
                </lightning-accordion>
            </div>
            
            <h6>Other Info<span class="blue-text">&nbsp;&gt;</span></h6>
            <div class="form-section">
                <p class="slds-var-m-around_small">
                    <lightning-input 
                        name="referralName" 
                        label="Partner Code" 
                        field-level-help=""    
                        onchange={genericOnChange}>
                    </lightning-input>
                </p>
            </div>


            <p class="slds-var-m-around_small">
                We take privacy and security seriously. Check out our <b><a target="_blank" rel="noopener noreferrer" style="color:blue" href="https://bluewavesolar.com/privacy-policy">Privacy Policy</a></b> for more details. By clicking continue, you understand and agree that someone from BlueWave may contact you using the email and phone number provided.
            </p>
            <div class="slds-size_1-of-1">
                <button class="btn slds-var-m-around_small slds-float_right" onclick={submitApplication}>Next</button>
            </div>
        </div>
    </template>
    <template if:true={showSpinner}>
        <c-ssf-waiting-room></c-ssf-waiting-room>
    </template>
</template>