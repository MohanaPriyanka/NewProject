<!--
 - Created by PeterYao on 2/24/2020.
 -->

<!-- Simple Signup Form Basic Info -->
<template>
    <template if:false={showSpinner}>
        <div class="form">
            <h1 class="form-header">
                Great news! There is community solar available in your area.<br/>
            </h1>
            <h1 class="form-subheader">
                Tell us a little more about your property.
            </h1>
            
            <template if:false={resiApplicationType}>
                <h6>Business Info<span class="blue-text">&nbsp;&gt;</span></h6>
                <div class="form-section">
                    <div class="input-group half">
                        <lightning-input name="businessName" value={restLead.businessName} label="Name of Business or Organization" onchange={genericOnChange} required></lightning-input>
                    </div>
                    <div class="input-group half">
                        <lightning-input name="businessPhone" value={restLead.businessPhone}  label="Business Phone" onchange={phoneOnChange} type="tel" required></lightning-input>
                    </div>
                    <div class="input-group half">
                        <lightning-input name="businessTitle" value={restLead.businessTitle}  label="Job Title or Organizational Affiliation" onchange={genericOnChange} required></lightning-input>
                    </div>
                    <div class="input-group half">
                        <div if:true={showUnderwritingOptions} class="fieldWithHelp">
                            <lightning-combobox 
                                    name="underwritingCriteria"
                                    class="slds-var-m-bottom_small"
                                    placeholder=""
                                    label="Apply with Guarantor or Financial Documents?"
                                    value={underwritingCriteria}
                                    onchange={genericOnChange}
                                    options={underwritingOptions}
                                    required>
                            </lightning-combobox>
                            <template if:false={isPhone}>
                                <div class="help-icon" title="Click here for more information" onclick={toggleHelp}>
                                    <svg class="help-button__icon" aria-hidden="true">
                                        <use xlink:href="/_slds/icons/action-sprite/svg/symbols.svg#question_post_action"></use>
                                    </svg>
                                    <span class="slds-assistive-text">Click here for more information</span>
                                </div>
                                <template if:true={helpTextVisible} onclick={handleInteriorClick}>
                                    <div class="tooltip tooltip__underwriting-field" role="tooltip" id="help">
                                        <div class="slds-popover__body">
                                            <lightning-formatted-rich-text value={underwritingHelpText}></lightning-formatted-rich-text>
                                        </div>
                                    </div>
                                </template>
                            </template>
                        </div>
                        <template if:true={isPhone}>
                            <div class="slds-text-align_right">
                                <lightning-button
                                    label="[more info]"
                                    variant="base"
                                    onclick={toggleHelp}>
                                </lightning-button>
                                <div if:true={helpTextVisible} class="slds-text-align_left">
                                    <lightning-formatted-rich-text value={underwritingHelpText}></lightning-formatted-rich-text>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>
            </template>

            <h6>Contact Info<span class="blue-text">&nbsp;&gt;</span></h6>
            <div class="form-section">
                <div class="input-group half">
                    <lightning-input name="firstName" value={restLead.firstName} label="First Name" onchange={genericOnChange} required></lightning-input>
                </div>
                <div class="input-group half">
                    <lightning-input name="lastName" value={restLead.lastName} label="Last Name" onchange={genericOnChange} required></lightning-input>
                </div>
                <div class="input-group half">
                    <lightning-input name="email" value={restLead.email} label="Email" onchange={genericOnChange} type="email" required disabled={resumedApp}></lightning-input>
                </div>
                <div class="input-group half">
                    <lightning-input name="mobilePhone" value={restLead.mobilePhone}  label="Phone" onchange={phoneOnChange} type="tel" required></lightning-input>
                </div>
                <template if:true={isFico}>
                    <template if:false={sameHomeAddress}>
                        <div class="input-group half">
                            <lightning-input name="streetAddress" class="slds-var-m-bottom_small" label="Street" onchange={genericOnChange} value={restLead.streetAddress} required></lightning-input>
                        </div>
                        <div class="input-group half">
                            <lightning-input name="city" class="slds-var-m-bottom_small" label="City" onchange={genericOnChange} value={restLead.city} required></lightning-input>
                        </div>
                        <div class="input-group half">
                            <lightning-combobox name="state" class="slds-var-m-bottom_small slds-col" label="State" onchange={genericOnChange} options={stateOptions} placeholder="" value={restLead.state} required></lightning-combobox>
                        </div>
                        <div class="input-group half">
                            <lightning-input name="zipCode" class="slds-var-m-bottom_small" label="Zip" onchange={genericOnChange} value={restLead.zipCode} required></lightning-input>
                        </div>
                    </template>
                    <div class="input-group slds-var-m-top_small">
                        <lightning-input class="slds-var-p-left_medium" type="checkbox" label="My home address is the same as the property address on my utility account" checked={sameHomeAddress} onchange={homeAddressToggle}></lightning-input>
                    </div>
                </template>
            </div>

            <h6>Billing Info<span class="blue-text">&nbsp;&gt;</span></h6>
            <div class="form-section">
                <template if:false={sameBillingAddress}>
                    <div class="input-group half">
                        <lightning-input name="billingStreet" class="slds-var-m-bottom_small" label="Billing Street" onchange={propertyAccountOnChange} value={propertyAccount.billingStreet} required></lightning-input>
                    </div>
                    <div class="input-group half">
                        <lightning-input name="billingCity" class="slds-var-m-bottom_small" label="City" onchange={propertyAccountOnChange} value={propertyAccount.billingCity} required></lightning-input>
                    </div>
                    <div class="input-group half">
                        <lightning-combobox name="billingState" class="slds-var-m-bottom_small slds-col" label="State" onchange={propertyAccountOnChange} options={stateOptions} placeholder="" value={propertyAccount.billingState} required></lightning-combobox>
                    </div>
                    <div class="input-group half">
                        <lightning-input name="billingPostalCode" class="slds-var-m-bottom_small" label="Zip" onchange={propertyAccountOnChange} value={propertyAccount.billingPostalCode} required></lightning-input>
                    </div>
                </template>
                <div class="input-group">
                    <lightning-input class="slds-var-p-left_medium" type="checkbox" label="My billing address is the same as the property address on my utility account" checked={sameBillingAddress} onchange={billingAddressToggle}></lightning-input>
                </div>
            </div>
            
            <h6>Utility Accounts<span class="blue-text">&nbsp;&gt;</span></h6>
            <div class="form-section-accordion">
                <lightning-accordion
                    allow-multiple-sections-open
                    active-section-name={utilityAccountSection}>
                        <template iterator:it={propertyAccount.utilityAccountLogs}>
                            <lightning-accordion-section key={it.value.localid} name={it.value.localid} label={it.value.name}>
                                <template if:false={it.first}>
                                    <template if:false={it.value.doNotDelete}>
                                        <lightning-button-menu name={it.index} key={it.value.localid} slot="actions" alternative-text="Show menu" icon-size="x-small" menu-alignment="auto" onselect={handleUtilityAccountMenu}>
                                            <lightning-menu-item name={it.index} value="remove" label="Remove" ></lightning-menu-item>
                                        </lightning-button-menu>
                                    </template>
                                </template>
                                <div class="form-section accordion" key={it.value.localid}>
                                    <div class="input-group half">
                                        <lightning-input key={it.value.localid}
                                                        data-row-index={it.index}
                                                        name="utilityAccountNumber"
                                                        class="slds-var-m-bottom_small slds-col"
                                                        label="Utility Account Number"
                                                        value={it.value.utilityAccountNumber}
                                                        onchange={utilityAccountOnChange}
                                                        required>
                                        </lightning-input>
                                    </div>
                                    <div class="input-group half">
                                        <lightning-input key={it.value.localid}
                                                        name="nameOnAccount"
                                                        data-row-index={it.index}
                                                        class="slds-var-m-bottom_small"
                                                        label="Name on Account"
                                                        value={it.value.nameOnAccount}
                                                        onchange={utilityAccountOnChange}
                                                        required>
                                        </lightning-input>
                                    </div>
                                    <template if:true={collectRateClass}>
                                        <div class="input-group half">
                                            <lightning-combobox key={it.value.localid}
                                                                name="rateClass"
                                                                data-row-index={it.index}
                                                                class="slds-var-m-bottom_small slds-col"
                                                                placeholder=""
                                                                label="Utility Rate Class"
                                                                value={it.value.rateClass}
                                                                onchange={rateClassOnChange}
                                                                options={rateClassOptions}
                                                                required>
                                            </lightning-combobox>
                                        </div>
                                        <template if:false={isPhone}><div class="input-group half"></div></template>
                                    </template>
                                    <div class="input-group half">
                                        <lightning-input key={it.value.localid}
                                                        name="serviceStreet"
                                                        data-row-index={it.index}
                                                        class="slds-var-m-bottom_small"
                                                        label="Service Street Address"
                                                        value={it.value.serviceStreet}
                                                        onchange={utilityAccountOnChange}
                                                        required>
                                        </lightning-input>
                                    </div>
                                    <div class="input-group half">
                                        <lightning-input key={it.value.localid}
                                                        name="serviceCity"
                                                        data-row-index={it.index}
                                                        class="slds-var-m-bottom_small"
                                                        label="City"
                                                        value={it.value.serviceCity}
                                                        onchange={utilityAccountOnChange}
                                                        required>
                                        </lightning-input>
                                    </div>
                                    <div class="input-group half">
                                        <lightning-combobox key={it.value.localid}
                                                            name="serviceState"
                                                            data-row-index={it.index}
                                                            class="slds-var-m-bottom_small slds-col"
                                                            placeholder=""
                                                            label="State"
                                                            value={it.value.serviceState}
                                                            onchange={utilityAccountOnChange}
                                                            options={stateOptions}
                                                            required>
                                        </lightning-combobox>
                                    </div>
                                    <div class="input-group half">
                                        <lightning-input type="select" key={it.value.localid}
                                                        name="servicePostalCode"
                                                        data-row-index={it.index}
                                                        class="slds-var-m-bottom_small"
                                                        label="Zip"
                                                        value={it.value.servicePostalCode}
                                                        onchange={utilityAccountOnChange}
                                                        disabled
                                                        required>
                                        </lightning-input>
                                    </div>
                                    <div class="input-group half">
                                        <template if:true={it.value.showUpload}>
                                            <c-ssf-file-upload 
                                                    required 
                                                    has-help-text
                                                    input-text="Upload a copy of your utility bill"
                                                    category-type="Customer Utility Bill"
                                                    data-row-index={it.index}
                                                    key={it.value.localid} 
                                                    onfileuploaded={handleUtilityBillUpload}>
                                                <div>
                                                    <p>Why do we need your utility bill?</p>
                                                    <p class="small slds-var-m-bottom_small">We collect images of your bill in order to ensure you receive the appropriate amount of credits. The image of your bill just needs to be legible. Otherwise, we have no preference on format.</p>
                                                    <p>How can you provide it?</p>
                                                    <p class="small">You can obtain the image through the following methods:</p>
                                                    <ul class="slds-list_dotted slds-var-m-bottom_small">
                                                        <li><p class="small">If you have a hard copy of your bill, you can take a picture of or scan the pages and upload the resulting images</p></li>
                                                        <li><p class="small">You can take a screenshot of your bill and upload the resulting images</p></li>
                                                        <li><p class="small">Some utilities allow you to download a pdf of your bill from your account online</p></li>
                                                        <li><p class="small">Maybe there’s something else we haven’t thought of!</p></li>
                                                    </ul>
                                                    <p>What does it need to include?</p>
                                                    <p class="small">Please make sure the bill you provide:</p>
                                                    <ul class="slds-list_dotted slds-var-m-bottom_small">
                                                        <li><p class="small">Is dated within the past 90 days</p></li>
                                                        <li><p class="small">Has no payments over 2 months past due</p></li>
                                                        <li><p class="small">Includes all pages of the bill (you can upload as many as 5 individual pages)</p></li>
                                                    </ul>
                                                    <p class="small">Remember that we’re here to help through chat, email or phone if you need it.</p>
                                                </div>
                                            </c-ssf-file-upload>
                                        </template>
                                    </div>
                                    <template if:true={it.last}>
                                        <template if:false={isFico}>
                                            <div class="input-group half">
                                                <template if:false={isFico}>
                                                    <c-ssf-file-upload 
                                                            required
                                                            has-help-text
                                                            input-text="Upload Financial Documents"
                                                            category-type="Financial Review Documents"
                                                            accepted-file-types={finDocFileTypes}
                                                            onfileuploaded={handleFinancialDocsUpload}>
                                                            <p>Please provide three years of full company financial records.</p>
                                                    </c-ssf-file-upload>
                                                </template>
                                            </div>
                                        </template>
                                    </template>
                                    <div class="input-group">
                                        <template if:true={it.last}>
                                            <div class="combo-button" title="Add another Utility Account" onclick={addAnotherUtilityAccount}>
                                                <svg class="combo-button__icon" aria-hidden="true">
                                                    <use xlink:href="/_slds/icons/utility-sprite/svg/symbols.svg#new"></use>
                                                </svg>
                                                <span class="slds-assistive-text">Add another Utility Account</span>
                                                <p class="combo-button__text">Add another Utility Account</p>
                                            </div>
                                        </template>
                                    </div>
                                </div>
                            </lightning-accordion-section>
                        </template>
                </lightning-accordion>
            </div>
            
            <h6>Other Info<span class="blue-text">&nbsp;&gt;</span></h6>
            <div class="form-section">
                <p class="slds-var-m-around_small">
                    <lightning-input 
                        name="referralName" 
                        label="Referral Code" 
                        field-level-help="Enter the full name of the individual that referred you here. If you don't have a referral code, no problem! You can leave this field blank. "    
                        onchange={genericOnChange}>
                    </lightning-input>
                </p>
            </div>


            <p class="slds-var-m-around_small">
                We take privacy and security seriously. Check out our <b><a target="_blank" rel="noopener noreferrer" style="color:blue" href="https://bluewavesolar.com/privacy-policy">Privacy Policy</a></b> for more details. By clicking continue, you understand and agree that someone from BlueWave may contact you using the email and phone number provided.
            </p>
            <div class="slds-size_1-of-1">
                <button class="btn slds-var-m-around_small slds-float_right" onclick={submitApplication}>Next</button>
            </div>
        </div>
    </template>
    <template if:true={showSpinner}>
        <c-ssf-waiting-room></c-ssf-waiting-room>
    </template>
</template>