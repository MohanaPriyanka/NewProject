<!--
 - Created by peteryao on 2/6/20.
 -->

<!-- Switch -->

<template>
  <div style="width:100%;justify-content: center;display:flex;align-self:center">
    <div style="max-width:788px">
      <div class="slds-grid slds-wrap">
        <div class="slds-size--1-of-1">
          <div onkeyup={checkForSubmit}>
            <lightning-input name="zipCodeInput" class="slds-m-around--small" label="Zip Code" value={zipCodeInput} onchange={genericOnChange} type="text" pattern="[0-9]{5}"></lightning-input>
          </div>
          <template if:false={hasCapacity}>
            <lightning-button label="Submit" class="slds-m-left--small slds-m-right--small" onclick={submitZip}></lightning-button>
          </template>
        </div>
      </div>
      <template if:true={hasCapacity}>
        <div class="slds-grid slds-wrap">
          <div class="slds-size--1-of-1 slds-small-size--1-of-2">
            <lightning-input name="firstName" class="slds-m-left--small slds-m-right--small" label="First Name" onchange={genericOnChange}></lightning-input>
          </div>
          <div class="slds-size--1-of-1 slds-small-size--1-of-2">
            <lightning-input name="lastName" class="slds-m-left--small slds-m-right--small" label="Last Name" onchange={genericOnChange}></lightning-input>
          </div>
          <div class="slds-size--1-of-1 slds-small-size--1-of-2">
            <lightning-input name="email" class="slds-m-left--small slds-m-right--small" label="Email" onchange={genericOnChange} type="email"></lightning-input>
          </div>
          <div class="slds-size--1-of-1 slds-small-size--1-of-2">
            <lightning-input name="phone" class="slds-m-left--small slds-m-right--small" label="Phone" onchange={genericOnChange} type="tel"></lightning-input>
          </div>
        </div>
        <lightning-accordion
          allow-multiple-sections-open
          active-section-name={utilityAccountSection}>
          <template iterator:it={utilityAccounts}>
            <lightning-accordion-section key={it.value.id} name={it.value.id} label="Utility Account">
              <template if:false={it.first}>
                <lightning-button-menu name={it.index} key={it.value.id} slot="actions" alternative-text="Show menu" icon-size="x-small" menu-alignment="auto" onselect={handleUtilityAccountMenu}>
                  <lightning-menu-item name={it.index} value="remove" label="Remove" ></lightning-menu-item>
                </lightning-button-menu>
              </template>
              <div class="slds-grid slds-wrap">
                <div class="slds-size--1-of-1 slds-small-size--1-of-2">
                  <div class="slds-grid">
                    <lightning-input key={it.value.id}
                                     data-row-index={it.index}
                                     name="utilityAccountNumber"
                                     class="slds-m-bottom--small slds-col"
                                     label="Utility Account Number"
                                     value={it.value.utilityAccountNumber}
                                     onchange={utilityAccountOnChange}>
                    </lightning-input>
                    <span class="slds-show_small">
                      <div class="slds-m-right--small"></div>
                    </span>
                  </div>
                </div>
                <div class="slds-size--1-of-1 slds-small-size--1-of-2">
                  <div class="slds-grid">
                    <span class="slds-show_small">
                      <div class="slds-m-right--small"></div>
                    </span>
                    <lightning-combobox key={it.value.id}
                                        data-row-index={it.index}
                                        placeholder=""
                                        class="slds-m-bottom--small slds-col"
                                        label="Utility"
                                        name="selectedUtility"
                                        value={selectedUtility}
                                        options={utilityOptions}
                                        onchange={genericOnChange}>
                    </lightning-combobox>
                  </div>
                </div>
                <div class="slds-size--1-of-1">
                  <lightning-input key={it.value.id}
                                   name="street"
                                   data-row-index={it.index}
                                   class="slds-m-bottom--small"
                                   label="Service Street Address"
                                   value={it.value.street}
                                   onchange={utilityAccountOnChange}>
                  </lightning-input>
                </div>
                <div class="slds-size--1-of-1 slds-small-size--6-of-12">
                  <lightning-input key={it.value.id}
                                   name="city"
                                   data-row-index={it.index}
                                   class="slds-m-bottom--small"
                                   label="City"
                                   value={it.value.city}
                                   onchange={utilityAccountOnChange}>
                  </lightning-input>
                </div>
                <div class="slds-size--1-of-1 slds-small-size--2-of-12">
                  <div class="slds-grid">
                    <span class="slds-show_small slds-col">
                      <div class="slds-m-right--small"></div>
                    </span>
                    <lightning-combobox key={it.value.id}
                                        name="state"
                                        data-row-index={it.index}
                                        class="slds-m-bottom--small slds-col"
                                        placeholder=""
                                        label="State"
                                        value={it.value.state}
                                        onchange={utilityAccountOnChange}
                                        options={stateOptions}>
                    </lightning-combobox>
                    <span class="slds-show_small slds-col">
                      <div class="slds-m-right--small"></div>
                    </span>
                  </div>
                </div>
                <div class="slds-size--1-of-1 slds-small-size--4-of-12">
                  <lightning-input type="select" key={it.value.id}
                                   name="zip"
                                   data-row-index={it.index}
                                   class="slds-m-bottom--small"
                                   label="Zip"
                                   value={it.value.zip}
                                   onchange={utilityAccountOnChange}>
                  </lightning-input>
                </div>
              </div>
              <template if:true={it.last}>
                <lightning-button label="Add Another Utility Account" onclick={addAnotherUtilityAccount}></lightning-button>
              </template>
            </lightning-accordion-section>
          </template>
        </lightning-accordion>

        <lightning-accordion allow-multiple-sections-open>
          <lightning-accordion-section label="Billing Address, if different">
            <div class="slds-grid slds-wrap">
              <div class="slds-size--1-of-1">
                <lightning-input name="billingStreet" class="slds-m-bottom--small" label="Street" onchange={genericOnChange}></lightning-input>
              </div>
              <div class="slds-size--1-of-1 slds-small-size--6-of-12">
                <lightning-input name="billingCity" class="slds-m-bottom--small" label="City" onchange={genericOnChange}></lightning-input>
              </div>
              <div class="slds-size--1-of-1 slds-small-size--2-of-12">
                <div class="slds-grid">
                  <span class="slds-show_small slds-col">
                    <div class="slds-m-right--small"></div>
                  </span>
                  <lightning-combobox name="billingState" class="slds-m-bottom--small slds-col" label="State" onchange={genericOnChange} options={stateOptions} placeholder=""></lightning-combobox>
                  <span class="slds-show_small slds-col">
                      <div class="slds-m-right--small"></div>
                  </span>
                </div>
              </div>
              <div class="slds-size--1-of-1 slds-small-size--4-of-12">
                <lightning-input name="billingZip" class="slds-m-bottom--small" label="Zip" onchange={genericOnChange}></lightning-input>
              </div>
            </div>
          </lightning-accordion-section>
        </lightning-accordion>

        <p class="slds-m-around--small">
          <lightning-input type="checkbox" label="Check to Consent to Electronic Disclosures"></lightning-input>
          By checking this box, entering my email address in the Email field below, and clicking the "Continue" button, I acknowledge that I have reviewed and agree to the BlueWave ESIGN Consent Disclosure  and consent to receive electronic disclosures. The device I will use to receive and access electronic disclosures meets the hardware and software requirements described in the ESIGN Consent Disclosure.
        </p>
        <p class="slds-m-around--small">
          <lightning-input type="checkbox" label="Check to Authorize Credit and Utility Billing Review"></lightning-input>
          By checking this box, and clicking the "Continue" button, I am granting BlueWave permission to perform a soft pull of my credit history (which will NOT impact my credit score) and to access my electric utility billing history, and to use my credit history and my electric utility billing history to process my application and for any other lawful purpose, signature is subject to the additional terms and conditions described here
          <span data-id="authorizationsDots">...</span>
          <span style="display:none" data-id="authorizations">. I understand that by entering my email address in the Email field below and pressing the "Continue" button, I am providing my electronic signature and signing an electronic record that will be my written instructions to obtain my credit history. I understand that if I ask BlueWave whether it checked my credit, BlueWave will tell me, and if it did, provide the name and address of the consumer reporting agency that provided the information.</span>
          <span onclick={handleMoreLess} style="text-decoration:underline;color:blue" data-target-id="authorizations">[Show more]</span>
        </p>
        <p class="slds-m-around--small">
          <lightning-input type="checkbox" label="Check to Sign Community Solar Agreement and CS Disclosure"></lightning-input>
          By checking this box, entering my email address in the Email field below, and clicking the "Continue" button, I acknowledge that I have reviewed and agree to the Community Solar Agreement and Solar Disclosure Form as well as BlueWave's Privacy Policy. I understand that by doing so, I am providing my electronic signature and signing the agreements linked above as electronic records, signature is subject to the additional terms and conditions described here
          <span data-id="agreementDots">...</span>
          <span style="display:none" data-id="agreement">. I am also granting BlueWave permission to contact me via the phone number provided on this application. I also acknowledge that this is an application only and consummation of this transaction does not occur upon the placement of my electronic signature on this contract; rather consummation occurs (meaning that there is an executed agreement between BlueWave and me) after BlueWave verifies my eligibility, approves the document that I have electronically signed, and returns the contract to me with its countersignature.</span>
          <span onclick={handleMoreLess} style="text-decoration:underline;color:blue" data-target-id="agreement">[Show more]</span>
        </p>
        <p class="slds-m-around--small">
          <lightning-input name="referralCode" label="Referral Code" onchange={genericOnChange}></lightning-input>
        </p>
        <lightning-button label="Submit Application" onclick={submitApplication} class="slds-m-around--small"></lightning-button>
      </template>
      <template if:true={showSpinner}>
        <lightning-spinner size="medium"></lightning-spinner>
      </template>
    </div>
  </div>
</template>