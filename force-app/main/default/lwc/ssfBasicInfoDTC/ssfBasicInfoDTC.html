<!--
 - Created by lindsayholmes_gearscrm on 2020-09-14.
 -->
<!-- Simple Signup Form Basic Info: DTC version -->
<template>
    <template if:false={showSpinner}>
        <div class="form">
            <!-- HEADER TEXT -->
            <h1 class="form-header">
                Great news! There is community solar available in your area.<br/>
            </h1>
            <h1 class="form-subheader">
                Tell us a little more about your property.
            </h1>

            <!-- SMB APP FIELDS -->
            <template if:false={resiApplicationType}>
                <h6>Business Info<span class="blue-text">&nbsp;&gt;</span></h6>
                <div class="form-section">
                    <div class="input-group half">
                        <lightning-input
                          name="businessName"
                          value={restLead.businessName}
                          label={businessNameFieldLabel}
                          onchange={genericOnChange}
                          class="slds-var-m-bottom_small"
                          required>
                        </lightning-input>
                    </div>
                    <div class="input-group half">
                        <lightning-input
                          name="businessPhone"
                          value={restLead.businessPhone}
                          label="Business Phone"
                          class="slds-var-m-bottom_small"
                          onchange={phoneOnChange}
                          type="tel"
                          required>
                        </lightning-input>
                    </div>
                    <div class="input-group half">
                        <lightning-input
                          name="businessTitle"
                          value={restLead.businessTitle}
                          max-length="50"
                          message-when-too-long="Please limit to 50 characters"
                          class="slds-var-m-bottom_small"
                          label={businessTitleFieldLabel}
                          onchange={genericOnChange}
                          required>
                        </lightning-input>
                    </div>
                    <template if:true={showUnderwritingOptions} class="fieldWithHelp">
                        <div class="input-group half">
                            <lightning-combobox
                                name="underwritingCriteria"
                                class="slds-var-m-bottom_small"
                                placeholder=""
                                label="Underwriting Method"
                                value={restLead.underwritingCriteria}
                                onchange={genericOnChange}
                                options={underwritingOptions}
                                read-only={underwritingReadOnly}
                                required>
                            </lightning-combobox>
                            <template if:false={isPhone}>
                                <div class="help-icon" title="Click here for more information" onclick={toggleUnderwritingHelp}>
                                    <svg class="help-button__icon" aria-hidden="true">
                                        <use xlink:href="/_slds/icons/action-sprite/svg/symbols.svg#question_post_action"></use>
                                    </svg>
                                    <span class="slds-assistive-text">Click here for more information</span>
                                </div>
                                <template if:true={underwritingHelpTextVisible} onclick={handleInteriorClick}>
                                    <c-ssf-info-box onclose={toggleUnderwritingHelp}>
                                            <lightning-formatted-rich-text value={underwritingHelpText}></lightning-formatted-rich-text>
                                    </c-ssf-info-box>
                                </template>
                            </template>
                            <template if:true={isPhone}>
                                <div class="slds-text-align_right">
                                    <lightning-button
                                        label="[more info]"
                                        variant="base"
                                        onclick={toggleUnderwritingHelp}>
                                    </lightning-button>
                                    <div if:true={helpTextVisible} class="slds-text-align_left">
                                        <lightning-formatted-rich-text value={underwritingHelpText}></lightning-formatted-rich-text>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </template>
                    <template if:false={underwritingReadOnly}>
                        <template if:true={isFinDocsUnderwriting}>
                            <div class="input-group half">
                                <c-ssf-file-upload
                                  required
                                  has-help-text
                                  input-text="Upload Financial Documents"
                                  category-type="Financial Review Documents"
                                  accepted-file-types={finDocFileTypes}
                                  onfileuploaded={handleFinancialDocsUpload}>
                                    <p>Please provide three years of full company financial records including total assets, total liabilities, and net income.</p>
                                </c-ssf-file-upload>
                            </div>
                        </template>
                    </template>
                </div>
            </template>

            <!-- CONTACT INFO -->
            <h6>Contact Info<span class="blue-text">&nbsp;&gt;</span></h6>
            <div class="form-section">
                <div class="input-group half">
                    <lightning-input
                      name="firstName"
                      value={restLead.firstName}
                      class="slds-var-m-bottom_small"
                      label="First Name"
                      onchange={genericOnChange}
                      required>
                    </lightning-input>
                </div>
                <div class="input-group half">
                    <lightning-input
                      name="lastName"
                      value={restLead.lastName}
                      class="slds-var-m-bottom_small"
                      label="Last Name"
                      onchange={genericOnChange}
                      required>
                    </lightning-input>
                </div>
                <div class="input-group half">
                    <lightning-input
                      name="email"
                      value={restLead.email}
                      label="Email"
                      class="slds-var-m-bottom_small"
                      onchange={setAndValidateContactEmail}
                      type="email"
                      required
                      disabled={resumedApp}
                      data-field-name="contactEmail">
                    </lightning-input>
                </div>
                <div class="input-group half">
                    <lightning-input
                      name="mobilePhone"
                      value={restLead.mobilePhone}
                      label="Phone"
                      class="slds-var-m-bottom_small"
                      onchange={phoneOnChange}
                      type="tel"
                      required>
                    </lightning-input>
                </div>
            </div>
            <div class="form-section">
                <template if:true={isFicoUnderwriting}>
                    <template if:false={sameHomeAddress}>
                        <c-ssf-address
                          class="form-section slds-p-around_none"
                          data-object="restLead"
                          object-name="restLead"
                          street={restLead.streetAddress}
                          subpremise={restLead.subpremise}
                          city={restLead.city}
                          state={restLead.state}
                          zip={restLead.zipCode}
                          field-names={addressFields.restLead}
                          state-options={stateOptions}
                          field-level-help="This address will be used to perform a soft credit pull, please be sure it is associated with you, and not a P.O. Box or business address."
                          zip-code-input={zipinput}
                          utility-zip-codes-served={zipCheckResponse.utilityZipCodesServed}
                          onsetaddress={onSetAddressEvent}
                          required>
                        </c-ssf-address>
                    </template>
                    <div class="input-group half">
                        <lightning-input
                          name="birthdate"
                          label="Date of Birth"
                          onchange={genericOnChange}
                          field-level-help="Providing date of birth can help find a credit match."
                          type="date"
                          value={restLead.birthdate}
                          class="slds-var-m-bottom_small"
                          required>
                        </lightning-input>
                    </div>
                </template>
            </div>

            <!-- BILLING INFO -->
            <h6>Billing Info<span class="blue-text">&nbsp;&gt;</span></h6>
            <div class="form-section">
                <template if:false={sameBillingAddress}>
                    <c-ssf-address
                      class="form-section slds-p-around_none"
                      data-object="propertyAccount"
                      object-name="propertyAccount"
                      street={propertyAccount.billingStreet}
                      subpremise={propertyAccount.subpremise}
                      city={propertyAccount.billingCity}
                      state={propertyAccount.billingState}
                      zip={propertyAccount.billingPostalCode}
                      state-options={stateOptions}
                      field-names={addressFields.propertyAccount}
                      field-level-help={billingInfoFieldLevelHelp}
                      zip-code-input={zipinput}
                      utility-zip-codes-served={zipCheckResponse.utilityZipCodesServed}
                      onsetaddress={onSetAddressEvent}
                      required>
                    </c-ssf-address>
                </template>
                <div class="input-group">
                    <lightning-input
                      class="slds-var-p-left_medium"
                      type="checkbox"
                      label="My billing address is the same as the property address on my utility account"
                      checked={sameBillingAddress}
                      onchange={billingAddressToggle}>
                    </lightning-input>
                </div>
            </div>

            <!-- UTILITY ACCOUNTS -->
            <h6>Utility Accounts<span class="blue-text">&nbsp;&gt;</span></h6>
            <div class="form-section-accordion">
                <lightning-accordion allow-multiple-sections-open active-section-name={utilityAccountSection}>
                        <template iterator:it={propertyAccount.utilityAccountLogs}>
                            <lightning-accordion-section key={it.value.localid} name={it.value.localid} label={it.value.name}>
                                <template if:false={it.first}>
                                    <template if:false={it.value.doNotDelete}>
                                        <lightning-button-menu
                                          name={it.index}
                                          key={it.value.localid}
                                          slot="actions"
                                          alternative-text="Show menu"
                                          icon-size="x-small"
                                          menu-alignment="auto"
                                          onselect={handleUtilityAccountMenu}>
                                            <lightning-menu-item
                                              name={it.index}
                                              value="remove"
                                              label="Remove">
                                            </lightning-menu-item>
                                        </lightning-button-menu>
                                    </template>
                                </template>
                                <div class="form-section accordion" key={it.value.localid}>
                                    <div class="input-group half ssf-basic-info__account-name-wrapper">
                                        <lightning-input
                                          key={it.value.localid}
                                          name="nameOnAccount"
                                          data-row-index={it.index}
                                          class="slds-var-m-bottom_small"
                                          label="Name on Account"
                                          value={it.value.nameOnAccount}
                                          onchange={utilityAccountOnChange}
                                          required>
                                        </lightning-input>
                                    </div>
                                    <div class="input-group half">
                                        <lightning-input
                                            key={it.value.localid}
                                            data-row-index={it.index}
                                            data-ual-number-index={it.index}
                                            name="utilityAccountNumber"
                                            class="slds-var-m-bottom_small slds-col"
                                            label={ualNumFieldLabel}
                                            field-level-help="Please ensure the utility account number exactly matches what's found on your utility bill."
                                            value={it.value.utilityAccountNumber}
                                            onchange={utilityAccountOnChange}
                                            onblur={validateUtilityAccount}
                                            required>
                                        </lightning-input>
                                    </div>
                                    <div class="input-group half">
                                        <lightning-input
                                            key={it.value.localid}
                                            data-row-index={it.index}
                                            data-ual-number-reentry-index={it.index}
                                            onpaste={preventDefaultEvent}
                                            name="utilityAccountNumberReentry"
                                            class="slds-var-m-bottom_small slds-col"
                                            label={ualNumReentryFieldLabel}
                                            field-level-help="Please re-enter your Utility Account Number for verification purposes."
                                            value={it.value.utilityAccountNumberReentry}
                                            onchange={utilityAccountOnChange}
                                            required>
                                        </lightning-input>
                                    </div>
                                    <template if:true={collectPOD}>
                                        <div class="input-group half">
                                            <lightning-input
                                              key={it.value.localid}
                                              data-row-index={it.index}
                                              data-pod-id-index={it.index}
                                              name="podId"
                                              class="slds-var-m-bottom_small slds-col"
                                              label={podEntryFieldLabel}
                                              field-level-help="PoD ID for your utility account. This can be found on your utility bill. For NYSEG and RG&E this is 15 characters long, starting in N01 or R01."
                                              value={it.value.podId}
                                              onchange={utilityAccountOnChange}
                                              onblur={validateUtilityAccount}
                                              required>
                                            </lightning-input>
                                        </div>
                                        <div class="input-group half">
                                            <lightning-input
                                              key={it.value.localid}
                                              data-row-index={it.index}
                                              data-pod-id-reentry-index={it.index}
                                              onpaste={preventDefaultEvent}
                                              name="podIdReentry"
                                              class="slds-var-m-bottom_small slds-col"
                                              label={podReentryFieldLabel}
                                              field-level-help="Please re-enter the PoD ID for verification purposes."
                                              value={it.value.podIdReentry}
                                              onchange={utilityAccountOnChange}
                                              required>
                                            </lightning-input>
                                        </div>
                                    </template>
                                    <template if:true={collectRateClass}>
                                        <div class="input-group half">
                                            <lightning-combobox
                                                key={it.value.localid}
                                                name="rateClass"
                                                data-row-index={it.index}
                                                class="slds-var-m-bottom_small slds-col"
                                                placeholder=""
                                                label="Utility Rate Class"
                                                value={it.value.rateClass}
                                                onchange={rateClassOnChange}
                                                options={rateClassOptions}
                                                required>
                                            </lightning-combobox>
                                        </div>
                                    </template>
                                    <c-ssf-address
                                      key={it.value.localid}
                                      data-row-index={it.index}
                                      data-object="utilityAccountLog"
                                      index={it.index}
                                      class="form-section slds-p-around_none"
                                      object-name="utilityAccountLog"
                                      street={it.value.serviceStreet}
                                      subpremise= {it.value.subpremise}
                                      city={it.value.serviceCity}
                                      state={it.value.serviceState}
                                      zip={it.value.servicePostalCode}
                                      latitude={it.value.latitude}
                                      longitude={it.value.longitude}
                                      field-names={addressFields.utilityAccountLog}
                                      field-level-help="Please ensure the service street address exactly matches what's found on your utility bill."
                                      zip-code-input={zipinput}
                                      utility-zip-codes-served={zipCheckResponse.utilityZipCodesServed}
                                      state-options={stateOptions}
                                      onsetaddress={onSetAddressEvent}
                                      required>
                                    </c-ssf-address>
                                    <template if:true={it.value.showUpload}>
                                        <div class="input-group half">
                                            <c-ssf-file-upload
                                                required
                                                has-help-text
                                                input-text="Upload a copy of your utility bill"
                                                category-type="Customer Utility Bill"
                                                data-row-index={it.index}
                                                key={it.value.localid}
                                                onfileuploaded={handleUtilityBillUpload}>
                                                <div>
                                                    <p>Why do we need your utility bill?</p>
                                                    <p class="small slds-var-m-bottom_small">We collect images of your bill in order to ensure you receive the appropriate amount of credits. The image of your bill just needs to be legible. Otherwise, we have no preference on format.</p>
                                                    <p>How can you provide it?</p>
                                                    <p class="small">You can obtain the image through the following methods:</p>
                                                    <ul class="slds-list_dotted slds-var-m-bottom_small">
                                                        <li><p class="small">If you have a hard copy of your bill, you can take a picture of or scan the pages and upload the resulting images</p></li>
                                                        <li><p class="small">You can take a screenshot of your bill and upload the resulting images</p></li>
                                                        <li><p class="small">Some utilities allow you to download a pdf of your bill from your account online</p></li>
                                                        <li><p class="small">Maybe there’s something else we haven’t thought of!</p></li>
                                                    </ul>
                                                    <p>What does it need to include?</p>
                                                    <p class="small">Please make sure the bill you provide:</p>
                                                    <ul class="slds-list_dotted slds-var-m-bottom_small">
                                                        <li><p class="small">Is dated within the past 90 days</p></li>
                                                        <li><p class="small">Has no payments over 2 months past due</p></li>
                                                        <li><p class="small">Includes all pages of the bill (you can upload as many as 5 individual pages)</p></li>
                                                    </ul>
                                                    <p class="small">Remember that we’re here to help through chat, email or phone if you need it.</p>
                                                </div>
                                            </c-ssf-file-upload>
                                        </div>
                                    </template>
                                    <div class="input-group">
                                        <template if:true={it.last}>
                                            <div
                                              class="combo-button"
                                              title="Add another Utility Account"
                                              onclick={addAnotherUtilityAccount}>
                                                <svg class="combo-button__icon" aria-hidden="true">
                                                    <use xlink:href="/_slds/icons/utility-sprite/svg/symbols.svg#new"></use>
                                                </svg>
                                                <span class="slds-assistive-text">Add another Utility Account</span>
                                                <p class="combo-button__text">Add another Utility Account</p>
                                            </div>
                                        </template>
                                    </div>
                                </div>
                            </lightning-accordion-section>
                        </template>
                </lightning-accordion>
            </div>

            <!-- OTHER INFO -->
            <h6>Other Info<span class="blue-text">&nbsp;&gt;</span></h6>
            <div class="form-section">
                <p class="slds-var-m-around_small">
                    <lightning-input 
                        name="referralName" 
                        label="Referral Code" 
                        field-level-help="Enter the full name of the individual that referred you here. If you don't have a referral code, no problem! You can leave this field blank. "    
                        onchange={genericOnChange}>
                    </lightning-input>
                </p>
            </div>

            <!-- FOOTER -->
            <p class="slds-var-m-around_small">
                We take privacy and security seriously. Check out our <b><a target="_blank" rel="noopener noreferrer" style="color:#1A5FEA" href={label.companyPrivacyPolicyLink}>Privacy Policy</a></b> for more details. By clicking "Next", I understand and agree that someone from {label.companyShortName} may contact me using the email and phone number provided.
            </p>
            <div class="slds-size_1-of-1">
                <button class="btn slds-var-m-around_small slds-float_right" onclick={submit}>Next</button>
            </div>
        </div>
    </template>

    <!-- DUPLICATE MODAL -->
    <template if:true={showModal}>
         <c-duplicate-modal show={showModal} lead-id={duplicateLeadId} ></c-duplicate-modal>
    </template>

    <!-- ADDRESS VALIDATION MODAL -->
    <c-ssf-address-validation-modal
      show={showAddressValidationModal}
      onupdateaddresses={onUpdateAddresses}
      onclosemodal={onCloseModal}>
    </c-ssf-address-validation-modal>
</template>