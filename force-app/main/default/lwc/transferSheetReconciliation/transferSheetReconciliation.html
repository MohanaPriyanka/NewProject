<template>
    <!-- HEADER -->
    <div class="slds-box slds-theme_inverse slds-theme_alert-texture slds-grid slds-wrap">
        <div class="slds-size_3-of-3 slds-text-heading_medium">Transfer Sheet Reconciliation {titleSupplement}</div>
        <div class="slds-col slds-size_1-of-4 slds-p-bottom_medium slds-align_absolute-center">
            <c-bluewave-file-upload
              record-id={recordId}
              category-type={categoryTypeTransfer}
              accepted-file-types={fileTypes}
              onfileuploaded={refreshData}>
            </c-bluewave-file-upload>
        </div>
        <div class="slds-col slds-size_2-of-4">
            <div class="slds-align_absolute-center">
                <lightning-button-icon
                  icon-name="utility:sync"
                  variant="bare-inverse"
                  onclick={refreshData}
                  size="large"
                  class="slds-m-left_xx-small">
                </lightning-button-icon>
                <div class="slds-text-heading_small slds-p-left_small">Recalculate</div>
            </div>
        </div>
        <div class="slds-col slds-size_1-of-4 slds-align_absolute-center">
            <template if:true={allResolved}>
                <lightning-button
                  label="Insert UASBs"
                  title="Insert UASBs"
                  onclick={insertBills}>
                </lightning-button>
            </template>
        </div>
    </div>

    <!-- START TABLE SECTION -->
    <div class="slds-box slds-theme_shade slds-theme_alert-texture">
        <div class="slds-theme_default">
            <!-- START NON-UCB TRANSFER DATA -->
            <template if:false={UCB}>
                <table>
                    <tr>
                        <th class="slds-theme_inverse" colspan="5">
                            <div class="slds-align_absolute-center">Bluewave Calculated</div>
                        </th>
                        <th class="slds-theme_alt-inverse slds-theme_alert-texture" colspan="2">
                            <div class="slds-align_absolute-center">COMPARISON</div>
                        </th>
                        <th class="slds-theme_inverse" colspan="4">
                            <div class="slds-align_absolute-center">Utility Transfer Sheet</div>
                        </th>
                    </tr>
                    <tr class="slds-theme_alt-inverse slds-theme_alert-texture">
                        <th class="slds-p-around_xx-small nameColumn">Customer Name</th>
                        <th class="slds-p-around_xx-small">Utility Number</th>
                        <th class="slds-p-around_xx-small">Production</th>
                        <th class="slds-p-around_xx-small">Credits</th>
                        <th class="slds-p-around_xx-small">Credit Value</th>
                        <th class="slds-p-around_xx-small matchText matchStatusColumn">Match Status</th>
                        <th class="slds-p-around_xx-small matchText">Resolution</th>
                        <th class="slds-p-around_xx-small">Utility Number</th>
                        <th class="slds-p-around_xx-small">Production</th>
                        <th class="slds-p-around_xx-small">Credits</th>
                        <th class="slds-p-around_xx-small">Credit Value</th>
                    </tr>
                    <template for:each={uasbData} for:item='item'>
                        <tr key={item.uniqueId} class={item.rowStyle}>
                            <td class={item.leftPanelStyle}>{item.customerName}</td>
                            <td class={item.leftPanelStyle}>{item.exceptionPrefix}{item.sfUtilityAccount}</td>
                            <td class={item.leftPanelStyle}>{item.sfProduction}</td>
                            <td class={item.leftPanelStyle}>{item.sfCredits}</td>
                            <td class={item.leftPanelStyle}>{item.sfCreditValue}</td>
                            <!-- MATCHING ROW -->
                            <template if:true={item.isMatch}>
                                <td class="slds-p-around_xx-small slds-theme_success matchText matchStatusColumn">
                                    <span>MATCH</span>
                                </td>
                                <td class="resolutionColumn matchText slds-p-around_xx-small slds-theme_success">Not Needed</td>
                            </template>
                            <!-- CREDIT MISMATCH ROW -->
                            <template if:true={item.isCreditMismatch}>
                                <td class="slds-p-around_xx-small slds-theme_shade slds-theme_warning matchText matchStatusColumn">
                                    <lightning-helptext
                                      icon-name="utility:back"
                                      class= "slds-p-around_xx-small"
                                      content="Do you want to bill off transfer sheet or salesforce value?">
                                    </lightning-helptext>
                                    <span>MISMATCH</span>
                                    <lightning-helptext
                                      icon-name="utility:forward"
                                      class= "slds-p-around_xx-small"
                                      content="Do you want to bill off transfer sheet or salesforce value?">
                                    </lightning-helptext>
                                </td>
                                <td class="resolutionColumn slds-theme_shade slds-theme_warning">
                                    <c-transfer-sheet-resolution
                                      default-value="UseUtility"
                                      record-number={item.uniqueId}
                                      onuseutility={utilityResolution}
                                      onusesalesforce={salesforceResolution}>
                                    </c-transfer-sheet-resolution>
                                </td>
                            </template>
                            <!-- MISSING BILL ROW -->
                            <template if:true={item.isMissingBill}>
                                <td class="slds-p-around_xx-small slds-theme_error matchText matchStatusColumn">
                                    <lightning-helptext
                                      icon-name="utility:back"
                                      class= "slds-p-around_xx-small slds-theme_error"
                                      content="Will not send bill because there is not a SF account to link to">
                                    </lightning-helptext>
                                    <span>MISSING BILL</span>
                                </td>
                                <td class="resolutionColumn slds-p-around_xx-small slds-theme_error">
                                    <span class="matchText">Use Salesforce</span>
                                </td>
                            </template>
                            <!-- MISSING TRANSFER ROW -->
                            <template if:true={item.isMissingTransfer}>
                                <td class="slds-p-around_xx-small slds-theme_error matchText matchStatusColumn">
                                    <span>MISSING TRANSFER</span>
                                    <lightning-helptext
                                      icon-name="utility:forward"
                                      class= "slds-p-around_xx-small slds-theme_error"
                                      content={missingTransferHelptext}>
                                    </lightning-helptext>
                                </td>
                                <td class="resolutionColumn slds-theme_error">
                                    <c-transfer-sheet-resolution
                                      record-number={item.uniqueId}
                                      onuseutility={utilityResolution}
                                      onusesalesforce={salesforceResolution}>
                                    </c-transfer-sheet-resolution>
                                </td>
                            </template>
                            <td class={item.rightPanelStyle}>{item.trUtilityAccount}</td>
                            <td class={item.rightPanelStyle}>{item.trProduction}</td>
                            <td class={item.rightPanelStyle}>{item.trCredits}</td>
                            <td class={item.rightPanelStyle}>{item.trCreditValue}</td>
                        </tr>
                    </template>
                </table>
            </template>
            <!-- END NON-UCB TRANSFER DATA -->

            <!--- START UCB TRANSFER DATA --->
            <template if:true={UCB}>
                <table>
                    <tr>
                        <th class="slds-theme_inverse" colspan="8">
                            <div class="slds-align_absolute-center">Bluewave Calculated</div>
                        </th>
                        <th class="slds-theme_alt-inverse slds-theme_alert-texture" colspan="2">
                            <div class="slds-align_absolute-center">COMPARISON</div>
                        </th>
                        <th class="slds-theme_inverse" colspan="7">
                            <div class="slds-align_absolute-center">Utility Transfer Sheet</div>
                        </th>
                    </tr>
                    <tr class="slds-theme_alt-inverse slds-theme_alert-texture">
                        <th class="slds-p-around_xx-small nameColumn">Customer Name</th>
                        <th class="slds-p-around_xx-small">Utility Number</th>
                        <th class="slds-p-around_xx-small">New Available Credits</th>
                        <th class="slds-p-around_xx-small">Total Available Credits</th>
                        <th class="slds-p-around_xx-small">Net Member Credits</th>
                        <th class="slds-p-around_xx-small">Ending Banked Credits</th>
                        <th class="slds-p-around_xx-small">Utility Admin Fee</th>
                        <th class="slds-p-around_xx-small">CDG Sponsor Payment</th>
                        <th class="slds-p-around_xx-small matchText matchStatusColumn">Match Status</th>
                        <th class="slds-p-around_xx-small matchText">Resolution</th>
                        <th class="slds-p-around_xx-small">Utility Number</th>
                        <th class="slds-p-around_xx-small">New Available Credits</th>
                        <th class="slds-p-around_xx-small">Total Available Credits</th>
                        <th class="slds-p-around_xx-small">Net Member Credits</th>
                        <th class="slds-p-around_xx-small">Ending Banked Credits</th>
                        <th class="slds-p-around_xx-small">Utility Admin Fee</th>
                        <th class="slds-p-around_xx-small">CDG Sponsor Payment</th>
                    </tr>
                    <template for:each={uasbData} for:item='item'>
                        <tr key={item.uniqueId} class={item.rowStyle}>
                            <td class={item.leftPanelStyle}>{item.customerName}</td>
                            <td class={item.leftPanelStyle}>{item.exceptionPrefix}{item.sfUtilityAccount}</td>
                            <td class={item.leftPanelStyle}>{item.sfNewAvailableCredits}</td>
                            <td class={item.leftPanelStyle}>{item.sfTotalAvailableCredits}</td>
                            <td class={item.leftPanelStyle}>{item.sfNetMemberCredits}</td>
                            <td class={item.leftPanelStyle}>{item.sfEndingBankedCredits}</td>
                            <td class={item.leftPanelStyle}>{item.sfUtilityAdminFee}</td>
                            <td class={item.leftPanelStyle}>{item.sfCDGSponsorPayment}</td>
                            <!-- MATCHING ROW -->
                            <template if:true={item.isMatch}>
                                <td class="slds-p-around_xx-small slds-theme_success matchText matchStatusColumn">
                                    <span>MATCH</span>
                                </td>
                                <td class="resolutionColumn matchText slds-p-around_xx-small slds-theme_success">Not Needed</td>
                            </template>
                            <!-- CREDIT MISMATCH ROW -->
                            <template if:true={item.isCreditMismatch}>
                                <td class="matchText slds-p-around_xx-small slds-theme_shade slds-theme_warning matchStatusColumn">
                                    <lightning-helptext
                                      icon-name="utility:back"
                                      class= "slds-p-around_xx-small"
                                      content="Do you want to bill off transfer sheet or salesforce value?">
                                    </lightning-helptext>
                                    <span>MISMATCH</span>
                                    <lightning-helptext
                                      icon-name="utility:forward"
                                      class= "slds-p-around_xx-small"
                                      content="Do you want to bill off transfer sheet or salesforce value?">
                                    </lightning-helptext>
                                </td>
                                <td class="resolutionColumn slds-theme_shade slds-theme_warning">
                                    <c-transfer-sheet-resolution
                                      default-value="UseUtility"
                                      record-number={item.uniqueId}
                                      onuseutility={utilityResolution}
                                      onusesalesforce={salesforceResolution}>
                                    </c-transfer-sheet-resolution>
                                </td>
                            </template>
                            <!-- MISSING BILL ROW -->
                            <template if:true={item.isMissingBill}>
                                <td class="slds-p-around_xx-small slds-theme_error matchText matchStatusColumn">
                                    <lightning-helptext
                                      icon-name="utility:back"
                                      class= "slds-p-around_xx-small slds-theme_error"
                                      content="Will not generate bill because there is not a SF account to link to">
                                    </lightning-helptext>
                                    <span>MISSING BILL</span>
                                </td>
                                <td class="resolutionColumn matchText slds-p-around_xx-small slds-theme_error">
                                    <span>Use Salesforce</span>
                                </td>
                            </template>
                            <!-- MISSING TRANSFER ROW -->
                            <template if:true={item.isMissingTransfer}>
                                <td class="slds-p-around_xx-small slds-theme_error matchText matchStatusColumn">
                                    <span>MISSING TRANSFER</span>
                                    <lightning-helptext
                                      icon-name="utility:forward"
                                      class= "slds-p-around_xx-small slds-theme_error"
                                      content={missingTransferHelptext}>
                                    </lightning-helptext>
                                </td>
                                <td class="resolutionColumn slds-theme_error">
                                    <c-transfer-sheet-resolution
                                      record-number={item.uniqueId}
                                      onuseutility={utilityResolution}
                                      onusesalesforce={salesforceResolution}>
                                    </c-transfer-sheet-resolution>
                                </td>
                            </template>
                            <td class={item.rightPanelStyle}>{item.trUtilityAccount}</td>
                            <td class={item.rightPanelStyle}>{item.trNewAvailableCredits}</td>
                            <td class={item.rightPanelStyle}>{item.trTotalAvailableCredits}</td>
                            <td class={item.rightPanelStyle}>{item.trNetMemberCredits}</td>
                            <td class={item.rightPanelStyle}>{item.trEndingBankedCredits}</td>
                            <td class={item.rightPanelStyle}>{item.trUtilityAdminFee}</td>
                            <td class={item.rightPanelStyle}>{item.trCDGSponsorPayment}</td>
                        </tr>
                    </template>
                </table>
            </template>
            <!-- END UCB TRANSFER DATA -->
        </div>
    </div>
    <!-- END TABLE SECTION -->

    <!-- LOADING SPINNER -->
    <template if:false={readyState}>
        <c-bluewave-spinner show="true" fade-in="true" spinner-message="Loading..."></c-bluewave-spinner>
    </template>
</template>