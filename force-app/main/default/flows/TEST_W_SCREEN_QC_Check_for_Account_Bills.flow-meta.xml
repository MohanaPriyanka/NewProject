<?xml version="1.0" encoding="UTF-8"?>

<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    
    <apiVersion>49.0</apiVersion>
    
    <assignments>
        
        <name>Add_1_to_Counter</name>
        
        <label>Add +1 to Counter</label>
        
        <locationX>771</locationX>
        
        <locationY>371</locationY>
        
        <assignmentItems>
            
            <assignToReference>COUNTER</assignToReference>
            
            <operator>Add</operator>
            
            <value>
                
                <numberValue>1.0</numberValue>
                
            </value>
            
        </assignmentItems>
        
        <connector>
            
            <targetReference>Check_if_first_Account_Bill</targetReference>
            
        </connector>
        
    </assignments>
    
    <assignments>
        
        <name>Assign_Current_Account_Bill_Variables</name>
        
        <label>Assign Current Account Bill Variables</label>
        
        <locationX>602</locationX>
        
        <locationY>371</locationY>
        
        <assignmentItems>
            
            <assignToReference>CurrentAccountBillID</assignToReference>
            
            <operator>Assign</operator>
            
            <value>
                
                <elementReference>AccountBill.Account_Bill_ID__c</elementReference>
                
            </value>
            
        </assignmentItems>
        
        <assignmentItems>
            
            <assignToReference>Current_BillNum</assignToReference>
            
            <operator>Assign</operator>
            
            <value>
                
                <elementReference>AccountBill.Bill_Number__c</elementReference>
                
            </value>
            
        </assignmentItems>
        
        <assignmentItems>
            
            <assignToReference>ParentAccount</assignToReference>
            
            <operator>Assign</operator>
            
            <value>
                
                <elementReference>AccountBill.Parent_Account__c</elementReference>
                
            </value>
            
        </assignmentItems>
        
        <assignmentItems>
            
            <assignToReference>Current_PastBill</assignToReference>
            
            <operator>Assign</operator>
            
            <value>
                
                <elementReference>AccountBill.Past_Bill__c</elementReference>
                
            </value>
            
        </assignmentItems>
        
        <assignmentItems>
            
            <assignToReference>PropertyAccountID</assignToReference>
            
            <operator>Assign</operator>
            
            <value>
                
                <elementReference>AccountBill.Property_Account_ID__c</elementReference>
                
            </value>
            
        </assignmentItems>
        
        <connector>
            
            <targetReference>Add_1_to_Counter</targetReference>
            
        </connector>
        
    </assignments>
    
    <assignments>
        
        <name>Assign_Previous_Account_Bill_Variables</name>
        
        <label>Assign Previous Account Bill Variables</label>
        
        <locationX>1275</locationX>
        
        <locationY>507</locationY>
        
        <assignmentItems>
            
            <assignToReference>Previous_TotalDue</assignToReference>
            
            <operator>Assign</operator>
            
            <value>
                
                <elementReference>PreviousAccountBill.Total_Due__c</elementReference>
                
            </value>
            
        </assignmentItems>
        
        <connector>
            
            <targetReference>Compare_Current_Past_Due_and_Previous_Total_Due</targetReference>
            
        </connector>
        
    </assignments>
    
    <assignments>
        
        <name>QC_Check_Confirmed</name>
        
        <label>QC Check Confirmed</label>
        
        <locationX>937</locationX>
        
        <locationY>626</locationY>
        
        <assignmentItems>
            
            <assignToReference>AccountBill.QC_Check_Past_Bill__c</assignToReference>
            
            <operator>Assign</operator>
            
            <value>
                
                <stringValue>Confirmed</stringValue>
                
            </value>
            
        </assignmentItems>
        
        <connector>
            
            <targetReference>Update_One_Account_Bill</targetReference>
            
        </connector>
        
    </assignments>
    
    <assignments>
        
        <name>QC_Check_ERROR</name>
        
        <label>QC Check ERROR</label>
        
        <locationX>943</locationX>
        
        <locationY>739</locationY>
        
        <assignmentItems>
            
            <assignToReference>AccountBill.QC_Check_Past_Bill__c</assignToReference>
            
            <operator>Assign</operator>
            
            <value>
                
                <stringValue>ERROR</stringValue>
                
            </value>
            
        </assignmentItems>
        
        <connector>
            
            <targetReference>Update_One_Account_Bill</targetReference>
            
        </connector>
        
    </assignments>
    
    <assignments>
        
        <name>Set_Counter_back_to_0</name>
        
        <label>Set Counter back to 0</label>
        
        <locationX>162</locationX>
        
        <locationY>508</locationY>
        
        <assignmentItems>
            
            <assignToReference>COUNTER</assignToReference>
            
            <operator>Assign</operator>
            
            <value>
                
                <numberValue>0.0</numberValue>
                
            </value>
            
        </assignmentItems>
        
        <connector>
            
            <targetReference>Loop_through_all_Current_Account_Bills</targetReference>
            
        </connector>
        
    </assignments>
    
    <decisions>
        
        <name>Check_if_first_Account_Bill</name>
        
        <label>Check if first Account Bill</label>
        
        <locationX>937</locationX>
        
        <locationY>371</locationY>
        
        <defaultConnectorLabel>[Default Outcome]</defaultConnectorLabel>
        
        <rules>
            
            <name>First_Bill</name>
            
            <conditionLogic>and</conditionLogic>
            
            <conditions>
                
                <leftValueReference>Current_BillNum</leftValueReference>
                
                <operator>EqualTo</operator>
                
                <rightValue>
                    
                    <numberValue>1.0</numberValue>
                    
                </rightValue>
                
            </conditions>
            
            <connector>
                
                <targetReference>QC_Check_Confirmed</targetReference>
                
            </connector>
            
            <label>First Bill</label>
            
        </rules>
        
        <rules>
            
            <name>Not_First_Bill</name>
            
            <conditionLogic>and</conditionLogic>
            
            <conditions>
                
                <leftValueReference>Current_BillNum</leftValueReference>
                
                <operator>NotEqualTo</operator>
                
                <rightValue>
                    
                    <numberValue>1.0</numberValue>
                    
                </rightValue>
                
            </conditions>
            
            <connector>
                
                <targetReference>Lookup_Previous_Account_Bill</targetReference>
                
            </connector>
            
            <label>Not First Bill</label>
            
        </rules>
        
    </decisions>
    
    <decisions>
        
        <name>Compare_Current_Past_Due_and_Previous_Total_Due</name>
        
        <label>Compare Current Past Due and Previous Total Due</label>
        
        <locationX>1279</locationX>
        
        <locationY>669</locationY>
        
        <defaultConnectorLabel>[Default Outcome]</defaultConnectorLabel>
        
        <rules>
            
            <name>Values_Equal</name>
            
            <conditionLogic>and</conditionLogic>
            
            <conditions>
                
                <leftValueReference>Current_PastBill</leftValueReference>
                
                <operator>EqualTo</operator>
                
                <rightValue>
                    
                    <elementReference>Previous_TotalDue</elementReference>
                    
                </rightValue>
                
            </conditions>
            
            <connector>
                
                <targetReference>QC_Check_Confirmed</targetReference>
                
            </connector>
            
            <label>Values Equal</label>
            
        </rules>
        
        <rules>
            
            <name>Values_Dont_Equal</name>
            
            <conditionLogic>and</conditionLogic>
            
            <conditions>
                
                <leftValueReference>Current_PastBill</leftValueReference>
                
                <operator>NotEqualTo</operator>
                
                <rightValue>
                    
                    <elementReference>Previous_TotalDue</elementReference>
                    
                </rightValue>
                
            </conditions>
            
            <connector>
                
                <targetReference>QC_Check_ERROR</targetReference>
                
            </connector>
            
            <label>Values Dont Equal</label>
            
        </rules>
        
    </decisions>
    
    <decisions>
        
        <name>Stop_for_Counter</name>
        
        <label>Stop for Counter</label>
        
        <locationX>378</locationX>
        
        <locationY>688</locationY>
        
        <defaultConnector>
            
            <targetReference>Loop_through_all_Current_Account_Bills</targetReference>
            
        </defaultConnector>
        
        <defaultConnectorLabel>[Default Outcome]</defaultConnectorLabel>
        
        <rules>
            
            <name>If_Counter_14</name>
            
            <conditionLogic>and</conditionLogic>
            
            <conditions>
                
                <leftValueReference>COUNTER</leftValueReference>
                
                <operator>GreaterThan</operator>
                
                <rightValue>
                    
                    <numberValue>13.0</numberValue>
                    
                </rightValue>
                
            </conditions>
            
            <connector>
                
                <targetReference>Catch_Record_Update</targetReference>
                
            </connector>
            
            <label>If Counter&gt; 13</label>
            
        </rules>
        
    </decisions>
    
    <formulas>
        
        <description>Current Month variable to be used to grab most recent Account Bills</description>
        
        <name>BillMonth</name>
        
        <dataType>String</dataType>
        
        <expression>CASE(MONTH({!$Flow.CurrentDate}), 
1, &quot;January&quot;,
2, &quot;February&quot;,
3, &quot;March&quot;,
4, &quot;April&quot;,
5, &quot;May&quot;,
6, &quot;June&quot;,
7, &quot;July&quot;,
8, &quot;August&quot;,
9, &quot;September&quot;,
10, &quot;October&quot;,
11, &quot;November&quot;,
12, &quot;December&quot;, &quot;NONE&quot;)  &amp;&quot; &quot; &amp; TEXT(YEAR({!$Flow.CurrentDate}))</expression>
        
    </formulas>
    
    <formulas>
        
        <description>Current Bill # - 1</description>
        
        <name>PreviousBillNum</name>
        
        <dataType>Number</dataType>
        
        <expression>{!Current_BillNum}-1</expression>
        
        <scale>2</scale>
        
    </formulas>
    
    <interviewLabel>TEST W/SCREEN QC Check for Account Bills {!$Flow.CurrentDateTime}</interviewLabel>
    
    <label>QC Check for Account Bills (Picklist)</label>
    
    <loops>
        
        <name>Loop_through_all_Current_Account_Bills</name>
        
        <label>Loop through all Current Account Bills</label>
        
        <locationX>378</locationX>
        
        <locationY>372</locationY>
        
        <assignNextValueToReference>AccountBill</assignNextValueToReference>
        
        <collectionReference>AllCurrentAccountBills</collectionReference>
        
        <iterationOrder>Asc</iterationOrder>
        
        <nextValueConnector>
            
            <targetReference>Assign_Current_Account_Bill_Variables</targetReference>
            
        </nextValueConnector>
        
        <noMoreValuesConnector>
            
            <targetReference>END_Screen</targetReference>
            
        </noMoreValuesConnector>
        
    </loops>
    
    <processType>Flow</processType>
    
    <recordLookups>
        
        <name>Find_All_Current_Account_Bills</name>
        
        <label>Find All Current Account Bills</label>
        
        <locationX>32</locationX>
        
        <locationY>371</locationY>
        
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        
        <connector>
            
            <targetReference>Loop_through_all_Current_Account_Bills</targetReference>
            
        </connector>
        
        <filterLogic>and</filterLogic>
        
        <filters>
            
            <field>Name</field>
            
            <operator>Contains</operator>
            
            <value>
                
                <elementReference>BillMonth</elementReference>
                
            </value>
            
        </filters>
        
        <object>Account_Bill__c</object>
        
        <outputReference>AllCurrentAccountBills</outputReference>
        
        <queriedFields>Account_Bill_ID__c</queriedFields>
        
        <queriedFields>Bill_Number__c</queriedFields>
        
        <queriedFields>Parent_Account__c</queriedFields>
        
        <queriedFields>Past_Bill__c</queriedFields>
        
        <queriedFields>Property_Account_ID__c</queriedFields>
        
        <queriedFields>QC_Check_Past_Bill__c</queriedFields>
        
    </recordLookups>
    
    <recordLookups>
        
        <name>Lookup_Previous_Account_Bill</name>
        
        <label>Lookup Previous Account Bill</label>
        
        <locationX>1275</locationX>
        
        <locationY>369</locationY>
        
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        
        <connector>
            
            <targetReference>Assign_Previous_Account_Bill_Variables</targetReference>
            
        </connector>
        
        <filterLogic>and</filterLogic>
        
        <filters>
            
            <field>Bill_Number__c</field>
            
            <operator>EqualTo</operator>
            
            <value>
                
                <elementReference>PreviousBillNum</elementReference>
                
            </value>
            
        </filters>
        
        <filters>
            
            <field>Parent_Account__c</field>
            
            <operator>EqualTo</operator>
            
            <value>
                
                <elementReference>ParentAccount</elementReference>
                
            </value>
            
        </filters>
        
        <object>Account_Bill__c</object>
        
        <outputReference>PreviousAccountBill</outputReference>
        
        <queriedFields>Total_Due__c</queriedFields>
        
    </recordLookups>
    
    <recordUpdates>
        
        <name>Update_One_Account_Bill</name>
        
        <label>Update One Account Bill</label>
        
        <locationX>682</locationX>
        
        <locationY>689</locationY>
        
        <connector>
            
            <targetReference>Stop_for_Counter</targetReference>
            
        </connector>
        
        <filterLogic>and</filterLogic>
        
        <filters>
            
            <field>Account_Bill_ID__c</field>
            
            <operator>EqualTo</operator>
            
            <value>
                
                <elementReference>AccountBill.Account_Bill_ID__c</elementReference>
                
            </value>
            
        </filters>
        
        <inputAssignments>
            
            <field>QC_Check_Past_Bill__c</field>
            
            <value>
                
                <elementReference>AccountBill.QC_Check_Past_Bill__c</elementReference>
                
            </value>
            
        </inputAssignments>
        
        <object>Account_Bill__c</object>
        
    </recordUpdates>
    
    <screens>
        
        <name>Catch_Record_Update</name>
        
        <label>Catch Record Update</label>
        
        <locationX>159</locationX>
        
        <locationY>685</locationY>
        
        <allowBack>false</allowBack>
        
        <allowFinish>true</allowFinish>
        
        <allowPause>false</allowPause>
        
        <connector>
            
            <targetReference>Set_Counter_back_to_0</targetReference>
            
        </connector>
        
        <showFooter>true</showFooter>
        
        <showHeader>true</showHeader>
        
    </screens>
    
    <screens>
        
        <name>END_Screen</name>
        
        <label>END Screen</label>
        
        <locationX>378</locationX>
        
        <locationY>126</locationY>
        
        <allowBack>true</allowBack>
        
        <allowFinish>true</allowFinish>
        
        <allowPause>true</allowPause>
        
        <showFooter>true</showFooter>
        
        <showHeader>true</showHeader>
        
    </screens>
    
    <startElementReference>Find_All_Current_Account_Bills</startElementReference>
    
    <status>Active</status>
    
    <variables>
        
        <name>AccountBill</name>
        
        <dataType>SObject</dataType>
        
        <isCollection>false</isCollection>
        
        <isInput>false</isInput>
        
        <isOutput>false</isOutput>
        
        <objectType>Account_Bill__c</objectType>
        
    </variables>
    
    <variables>
        
        <name>AllCurrentAccountBills</name>
        
        <dataType>SObject</dataType>
        
        <isCollection>true</isCollection>
        
        <isInput>false</isInput>
        
        <isOutput>false</isOutput>
        
        <objectType>Account_Bill__c</objectType>
        
    </variables>
    
    <variables>
        
        <name>COUNTER</name>
        
        <dataType>Number</dataType>
        
        <isCollection>false</isCollection>
        
        <isInput>false</isInput>
        
        <isOutput>false</isOutput>
        
        <scale>2</scale>
        
        <value>
            
            <numberValue>0.0</numberValue>
            
        </value>
        
    </variables>
    
    <variables>
        
        <name>Current_BillNum</name>
        
        <dataType>Number</dataType>
        
        <isCollection>false</isCollection>
        
        <isInput>false</isInput>
        
        <isOutput>false</isOutput>
        
        <scale>2</scale>
        
    </variables>
    
    <variables>
        
        <description>Past Bill value found on Current Account Bill</description>
        
        <name>Current_PastBill</name>
        
        <dataType>Currency</dataType>
        
        <isCollection>false</isCollection>
        
        <isInput>false</isInput>
        
        <isOutput>false</isOutput>
        
        <scale>2</scale>
        
    </variables>
    
    <variables>
        
        <name>CurrentAccountBillID</name>
        
        <dataType>String</dataType>
        
        <isCollection>false</isCollection>
        
        <isInput>false</isInput>
        
        <isOutput>false</isOutput>
        
    </variables>
    
    <variables>
        
        <name>ParentAccount</name>
        
        <dataType>String</dataType>
        
        <isCollection>false</isCollection>
        
        <isInput>false</isInput>
        
        <isOutput>false</isOutput>
        
    </variables>
    
    <variables>
        
        <name>Previous_TotalDue</name>
        
        <dataType>Currency</dataType>
        
        <isCollection>false</isCollection>
        
        <isInput>false</isInput>
        
        <isOutput>false</isOutput>
        
        <scale>2</scale>
        
    </variables>
    
    <variables>
        
        <name>PreviousAccountBill</name>
        
        <dataType>SObject</dataType>
        
        <isCollection>false</isCollection>
        
        <isInput>false</isInput>
        
        <isOutput>false</isOutput>
        
        <objectType>Account_Bill__c</objectType>
        
    </variables>
    
    <variables>
        
        <name>PropertyAccountID</name>
        
        <dataType>String</dataType>
        
        <isCollection>false</isCollection>
        
        <isInput>false</isInput>
        
        <isOutput>false</isOutput>
        
    </variables>
    
    <variables>
        
        <description>If value is checked, the Current Past Due value and the Previous Total Due value are equal; If not checked, they are not equal</description>
        
        <name>QCCheck</name>
        
        <dataType>Boolean</dataType>
        
        <isCollection>false</isCollection>
        
        <isInput>false</isInput>
        
        <isOutput>false</isOutput>
        
    </variables>
    
    <variables>
        
        <description>Store the Account Bill ID and the value (true or false) that needs to set the QC Check box</description>
        
        <name>UpdateRecords</name>
        
        <dataType>SObject</dataType>
        
        <isCollection>true</isCollection>
        
        <isInput>false</isInput>
        
        <isOutput>false</isOutput>
        
        <objectType>Account_Bill__c</objectType>
        
    </variables>
    
</Flow>
